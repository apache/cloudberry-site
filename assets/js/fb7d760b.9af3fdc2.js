"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[42301],{70075:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var n=s(85893),t=s(11151);const i={title:"Enable Segment Mirroring"},o="Enable Segment Mirroring",a={id:"sys-admin/high-availability/enable-segment-mirroring",title:"Enable Segment Mirroring",description:"Mirror segments allow database queries to fail over to a backup segment if the primary segment is unavailable. By default, mirrors are configured on the same array of hosts as the primary segments. You may choose a completely different set of hosts for your mirror segments so they do not share machines with any of your primary segments.",source:"@site/docs/sys-admin/high-availability/enable-segment-mirroring.md",sourceDirName:"sys-admin/high-availability",slug:"/sys-admin/high-availability/enable-segment-mirroring",permalink:"/docs/next/sys-admin/high-availability/enable-segment-mirroring",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/sys-admin/high-availability/enable-segment-mirroring.md",tags:[],version:"current",lastUpdatedBy:"TomShawn",lastUpdatedAt:1761905913,formattedLastUpdatedAt:"Oct 31, 2025",frontMatter:{title:"Enable Segment Mirroring"},sidebar:"docsbars",previous:{title:"Enable Mirroring",permalink:"/docs/next/sys-admin/high-availability/enable-mirroring"},next:{title:"Enable Coordinator Mirroring for Apache Cloudberry",permalink:"/docs/next/sys-admin/high-availability/enable-coordinator-mirroring"}},d={},l=[{value:"To add segment mirrors to an existing system (same hosts as primaries)",id:"to-add-segment-mirrors-to-an-existing-system-same-hosts-as-primaries",level:2},{value:"To add segment mirrors to an existing system (different hosts from primaries)",id:"to-add-segment-mirrors-to-an-existing-system-different-hosts-from-primaries",level:2}];function m(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{id:"enable-segment-mirroring",children:"Enable Segment Mirroring"}),"\n",(0,n.jsx)(r.p,{children:"Mirror segments allow database queries to fail over to a backup segment if the primary segment is unavailable. By default, mirrors are configured on the same array of hosts as the primary segments. You may choose a completely different set of hosts for your mirror segments so they do not share machines with any of your primary segments."}),"\n",(0,n.jsx)(r.admonition,{type:"note",children:(0,n.jsx)(r.p,{children:"During the online data replication process, Apache Cloudberry should be in a quiescent state, workloads and other queries should not be running."})}),"\n",(0,n.jsx)(r.h2,{id:"to-add-segment-mirrors-to-an-existing-system-same-hosts-as-primaries",children:"To add segment mirrors to an existing system (same hosts as primaries)"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Allocate the data storage area for mirror data on all segment hosts. The data storage area must be different from your primary segments' file system location."}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Use ",(0,n.jsx)(r.a,{href:"/docs/next/sys-utilities/gpssh-exkeys",children:(0,n.jsx)(r.code,{children:"gpssh-exkeys"})})," to ensure that the segment hosts can SSH and remote sync to each other without a password prompt."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Run the ",(0,n.jsx)(r.a,{href:"/docs/next/sys-utilities/gpaddmirrors",children:(0,n.jsx)(r.code,{children:"gpaddmirrors"})})," utility to enable mirroring in your Apache Cloudberry system. For example, to add 10000 to your primary segment port numbers to calculate the mirror segment port numbers:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",children:"$ gpaddmirrors -p 10000\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Where ",(0,n.jsx)(r.code,{children:"-p"})," specifies the number to add to your primary segment port numbers. Mirrors are added with the default group mirroring configuration."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"to-add-segment-mirrors-to-an-existing-system-different-hosts-from-primaries",children:"To add segment mirrors to an existing system (different hosts from primaries)"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Ensure the Apache Cloudberry software is installed on all hosts. See the ",(0,n.jsx)(r.a,{href:"/docs/next/cbdb-op-deploy-guide",children:"Apache Cloudberry Installation Guide"})," for detailed installation instructions."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Allocate the data storage area for mirror data, and tablespaces if needed, on all segment hosts."}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Use ",(0,n.jsx)(r.code,{children:"gpssh-exkeys"})," to ensure the segment hosts can SSH and remote sync to each other without a password prompt."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Create a configuration file that lists the host names, ports, and data directories on which to create mirrors. To create a sample configuration file to use as a starting point, run:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",children:"$ gpaddmirrors -o <filename>          \n"})}),"\n",(0,n.jsx)(r.p,{children:"The format of the mirror configuration file is:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"<row_id>=<contentID>|<address>|<port>|<data_dir>\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Where ",(0,n.jsx)(r.code,{children:"row_id"})," is the row in the file, contentID is the segment instance content ID, address is the host name or IP address of the segment host, port is the communication port, and ",(0,n.jsx)(r.code,{children:"data_dir"})," is the segment instance data directory."]}),"\n",(0,n.jsx)(r.p,{children:"For example, this is contents of a mirror configuration file for two segment hosts and two segment instances per host:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"0=2|sdw1-1|41000|/data/mirror1/gp2\n1=3|sdw1-2|41001|/data/mirror2/gp3\n2=0|sdw2-1|41000|/data/mirror1/gp0\n3=1|sdw2-2|41001|/data/mirror2/gp1\n"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["Run the ",(0,n.jsx)(r.code,{children:"gpaddmirrors"})," utility to enable mirroring in your Apache Cloudberry system:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",children:"$ gpaddmirrors -i <mirror_config_file>\n"})}),"\n",(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"-i"})," option specifies the mirror configuration file you created."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.a)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(m,{...e})}):m(e)}},11151:(e,r,s)=>{s.d(r,{Z:()=>a,a:()=>o});var n=s(67294);const t={},i=n.createContext(t);function o(e){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);