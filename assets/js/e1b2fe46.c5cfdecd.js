"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[70944],{48814:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>c,toc:()=>a});var s=r(85893),l=r(11151);const t={title:"Use PL/Perl"},i="Use PL/Perl",c={id:"developer/functions-and-procedures/use-pl-perl",title:"Use PL/Perl",description:"PL/Perl is an embedded procedural language that allows you to write PostgreSQL functions using the Perl programming language.",source:"@site/docs/developer/functions-and-procedures/use-pl-perl.md",sourceDirName:"developer/functions-and-procedures",slug:"/developer/functions-and-procedures/use-pl-perl",permalink:"/docs/next/developer/functions-and-procedures/use-pl-perl",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/developer/functions-and-procedures/use-pl-perl.md",tags:[],version:"current",lastUpdatedBy:"TomShawn",lastUpdatedAt:1767860953,formattedLastUpdatedAt:"Jan 8, 2026",frontMatter:{title:"Use PL/Perl"},sidebar:"docsbars",previous:{title:"Use PL/Java",permalink:"/docs/next/developer/functions-and-procedures/use-pl-java"},next:{title:"Use PL/pgSQL",permalink:"/docs/next/developer/functions-and-procedures/use-pl-pgsql"}},d={},a=[{value:"Enable PL/Perl",id:"enable-plperl",level:2},{value:"Write PL/Perl functions",id:"write-plperl-functions",level:2},{value:"Arguments and results",id:"arguments-and-results",level:3},{value:"Strict functions",id:"strict-functions",level:3},{value:"Built-in functions",id:"built-in-functions",level:2},{value:"Security and limitations",id:"security-and-limitations",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"use-plperl",children:"Use PL/Perl"}),"\n",(0,s.jsx)(n.p,{children:"PL/Perl is an embedded procedural language that allows you to write PostgreSQL functions using the Perl programming language."}),"\n",(0,s.jsx)(n.p,{children:"With PL/Perl, you can:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Write functions in Perl and call them from SQL."}),"\n",(0,s.jsx)(n.li,{children:"Use the powerful string manipulation features of Perl."}),"\n",(0,s.jsx)(n.li,{children:"Use available Perl modules."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"enable-plperl",children:"Enable PL/Perl"}),"\n",(0,s.jsx)(n.p,{children:"To use PL/Perl, you must enable it in your database."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Connect to your database using ",(0,s.jsx)(n.code,{children:"psql"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"psql -d <database_name>\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Create the ",(0,s.jsx)(n.code,{children:"plperl"})," extension."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE EXTENSION plperl;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This registers the trusted (",(0,s.jsx)(n.code,{children:"plperl"}),") language. If you want the untrusted language, use ",(0,s.jsx)(n.code,{children:"CREATE EXTENSION plperlu"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"write-plperl-functions",children:"Write PL/Perl functions"}),"\n",(0,s.jsxs)(n.p,{children:["You define a PL/Perl function using the standard SQL ",(0,s.jsx)(n.code,{children:"CREATE FUNCTION"})," syntax. The body of the function is ordinary Perl code."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE FUNCTION perl_max (integer, integer)\nRETURNS integer\nAS $$\n    if ($_[0] > $_[1]) { return $_[0]; }\n    return $_[1];\n$$ LANGUAGE plperl;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"arguments-and-results",children:"Arguments and results"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Arguments are accessed via the ",(0,s.jsx)(n.code,{children:"@_"})," array."]}),"\n",(0,s.jsxs)(n.li,{children:["You return a result value with the ",(0,s.jsx)(n.code,{children:"return"})," statement or as the last evaluated expression."]}),"\n",(0,s.jsxs)(n.li,{children:["To return a SQL ",(0,s.jsx)(n.code,{children:"NULL"}),", return the Perl ",(0,s.jsx)(n.code,{children:"undef"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"strict-functions",children:"Strict functions"}),"\n",(0,s.jsxs)(n.p,{children:["By default, PL/Perl functions are called with non-null arguments. If a SQL ",(0,s.jsx)(n.code,{children:"NULL"})," is passed, the result is ",(0,s.jsx)(n.code,{children:"NULL"})," unless you specify ",(0,s.jsx)(n.code,{children:"STRICT"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE FUNCTION perl_max_strict (integer, integer)\nRETURNS integer\nAS $$\n    if ($_[0] > $_[1]) { return $_[0]; }\n    return $_[1];\n$$ LANGUAGE plperl STRICT;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"built-in-functions",children:"Built-in functions"}),"\n",(0,s.jsx)(n.p,{children:"PL/Perl provides access to the database via built-in functions."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"spi_exec_query(query [, limit])"}),": Executes a query and returns the result."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"elog(level, msg)"}),": Emits a log message."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Example of using ",(0,s.jsx)(n.code,{children:"spi_exec_query"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION return_match(varchar) RETURNS SETOF test AS $$\n    my $rv = spi_exec_query('select * from test;');\n    my $nrows = $rv->{processed};\n    foreach my $rn (0 .. $nrows - 1) {\n        my $row = $rv->{rows}[$rn];\n        if (index($row->{v}, $_[0]) != -1) {\n            return_next($row);\n        }\n    }\n    return undef;\n$$ LANGUAGE plperl;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"security-and-limitations",children:"Security and limitations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Trusted Language (",(0,s.jsx)(n.code,{children:"plperl"}),")"]}),": Restricts file system operations and other potentially unsafe operations. Any user can create functions in ",(0,s.jsx)(n.code,{children:"plperl"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Untrusted Language (",(0,s.jsx)(n.code,{children:"plperlu"}),")"]}),": Allows unrestricted access to the system. Only superusers can create functions in ",(0,s.jsx)(n.code,{children:"plperlu"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Limitations"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PL/Perl triggers are not supported in Apache Cloudberry."}),"\n",(0,s.jsx)(n.li,{children:"PL/Perl functions cannot call each other directly."}),"\n"]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>c,a:()=>i});var s=r(67294);const l={},t=s.createContext(l);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);