"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[50612],{35092:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>a});var r=s(85893),t=s(11151);const l={title:"Use PL/pgSQL"},o="Use PL/pgSQL",i={id:"developer/functions-and-procedures/use-pl-pgsql",title:"Use PL/pgSQL",description:"PL/pgSQL is a loadable procedural language that is installed and registered by default with Apache Cloudberry. It adds the ability to perform complex computations and usage of control structures to standard SQL.",source:"@site/versioned_docs/version-2.x/developer/functions-and-procedures/use-pl-pgsql.md",sourceDirName:"developer/functions-and-procedures",slug:"/developer/functions-and-procedures/use-pl-pgsql",permalink:"/docs/developer/functions-and-procedures/use-pl-pgsql",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/developer/functions-and-procedures/use-pl-pgsql.md",tags:[],version:"2.x",lastUpdatedBy:"TomShawn",lastUpdatedAt:1767860953,formattedLastUpdatedAt:"Jan 8, 2026",frontMatter:{title:"Use PL/pgSQL"},sidebar:"docsbars",previous:{title:"Use PL/Perl",permalink:"/docs/developer/functions-and-procedures/use-pl-perl"},next:{title:"Use PL/Python",permalink:"/docs/developer/functions-and-procedures/use-pl-python"}},c={},a=[{value:"Benefits of PL/pgSQL",id:"benefits-of-plpgsql",level:2},{value:"Structure of PL/pgSQL functions",id:"structure-of-plpgsql-functions",level:2},{value:"Example: Create a simple function",id:"example-create-a-simple-function",level:3},{value:"Anonymous blocks",id:"anonymous-blocks",level:2},{value:"Declarations",id:"declarations",level:2},{value:"Control structures",id:"control-structures",level:2},{value:"Cursors",id:"cursors",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"use-plpgsql",children:"Use PL/pgSQL"}),"\n",(0,r.jsx)(n.p,{children:"PL/pgSQL is a loadable procedural language that is installed and registered by default with Apache Cloudberry. It adds the ability to perform complex computations and usage of control structures to standard SQL."}),"\n",(0,r.jsx)(n.h2,{id:"benefits-of-plpgsql",children:"Benefits of PL/pgSQL"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SQL integration"}),": It is designed to be easy to use with SQL."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Portability"}),": Functions written in PL/pgSQL can be used on any platform where Apache Cloudberry runs."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": It reduces the communication overhead between the client and the server by grouping multiple SQL statements into a single block."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"structure-of-plpgsql-functions",children:"Structure of PL/pgSQL functions"}),"\n",(0,r.jsx)(n.p,{children:"A PL/pgSQL function differs from a standard SQL function in that the function body is organized into blocks."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"[ <<label>> ]\n[ DECLARE\n    declarations ]\nBEGIN\n    statements\nEND [ label ];\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Declarations"}),": Define variables used in the block."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Statements"}),": The actual procedural code."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"BEGIN/END"}),": Delimit the block."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example-create-a-simple-function",children:"Example: Create a simple function"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION sales_tax(subtotal real)\nRETURNS real AS $$\nBEGIN\n    RETURN subtotal * 0.06;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"anonymous-blocks",children:"Anonymous blocks"}),"\n",(0,r.jsxs)(n.p,{children:["You can run PL/pgSQL code without creating a persistent function using the ",(0,r.jsx)(n.code,{children:"DO"})," command. This is useful for administration tasks or one-off scripts."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"DO $$\nDECLARE\n    counter integer := 0;\nBEGIN\n    WHILE counter < 5 LOOP\n        RAISE NOTICE 'Counter: %', counter;\n        counter := counter + 1;\n    END LOOP;\nEND $$;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"declarations",children:"Declarations"}),"\n",(0,r.jsxs)(n.p,{children:["You can declare variables with standard SQL data types. You can also use ",(0,r.jsx)(n.code,{children:"%TYPE"})," and ",(0,r.jsx)(n.code,{children:"%ROWTYPE"})," to reference existing database objects."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"%TYPE"}),": copies the data type of a variable or table column."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"user_id users.id%TYPE;\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"%ROWTYPE"}),": creates a composite variable that matches the row structure of a table."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"user_row users%ROWTYPE;\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"control-structures",children:"Control structures"}),"\n",(0,r.jsx)(n.p,{children:"PL/pgSQL supports various control structures:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"IF-THEN-ELSE"}),": Conditional execution."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"LOOP, WHILE, FOR"}),": Iterative execution."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"EXCEPTION"}),": Error handling."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"IF v_count > 0 THEN\n    UPDATE users SET active = true WHERE id = v_user_id;\nELSE\n    INSERT INTO users (id, active) VALUES (v_user_id, true);\nEND IF;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cursors",children:"Cursors"}),"\n",(0,r.jsx)(n.p,{children:"Cursors allow you to iterate through a query result set row by row."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"DECLARE\n    curs1 CURSOR FOR SELECT * FROM users;\n    row_var users%ROWTYPE;\nBEGIN\n    OPEN curs1;\n    LOOP\n        FETCH curs1 INTO row_var;\n        EXIT WHEN NOT FOUND;\n        -- Process row_var\n    END LOOP;\n    CLOSE curs1;\nEND;\n"})})]})}function u(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>i,a:()=>o});var r=s(67294);const t={},l=r.createContext(t);function o(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);