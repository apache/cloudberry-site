"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[47856],{50219:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>u,frontMatter:()=>c,metadata:()=>l,toc:()=>o});var a=t(85893),s=t(11151);const c={title:"Create and Manage Sequences"},r="Create and Manage Sequences",l={id:"operate-with-data/operate-with-db-objects/create-and-manage-sequences",title:"Create and Manage Sequences",description:"An Apache Cloudberry sequence object is a special single row table that functions as a number generator. You can use a sequence to generate unique integer identifiers for a row that you add to a table. Declaring a column of type SERIAL implicitly creates a sequence counter for use in that table column.",source:"@site/docs/operate-with-data/operate-with-db-objects/create-and-manage-sequences.md",sourceDirName:"operate-with-data/operate-with-db-objects",slug:"/operate-with-data/operate-with-db-objects/create-and-manage-sequences",permalink:"/docs/next/operate-with-data/operate-with-db-objects/create-and-manage-sequences",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/operate-with-data/operate-with-db-objects/create-and-manage-sequences.md",tags:[],version:"current",lastUpdatedBy:"Leonid Borchuk",lastUpdatedAt:1756090353,formattedLastUpdatedAt:"Aug 25, 2025",frontMatter:{title:"Create and Manage Sequences"},sidebar:"docsbars",previous:{title:"About Table Partitioning",permalink:"/docs/next/operate-with-data/operate-with-db-objects/about-table-partitioning"},next:{title:"Insert, Update, and Delete Rows",permalink:"/docs/next/operate-with-data/operate-with-db-objects/insert-update-delete-rows"}},i={},o=[{value:"Create a sequence",id:"create-a-sequence",level:2},{value:"Use a sequence",id:"use-a-sequence",level:2},{value:"Examine sequence attributes",id:"examine-sequence-attributes",level:3},{value:"Return the next sequence counter value",id:"return-the-next-sequence-counter-value",level:3},{value:"Set the sequence counter value",id:"set-the-sequence-counter-value",level:3},{value:"nextval() and setval() caution",id:"nextval-and-setval-caution",level:3},{value:"Alter a sequence",id:"alter-a-sequence",level:2},{value:"Drop a sequence",id:"drop-a-sequence",level:2},{value:"Specify a sequence as the default value for a column",id:"specify-a-sequence-as-the-default-value-for-a-column",level:2},{value:"Sequence wraparound",id:"sequence-wraparound",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"create-and-manage-sequences",children:"Create and Manage Sequences"}),"\n",(0,a.jsxs)(n.p,{children:["An Apache Cloudberry sequence object is a special single row table that functions as a number generator. You can use a sequence to generate unique integer identifiers for a row that you add to a table. Declaring a column of type ",(0,a.jsx)(n.code,{children:"SERIAL"})," implicitly creates a sequence counter for use in that table column."]}),"\n",(0,a.jsxs)(n.p,{children:["Apache Cloudberry provides commands to create, alter, and drop a sequence. Apache Cloudberry also provides built-in functions to return the next value in the sequence (",(0,a.jsx)(n.code,{children:"nextval()"}),") or to set the sequence to a specific start value (",(0,a.jsx)(n.code,{children:"setval()"}),")."]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["The PostgreSQL ",(0,a.jsx)(n.code,{children:"currval()"})," and ",(0,a.jsx)(n.code,{children:"lastval()"})," sequence functions are not supported in Apache Cloudberry."]})}),"\n",(0,a.jsxs)(n.p,{children:["Attributes of a sequence object include the name of the sequence, its increment value, and the last, minimum, and maximum values of the sequence counter. Sequences also have a special boolean attribute named ",(0,a.jsx)(n.code,{children:"is_called"})," that governs the auto-increment behavior of a ",(0,a.jsx)(n.code,{children:"nextval()"})," operation on the sequence counter. When a sequence's ",(0,a.jsx)(n.code,{children:"is_called"})," attribute is ",(0,a.jsx)(n.code,{children:"true"}),", ",(0,a.jsx)(n.code,{children:"nextval()"})," increments the sequence counter before returning the value. When the ",(0,a.jsx)(n.code,{children:"is_called"})," attribute value of a sequence is ",(0,a.jsx)(n.code,{children:"false"}),", ",(0,a.jsx)(n.code,{children:"nextval()"})," does not increment the counter before returning the value."]}),"\n",(0,a.jsx)(n.h2,{id:"create-a-sequence",children:"Create a sequence"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.a,{href:"/docs/next/sql-stmts/create-sequence",children:(0,a.jsx)(n.code,{children:"CREATE SEQUENCE"})})," command creates and initializes a sequence with the given sequence name and optional start value. The sequence name must be distinct from the name of any other sequence, table, index, or view in the same schema. For example:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE SEQUENCE myserial START 101;\n"})}),"\n",(0,a.jsxs)(n.p,{children:["When you create a new sequence, Apache Cloudberry sets the sequence ",(0,a.jsx)(n.code,{children:"is_called"})," attribute to ",(0,a.jsx)(n.code,{children:"false"}),". Invoking ",(0,a.jsx)(n.code,{children:"nextval()"})," on a newly-created sequence does not increment the sequence counter, but returns the sequence start value and sets ",(0,a.jsx)(n.code,{children:"is_called"})," to ",(0,a.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"use-a-sequence",children:"Use a sequence"}),"\n",(0,a.jsxs)(n.p,{children:["After you create a sequence with the ",(0,a.jsx)(n.code,{children:"CREATE SEQUENCE"})," command, you can examine the sequence and use the sequence built-in functions."]}),"\n",(0,a.jsx)(n.h3,{id:"examine-sequence-attributes",children:"Examine sequence attributes"}),"\n",(0,a.jsxs)(n.p,{children:["To examine the current attributes of a sequence, query the sequence directly. For example, to examine a sequence named ",(0,a.jsx)(n.code,{children:"myserial"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM myserial;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"return-the-next-sequence-counter-value",children:"Return the next sequence counter value"}),"\n",(0,a.jsxs)(n.p,{children:["You can invoke the ",(0,a.jsx)(n.code,{children:"nextval()"})," built-in function to return and use the next value in a sequence. The following command inserts the next value of the sequence named ",(0,a.jsx)(n.code,{children:"myserial"})," into the first column of a table named ",(0,a.jsx)(n.code,{children:"vendors"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO vendors VALUES (nextval('myserial'), 'acme');\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"nextval()"})," uses the sequence's ",(0,a.jsx)(n.code,{children:"is_called"})," attribute value to determine whether or not to increment the sequence counter before returning the value. ",(0,a.jsx)(n.code,{children:"nextval()"})," advances the counter when ",(0,a.jsx)(n.code,{children:"is_called"})," is ",(0,a.jsx)(n.code,{children:"true"}),". ",(0,a.jsx)(n.code,{children:"nextval()"})," sets the sequence ",(0,a.jsx)(n.code,{children:"is_called"})," attribute to ",(0,a.jsx)(n.code,{children:"true"})," before returning."]}),"\n",(0,a.jsxs)(n.p,{children:["A ",(0,a.jsx)(n.code,{children:"nextval()"})," operation is never rolled back. A fetched value is considered used, even if the transaction that performed the ",(0,a.jsx)(n.code,{children:"nextval()"})," fails. This means that failed transactions can leave unused holes in the sequence of assigned values."]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["You cannot use the ",(0,a.jsx)(n.code,{children:"nextval()"})," function in ",(0,a.jsx)(n.code,{children:"UPDATE"})," or ",(0,a.jsx)(n.code,{children:"DELETE"})," statements if mirroring is enabled in Apache Cloudberry."]})}),"\n",(0,a.jsx)(n.h3,{id:"set-the-sequence-counter-value",children:"Set the sequence counter value"}),"\n",(0,a.jsxs)(n.p,{children:["You can use the Apache Cloudberry ",(0,a.jsx)(n.code,{children:"setval()"})," built-in function to set the counter value for a sequence. For example, the following command sets the counter value of the sequence named ",(0,a.jsx)(n.code,{children:"myserial"})," to ",(0,a.jsx)(n.code,{children:"201"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT setval('myserial', 201);\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"setval()"})," has two function signatures: ",(0,a.jsx)(n.code,{children:"setval(sequence, start_val)"})," and ",(0,a.jsx)(n.code,{children:"setval(sequence, start_val, is_called)"}),". The default behaviour of ",(0,a.jsx)(n.code,{children:"setval(sequence, start_val)"})," sets the sequence ",(0,a.jsx)(n.code,{children:"is_called"})," attribute value to ",(0,a.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["If you do not want the sequence counter advanced on the next ",(0,a.jsx)(n.code,{children:"nextval()"})," call, use the ",(0,a.jsx)(n.code,{children:"setval(sequence, start_val, is_called)"})," function signature, passing a ",(0,a.jsx)(n.code,{children:"false"})," argument:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT setval('myserial', 201, false);\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"setval()"})," operations are never rolled back."]}),"\n",(0,a.jsx)(n.h3,{id:"nextval-and-setval-caution",children:"nextval() and setval() caution"}),"\n",(0,a.jsxs)(n.p,{children:["To avoid blocking concurrent transactions that obtain numbers from the same sequence, the value obtained by ",(0,a.jsx)(n.code,{children:"nextval()"})," is not reclaimed for re-use if the calling transaction later aborts. As such, transaction aborts or database crashes can result in gaps in the sequence of assigned values. This situation can occur without a transaction abort, also. For example, an ",(0,a.jsx)(n.code,{children:"INSERT"})," with an ",(0,a.jsx)(n.code,{children:"ON CONFLICT"})," clause will compute the to-be-inserted tuple, including invoking any required ",(0,a.jsx)(n.code,{children:"nextval()"})," calls, before detecting any conflict that would cause it to follow the ",(0,a.jsx)(n.code,{children:"ON CONFLICT"}),' rule instead. Consequently, you cannot use Apache Cloudberry sequence objects to obtain "gapless" sequences.']}),"\n",(0,a.jsxs)(n.p,{children:["Similarly, sequence state changes made by ",(0,a.jsx)(n.code,{children:"setval()"})," are immediately visible to other transactions, and are not undone if the calling transaction rolls back."]}),"\n",(0,a.jsxs)(n.p,{children:["If the database cluster crashes before committing a transaction containing a ",(0,a.jsx)(n.code,{children:"nextval()"})," or ",(0,a.jsx)(n.code,{children:"setval()"})," call, the sequence state change might not have been propogated to persistent storage, so that it is uncertain whether the sequence has its original or updated state after the cluster restarts. This is harmless for usage of the sequence within the database, because other effects of uncommitted transactions are visible either. However, if you wish to use a sequence value for persistent outside-the-database purposes, ensure that the ",(0,a.jsx)(n.code,{children:"nextval()"})," call has been committed before doing so."]}),"\n",(0,a.jsx)(n.h2,{id:"alter-a-sequence",children:"Alter a sequence"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.a,{href:"/docs/next/sql-stmts/alter-sequence",children:(0,a.jsx)(n.code,{children:"ALTER SEQUENCE"})})," command changes the attributes of an existing sequence. You can alter the sequence start, minimum, maximum, and increment values. You can also restart the sequence at the start value or at a specified value."]}),"\n",(0,a.jsxs)(n.p,{children:["Any parameters not set in the ",(0,a.jsx)(n.code,{children:"ALTER SEQUENCE"})," command retain their prior settings."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"ALTER SEQUENCE sequence START WITH start_value"})," sets the sequence's ",(0,a.jsx)(n.code,{children:"start_value"})," attribute to the new starting value. It has no effect on the ",(0,a.jsx)(n.code,{children:"last_value"})," attribute or the value returned by the ",(0,a.jsx)(n.code,{children:"nextval(sequence)"})," function."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"ALTER SEQUENCE sequence RESTART"})," resets the sequence's ",(0,a.jsx)(n.code,{children:"last_value"})," attribute to the current value of the ",(0,a.jsx)(n.code,{children:"start_value"})," attribute and the ",(0,a.jsx)(n.code,{children:"is_called"})," attribute to ",(0,a.jsx)(n.code,{children:"false"}),". The next call to the ",(0,a.jsx)(n.code,{children:"nextval(sequence)"})," function returns ",(0,a.jsx)(n.code,{children:"start_value"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"ALTER SEQUENCE sequence RESTART WITH restart_value"})," sets the sequence's ",(0,a.jsx)(n.code,{children:"last_value"})," attribute to the new value and the ",(0,a.jsx)(n.code,{children:"is_called"})," attribute to ",(0,a.jsx)(n.code,{children:"false"}),". The next call to the ",(0,a.jsx)(n.code,{children:"nextval(sequence)"})," returns ",(0,a.jsx)(n.code,{children:"restart_value"}),". This is the equivalent of calling ",(0,a.jsx)(n.code,{children:"setval(sequence, restart_value, false)"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["The following command restarts the sequence named ",(0,a.jsx)(n.code,{children:"myserial"})," at value ",(0,a.jsx)(n.code,{children:"105"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"ALTER SEQUENCE myserial RESTART WITH 105;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"drop-a-sequence",children:"Drop a sequence"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.a,{href:"/docs/next/sql-stmts/drop-sequence",children:(0,a.jsx)(n.code,{children:"DROP SEQUENCE"})})," command removes a sequence. For example, the following command removes the sequence named ",(0,a.jsx)(n.code,{children:"myserial"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"DROP SEQUENCE myserial;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"specify-a-sequence-as-the-default-value-for-a-column",children:"Specify a sequence as the default value for a column"}),"\n",(0,a.jsxs)(n.p,{children:["You can reference a sequence directly in the ",(0,a.jsx)(n.a,{href:"/docs/next/sql-stmts/create-table",children:(0,a.jsx)(n.code,{children:"CREATE TABLE"})})," command in addition to using the ",(0,a.jsx)(n.code,{children:"SERIAL"})," or ",(0,a.jsx)(n.code,{children:"BIGSERIAL"})," types. For example:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE tablename ( id INT4 DEFAULT nextval('myserial'), name text );\n"})}),"\n",(0,a.jsx)(n.p,{children:"You can also alter a table column to set its default value to a sequence counter:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE tablename ALTER COLUMN id SET DEFAULT nextval('myserial');\n"})}),"\n",(0,a.jsx)(n.h2,{id:"sequence-wraparound",children:"Sequence wraparound"}),"\n",(0,a.jsxs)(n.p,{children:["By default, a sequence does not wrap around. That is, when a sequence reaches the max value (",(0,a.jsx)(n.code,{children:"+32767"})," for ",(0,a.jsx)(n.code,{children:"SMALLSERIAL"}),", ",(0,a.jsx)(n.code,{children:"+2147483647"})," for ",(0,a.jsx)(n.code,{children:"SERIAL"}),", ",(0,a.jsx)(n.code,{children:"+9223372036854775807"})," for ",(0,a.jsx)(n.code,{children:"BIGSERIAL"}),"), every subsequent ",(0,a.jsx)(n.code,{children:"nextval()"})," call produces an error. You can alter a sequence to make it cycle around and start at ",(0,a.jsx)(n.code,{children:"1"})," again:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"ALTER SEQUENCE myserial CYCLE;\n"})}),"\n",(0,a.jsx)(n.p,{children:"You can also specify the wraparound behaviour when you create the sequence:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE SEQUENCE myserial CYCLE;\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>r});var a=t(67294);const s={},c=a.createContext(s);function r(e){const n=a.useContext(c);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);