"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[29139],{46009:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>c,contentTitle:()=>s,default:()=>l,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var t=r(85893),n=r(11151);const i={title:"Restore Coordinator Mirroring After a Recovery"},s="Restore Coordinator Mirroring After a Recovery",a={id:"sys-admin/high-availability/restore-coordinator-mirroring-after-a-recovery",title:"Restore Coordinator Mirroring After a Recovery",description:"After you activate a standby coordinator for recovery, the standby coordinator becomes the primary coordinator. You can continue running that instance as the primary coordinator if it has the same capabilities and dependability as the original coordinator host.",source:"@site/docs/sys-admin/high-availability/restore-coordinator-mirroring-after-a-recovery.md",sourceDirName:"sys-admin/high-availability",slug:"/sys-admin/high-availability/restore-coordinator-mirroring-after-a-recovery",permalink:"/docs/next/sys-admin/high-availability/restore-coordinator-mirroring-after-a-recovery",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/sys-admin/high-availability/restore-coordinator-mirroring-after-a-recovery.md",tags:[],version:"current",lastUpdatedBy:"TomShawn",lastUpdatedAt:1761905913,formattedLastUpdatedAt:"Oct 31, 2025",frontMatter:{title:"Restore Coordinator Mirroring After a Recovery"},sidebar:"docsbars",previous:{title:"Recover a Failed Coordinator",permalink:"/docs/next/sys-admin/high-availability/recover-a-failed-coordinator"},next:{title:"Expand a Cloudberry System",permalink:"/docs/next/sys-admin/expand-cluster/expand-a-db-system"}},c={},d=[{value:"To restore the coordinator mirroring after a recovery",id:"to-restore-the-coordinator-mirroring-after-a-recovery",level:2},{value:"To restore the coordinator and standby instances on original hosts (optional)",id:"to-restore-the-coordinator-and-standby-instances-on-original-hosts-optional",level:2},{value:"To check the status of the coordinator mirroring process (optional)",id:"to-check-the-status-of-the-coordinator-mirroring-process-optional",level:2}];function h(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,n.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h1,{id:"restore-coordinator-mirroring-after-a-recovery",children:"Restore Coordinator Mirroring After a Recovery"}),"\n",(0,t.jsx)(o.p,{children:"After you activate a standby coordinator for recovery, the standby coordinator becomes the primary coordinator. You can continue running that instance as the primary coordinator if it has the same capabilities and dependability as the original coordinator host."}),"\n",(0,t.jsxs)(o.p,{children:["You must initialize a new standby coordinator to continue providing coordinator mirroring unless you have already done so while activating the prior standby coordinator. Run ",(0,t.jsx)(o.a,{href:"/docs/next/sys-utilities/gpinitstandby",children:(0,t.jsx)(o.code,{children:"gpinitstandby"})})," on the active coordinator host to configure a new standby coordinator. See ",(0,t.jsx)(o.a,{href:"/docs/next/sys-admin/high-availability/enable-coordinator-mirroring",children:"Enabling Coordinator Mirroring"}),"."]}),"\n",(0,t.jsx)(o.p,{children:"You can restore the primary and standby coordinator instances on the original hosts. This process swaps the roles of the primary and standby coordinator hosts, and it should be performed only if you strongly prefer to run the coordinator instances on the same hosts they occupied prior to the recovery scenario."}),"\n",(0,t.jsxs)(o.admonition,{type:"note",children:[(0,t.jsx)(o.p,{children:"Restoring the primary and standby coordinator instances to their original hosts is not an online operation. The coordinator host must be stopped to perform the operation."}),(0,t.jsxs)(o.p,{children:["For information about the Apache Cloudberry utilities, see the ",(0,t.jsx)(o.a,{href:"/docs/next/sys-utilities/",children:"Apache Cloudberry Utility Guide"}),"."]})]}),"\n",(0,t.jsx)(o.h2,{id:"to-restore-the-coordinator-mirroring-after-a-recovery",children:"To restore the coordinator mirroring after a recovery"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsx)(o.p,{children:"Ensure the original coordinator host is in dependable running condition; ensure the cause of the original failure is fixed."}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsxs)(o.p,{children:["On the original coordinator host, move or remove the data directory, ",(0,t.jsx)(o.code,{children:"gpseg-1"}),". This example moves the directory to ",(0,t.jsx)(o.code,{children:"backup_gpseg-1"}),":"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ mv /data/coordinator/gpseg-1 /data/coordinator/backup_gpseg-1\n"})}),"\n",(0,t.jsx)(o.p,{children:"You can remove the backup directory once the standby is successfully configured."}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsx)(o.p,{children:"Initialize a standby coordinator on the original coordinator host. For example, run this command from the current coordinator host, scdw:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ gpinitstandby -s cdw\n"})}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsxs)(o.p,{children:["After the initialization completes, check the status of standby coordinator, cdw. Run ",(0,t.jsx)(o.a,{href:"/docs/next/sys-utilities/gpstate",children:(0,t.jsx)(o.code,{children:"gpstate"})})," with the ",(0,t.jsx)(o.code,{children:"-f"})," option to check the standby coordinator status:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ gpstate -f\n"})}),"\n",(0,t.jsxs)(o.p,{children:["The standby coordinator status should be ",(0,t.jsx)(o.code,{children:"passive"}),", and the WAL sender state should be ",(0,t.jsx)(o.code,{children:"streaming"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"to-restore-the-coordinator-and-standby-instances-on-original-hosts-optional",children:"To restore the coordinator and standby instances on original hosts (optional)"}),"\n",(0,t.jsx)(o.admonition,{type:"note",children:(0,t.jsxs)(o.p,{children:["Before performing the steps in this section, be sure you have followed the steps to restore coordinator mirroring after a recovery, as described in the ",(0,t.jsx)(o.a,{href:"#to-restore-the-coordinator-mirroring-after-a-recovery",children:"To restore the coordinator mirroring after a recovery"}),"previous section."]})}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsx)(o.p,{children:"Stop the Apache Cloudberry coordinator instance on the standby coordinator. For example:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ gpstop -m\n"})}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsxs)(o.p,{children:["Run the ",(0,t.jsx)(o.code,{children:"gpactivatestandby"})," utility from the original coordinator host, cdw, that is currently a standby coordinator. For example:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ gpactivatestandby -d $COORDINATOR_DATA_DIRECTORY\n"})}),"\n",(0,t.jsxs)(o.p,{children:["Where the ",(0,t.jsx)(o.code,{children:"-d"})," option specifies the data directory of the host you are activating."]}),"\n",(0,t.jsx)(o.admonition,{type:"note",children:(0,t.jsxs)(o.p,{children:["Before running ",(0,t.jsx)(o.code,{children:"gpactivatestandby"}),", be sure to run ",(0,t.jsx)(o.code,{children:"gpstate -f"})," to confirm that the standby coordinator is synchronized with the current coordinator node. If synchronized, the final line of the ",(0,t.jsx)(o.code,{children:"gpstate -f"})," output will look similar to this: ",(0,t.jsx)(o.code,{children:"20230607:06:50:06:004205 gpstate:test1-m:gpadmin-[INFO]:--Sync state: sync"}),"."]})}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsxs)(o.p,{children:["After the utility completes, run ",(0,t.jsx)(o.code,{children:"gpstate"})," with the ",(0,t.jsx)(o.code,{children:"-b"})," option to display a summary of the system status:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ gpstate -b\n"})}),"\n",(0,t.jsxs)(o.p,{children:["The coordinator instance status should be ",(0,t.jsx)(o.code,{children:"Active"}),". When a standby coordinator is not configured, the command displays ",(0,t.jsx)(o.code,{children:"No coordinator standby configured"})," for the standby coordinator state."]}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsxs)(o.p,{children:["On the standby coordinator host, move or remove the data directory, ",(0,t.jsx)(o.code,{children:"gpseg-1"}),". This example moves the directory:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ mv /data/coordinator/gpseg-1 /data//backup_gpseg-1\n"})}),"\n",(0,t.jsx)(o.p,{children:"You can remove the backup directory once the standby is successfully configured."}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsx)(o.p,{children:"After the original coordinator host runs the primary Apache Cloudberry coordinator, you can initialize a standby coordinator on the original standby coordinator host. For example:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ gpinitstandby -s scdw\n"})}),"\n",(0,t.jsxs)(o.p,{children:["After the command completes, you can run the ",(0,t.jsx)(o.code,{children:"gpstate -f"})," command on the primary coordinator host, to check the standby coordinator status."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"to-check-the-status-of-the-coordinator-mirroring-process-optional",children:"To check the status of the coordinator mirroring process (optional)"}),"\n",(0,t.jsxs)(o.p,{children:["You can run the ",(0,t.jsx)(o.code,{children:"gpstate"})," utility with the ",(0,t.jsx)(o.code,{children:"-f"})," option to display details of the standby coordinator host."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"$ gpstate -f\n"})}),"\n",(0,t.jsxs)(o.p,{children:["The standby coordinator status should be ",(0,t.jsx)(o.code,{children:"passive"}),", and the WAL sender state should be ",(0,t.jsx)(o.code,{children:"streaming"}),"."]})]})}function l(e={}){const{wrapper:o}={...(0,n.a)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},11151:(e,o,r)=>{r.d(o,{Z:()=>a,a:()=>s});var t=r(67294);const n={},i=t.createContext(n);function s(e){const o=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),t.createElement(i.Provider,{value:o},e.children)}}}]);