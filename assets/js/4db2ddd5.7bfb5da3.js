"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[30625],{9011:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>d,toc:()=>l});var n=s(85893),i=s(11151);const a={title:"Redistribute Tables"},r="Redistribute Tables",d={id:"sys-admin/expand-cluster/redistribute-tables",title:"Redistribute Tables",description:"Redistribute tables to balance existing data over the newly expanded cluster.",source:"@site/docs/sys-admin/expand-cluster/redistribute-tables.md",sourceDirName:"sys-admin/expand-cluster",slug:"/sys-admin/expand-cluster/redistribute-tables",permalink:"/docs/next/sys-admin/expand-cluster/redistribute-tables",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/sys-admin/expand-cluster/redistribute-tables.md",tags:[],version:"current",lastUpdatedBy:"TomShawn",lastUpdatedAt:1761905913,formattedLastUpdatedAt:"Oct 31, 2025",frontMatter:{title:"Redistribute Tables"},sidebar:"docsbars",previous:{title:"Initialize New Segments",permalink:"/docs/next/sys-admin/expand-cluster/initialize-new-segments"},next:{title:"Post Expansion Tasks",permalink:"/docs/next/sys-admin/expand-cluster/post-expansion-tasks"}},o={},l=[{value:"Rank tables for redistribution",id:"rank-tables-for-redistribution",level:2},{value:"Redistribute tables using gpexpand",id:"redistribute-tables-using-gpexpand",level:2},{value:"To redistribute tables with gpexpand",id:"to-redistribute-tables-with-gpexpand",level:3},{value:"Monitor table redistribution",id:"monitor-table-redistribution",level:2},{value:"View expansion status",id:"view-expansion-status",level:3},{value:"View table status",id:"view-table-status",level:3}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"redistribute-tables",children:"Redistribute Tables"}),"\n",(0,n.jsx)(t.p,{children:"Redistribute tables to balance existing data over the newly expanded cluster."}),"\n",(0,n.jsxs)(t.p,{children:["After creating an expansion schema, you can redistribute tables across the entire system with ",(0,n.jsx)(t.a,{href:"/docs/next/sys-utilities/gpexpand",children:(0,n.jsx)(t.code,{children:"gpexpand"})}),". Plan to run this during low-use hours when the utility's CPU usage and table locks have minimal impact on operations. Rank tables to redistribute the largest or most critical tables first."]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["When redistributing data, Apache Cloudberry must be running in production mode. Apache Cloudberry cannot be in restricted mode or in coordinator mode. The ",(0,n.jsx)(t.a,{href:"/docs/next/sys-utilities/gpstart",children:(0,n.jsx)(t.code,{children:"gpstart"})})," options ",(0,n.jsx)(t.code,{children:"-R"})," or ",(0,n.jsx)(t.code,{children:"-m"})," cannot be specified to start Apache Cloudberry."]})}),"\n",(0,n.jsx)(t.p,{children:"While table redistribution is underway, any new tables or partitions created are distributed across all segments exactly as they would be under normal operating conditions. Queries can access all segments, even before the relevant data is redistributed to tables on the new segments. The table or partition being redistributed is locked and unavailable for read or write operations. When its redistribution completes, normal operations resume."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"#rank-tables-for-redistribution",children:"Ranking Tables for Redistribution"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"#redistribute-tables-using-gpexpand",children:"Redistributing Tables Using gpexpand"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"#monitor-table-redistribution",children:"Monitoring Table Redistribution"})}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"rank-tables-for-redistribution",children:"Rank tables for redistribution"}),"\n",(0,n.jsxs)(t.p,{children:["For large systems, you can control the table redistribution order. Adjust tables' ",(0,n.jsx)(t.code,{children:"rank"})," values in the expansion schema to prioritize heavily-used tables and minimize performance impact. Available free disk space can affect table ranking; see ",(0,n.jsx)(t.a,{href:"/docs/next/sys-admin/expand-cluster/plan-system-expansion",children:"Managing Redistribution in Large-Scale Cloudberry Systems"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["To rank tables for redistribution by updating ",(0,n.jsx)(t.code,{children:"rank"})," values in ",(0,n.jsx)(t.a,{href:"/docs/next/sys-utilities/gpexpand",children:"gpexpand.status_detail"}),", connect to Apache Cloudberry using ",(0,n.jsx)(t.code,{children:"psql"})," or another supported client. Update ",(0,n.jsx)(t.em,{children:"gpexpand.status_detail"})," with commands such as:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"=> UPDATE gpexpand.status_detail SET rank=10;\n\n=> UPDATE gpexpand.status_detail SET rank=1 WHERE fq_name = 'public.lineitem';\n=> UPDATE gpexpand.status_detail SET rank=2 WHERE fq_name = 'public.orders';\n"})}),"\n",(0,n.jsxs)(t.p,{children:["These commands lower the priority of all tables to ",(0,n.jsx)(t.code,{children:"10"})," and then assign a rank of ",(0,n.jsx)(t.code,{children:"1"})," to ",(0,n.jsx)(t.code,{children:"lineitem"})," and a rank of ",(0,n.jsx)(t.code,{children:"2"})," to ",(0,n.jsx)(t.code,{children:"orders"}),". When table redistribution begins, ",(0,n.jsx)(t.code,{children:"lineitem"})," is redistributed first, followed by ",(0,n.jsx)(t.code,{children:"orders"})," and all other tables in ",(0,n.jsx)(t.em,{children:"gpexpand.status_detail"}),". To exclude a table from redistribution, remove the table from the ",(0,n.jsx)(t.em,{children:"gpexpand.status_detail"})," table."]}),"\n",(0,n.jsx)(t.h2,{id:"redistribute-tables-using-gpexpand",children:"Redistribute tables using gpexpand"}),"\n",(0,n.jsx)(t.h3,{id:"to-redistribute-tables-with-gpexpand",children:"To redistribute tables with gpexpand"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Log in on the coordinator host as the user who will run your Apache Cloudberry system, for example, ",(0,n.jsx)(t.code,{children:"gpadmin"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Run the ",(0,n.jsx)(t.code,{children:"gpexpand"})," utility. You can use the ",(0,n.jsx)(t.code,{children:"-d"})," or ",(0,n.jsx)(t.code,{children:"-e"})," option to define the expansion session time period. For example, to run the utility for up to 60 consecutive hours:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"$ gpexpand -d 60:00:00\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The utility redistributes tables until the last table in the schema completes or it reaches the specified duration or end time. ",(0,n.jsx)(t.code,{children:"gpexpand"})," updates the status and time in ",(0,n.jsx)(t.code,{children:"gpexpand.status"})," when a session starts and finishes."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["After completing table redistribution, run the ",(0,n.jsx)(t.code,{children:"VACUUM ANALYZE"})," and ",(0,n.jsx)(t.code,{children:"REINDEX"}),"commands on the catalog tables to update table statistics, and rebuild indexes. See ",(0,n.jsx)(t.a,{href:"/docs/next/sys-admin/routine-maintain-tasks",children:"Routine Vacuum and Analyze"})," and ",(0,n.jsx)(t.a,{href:"/docs/next/sql-stmts/vacuum",children:(0,n.jsx)(t.code,{children:"VACUUM"})}),"."]})}),"\n",(0,n.jsx)(t.h2,{id:"monitor-table-redistribution",children:"Monitor table redistribution"}),"\n",(0,n.jsx)(t.p,{children:"During the table redistribution process you can query the expansion schema to view:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["a current progress summary, the estimated rate of table redistribution, and the estimated time to completion. Use ",(0,n.jsx)(t.code,{children:"gpexpand.expansion_progress"}),", as described in ",(0,n.jsx)(t.a,{href:"#view-expansion-status",children:"Viewing Expansion Status"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["per-table status information, using ",(0,n.jsx)(t.code,{children:"gpexpand.status_detail"}),". See ",(0,n.jsx)(t.a,{href:"#view-table-status",children:"Viewing Table Status"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["See also ",(0,n.jsx)(t.a,{href:"/docs/next/sys-admin/expand-cluster/plan-system-expansion",children:"Monitoring the Cluster Expansion State"})," for information about monitoring the overall expansion progress with the ",(0,n.jsx)(t.code,{children:"gpstate"})," utility."]}),"\n",(0,n.jsx)(t.h3,{id:"view-expansion-status",children:"View expansion status"}),"\n",(0,n.jsxs)(t.p,{children:["After the first table completes redistribution, ",(0,n.jsx)(t.em,{children:"gpexpand.expansion_progress"})," calculates its estimates and refreshes them based on all tables' redistribution rates. Calculations restart each time you start a table redistribution session with ",(0,n.jsx)(t.code,{children:"gpexpand"}),". To monitor progress, connect to Apache Cloudberry using ",(0,n.jsx)(t.code,{children:"psql"})," or another supported client; query ",(0,n.jsx)(t.em,{children:"gpexpand.expansion_progress"})," with a command like the following:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"=# SELECT * FROM gpexpand.expansion_progress;\n             name             |         value\n------------------------------+-----------------------\n Bytes Left                   | 5534842880\n Bytes Done                   | 142475264\n Estimated Expansion Rate     | 680.75667095996092 MB/s\n Estimated Time to Completion | 00:01:01.008047\n Tables Expanded              | 4\n Tables Left                  | 4\n(6 rows)\n"})}),"\n",(0,n.jsx)(t.h3,{id:"view-table-status",children:"View table status"}),"\n",(0,n.jsxs)(t.p,{children:["The table ",(0,n.jsx)(t.em,{children:"gpexpand.status_detail"})," stores status, time of last update, and more facts about each table in the schema. To see a table's status, connect to Apache Cloudberry using ",(0,n.jsx)(t.code,{children:"psql"})," or another supported client and query ",(0,n.jsx)(t.em,{children:"gpexpand.status_detail"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"=> SELECT status, expansion_started, source_bytes FROM\ngpexpand.status_detail WHERE fq_name = 'public.sales';\n  status   |     expansion_started      | source_bytes\n-----------+----------------------------+--------------\n COMPLETED | 2017-02-20 10:54:10.043869 |   4929748992\n(1 row)\n"})})]})}function u(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},11151:(e,t,s)=>{s.d(t,{Z:()=>d,a:()=>r});var n=s(67294);const i={},a=n.createContext(i);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);