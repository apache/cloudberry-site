"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[28538],{15527:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var s=t(85893),i=t(11151);const r={title:"Encrypt Data and Database Connections"},o="Encrypt Data and Database Connections",a={id:"security/encrypt-data-and-db-connections",title:"Encrypt Data and Database Connections",description:"This document describes how to encrypt data at rest in the database or in transit over the network, to protect from eavesdroppers or man-in-the-middle attacks.",source:"@site/versioned_docs/version-2.x/security/encrypt-data-and-db-connections.md",sourceDirName:"security",slug:"/security/encrypt-data-and-db-connections",permalink:"/docs/security/encrypt-data-and-db-connections",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/security/encrypt-data-and-db-connections.md",tags:[],version:"2.x",lastUpdatedBy:"Dianjin Wang",lastUpdatedAt:1756369829,formattedLastUpdatedAt:"Aug 28, 2025",frontMatter:{title:"Encrypt Data and Database Connections"},sidebar:"docsbars",previous:{title:"Configure Database Authorization",permalink:"/docs/security/configure-db-auth"},next:{title:"Transparent Data Encryption",permalink:"/docs/security/transparent-data-encryption"}},c={},l=[{value:"Encrypt gpfdist connections",id:"encrypt-gpfdist-connections",level:2},{value:"Encrypt data at rest with pgcrypto",id:"encrypt-data-at-rest-with-pgcrypto",level:2},{value:"Create PGP keys",id:"create-pgp-keys",level:3},{value:"Encrypt data in tables using PGP",id:"encrypt-data-in-tables-using-pgp",level:3},{value:"Key management",id:"key-management",level:3},{value:"Encrypt data using TDE",id:"encrypt-data-using-tde",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"encrypt-data-and-database-connections",children:"Encrypt Data and Database Connections"}),"\n",(0,s.jsx)(n.p,{children:"This document describes how to encrypt data at rest in the database or in transit over the network, to protect from eavesdroppers or man-in-the-middle attacks."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Connections between clients and the coordinator database can be encrypted with SSL. This is enabled with the ",(0,s.jsx)(n.code,{children:"ssl"})," server configuration parameter, which is ",(0,s.jsx)(n.code,{children:"off"})," by default. Setting the ",(0,s.jsx)(n.code,{children:"ssl"})," parameter to ",(0,s.jsx)(n.code,{children:"on"})," allows client communications with the coordinator to be encrypted. The coordinator database must be set up for SSL. See ",(0,s.jsx)(n.a,{href:"/docs/security/client-auth#openssl-configuration",children:"OpenSSL Configuration"})," for more about encrypting client connections with SSL."]}),"\n",(0,s.jsxs)(n.li,{children:["Apache Cloudberry allows SSL encryption of data in transit between the Cloudberry parallel file distribution server, ",(0,s.jsx)(n.code,{children:"gpfdist"}),", and segment hosts. See ",(0,s.jsx)(n.a,{href:"#encrypt-gpfdist-connections",children:"Encrypting gpfdist Connections"})," for more information.\xa0"]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"pgcrypto"})," module of encryption/decryption functions protects data at rest in the database. Encryption at the column level protects sensitive information, such as social security numbers or credit card numbers. See ",(0,s.jsx)(n.a,{href:"#encrypt-data-at-rest-with-pgcrypto",children:"Encrypting Data at Rest with pgcrypto"})," for more information."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"encrypt-gpfdist-connections",children:"Encrypt gpfdist connections"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"gpfdists"})," protocol is a secure version of the ",(0,s.jsx)(n.code,{children:"gpfdist"})," protocol that securely identifies the file server and the Apache Cloudberry and encrypts the communications between them. Using ",(0,s.jsx)(n.code,{children:"gpfdists"})," protects against eavesdropping and man-in-the-middle attacks."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"gpfdists"})," protocol implements client/server SSL security with the following notable features:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Client certificates are required."}),"\n",(0,s.jsx)(n.li,{children:"Multilingual certificates are not supported."}),"\n",(0,s.jsx)(n.li,{children:"A Certificate Revocation List (CRL) is not supported."}),"\n",(0,s.jsx)(n.li,{children:"A minimum TLS version of 1.2 is required."}),"\n",(0,s.jsx)(n.li,{children:"SSL renegotiation is supported."}),"\n",(0,s.jsx)(n.li,{children:"The SSL ignore host mismatch parameter is set to false."}),"\n",(0,s.jsxs)(n.li,{children:["Private keys containing a passphrase are not supported for the ",(0,s.jsx)(n.code,{children:"gpfdist"})," file server (server.key) or for the Apache Cloudberry (client.key)."]}),"\n",(0,s.jsxs)(n.li,{children:["It is the user's responsibility to issue certificates that are appropriate for the operating system in use. Generally, converting certificates to the required format is supported, for example using the SSL Converter at ",(0,s.jsx)(n.a,{href:"http://www.commoncriteriaportal.org/products/?expand#ALL",children:"https://www.sslshopper.com/ssl-converter.html"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.code,{children:"gpfdist"})," server started with the ",(0,s.jsx)(n.code,{children:"--ssl"})," option can only communicate with the ",(0,s.jsx)(n.code,{children:"gpfdists"})," protocol. A ",(0,s.jsx)(n.code,{children:"gpfdist"})," server started without the ",(0,s.jsx)(n.code,{children:"--ssl"})," option can only communicate with the ",(0,s.jsx)(n.code,{children:"gpfdist"})," protocol. For more detail about ",(0,s.jsx)(n.code,{children:"gpfdist"}),", see ",(0,s.jsx)(n.a,{href:"/docs/data-loading/load-data-using-gpfdist",children:(0,s.jsx)(n.code,{children:"gpfdist"})}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["There are two ways to enable the ",(0,s.jsx)(n.code,{children:"gpfdists"})," protocol:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"gpfdist"})," with the ",(0,s.jsx)(n.code,{children:"--ssl"})," option and then use the ",(0,s.jsx)(n.code,{children:"gpfdists"})," protocol in the ",(0,s.jsx)(n.code,{children:"LOCATION"})," clause of a ",(0,s.jsx)(n.code,{children:"CREATE EXTERNAL TABLE"})," statement."]}),"\n",(0,s.jsxs)(n.li,{children:["Use a YAML control file with the SSL option set to true and run ",(0,s.jsx)(n.code,{children:"gpload"}),". Running ",(0,s.jsx)(n.code,{children:"gpload"})," starts the ",(0,s.jsx)(n.code,{children:"gpfdist"})," server with the ",(0,s.jsx)(n.code,{children:"--ssl"})," option and then uses the ",(0,s.jsx)(n.code,{children:"gpfdists"})," protocol."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When using gpfdists, the following client certificates must be located in the ",(0,s.jsx)(n.code,{children:"$PGDATA/gpfdists"})," directory on each segment:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The client certificate file, ",(0,s.jsx)(n.code,{children:"client.crt"})]}),"\n",(0,s.jsxs)(n.li,{children:["The client private key file, ",(0,s.jsx)(n.code,{children:"client.key"})]}),"\n",(0,s.jsxs)(n.li,{children:["The trusted certificate authorities, ",(0,s.jsx)(n.code,{children:"root.crt"})]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsx)(n.p,{children:"Do not protect the private key with a passphrase. The server does not prompt for a passphrase for the private key, and loading data fails with an error if one is required."})}),"\n",(0,s.jsxs)(n.p,{children:["When using ",(0,s.jsx)(n.code,{children:"gpload"})," with SSL you specify the location of the server certificates in the YAML control file. When using ",(0,s.jsx)(n.code,{children:"gpfdist"})," with SSL, you specify the location of the server certificates with the --ssl option."]}),"\n",(0,s.jsxs)(n.p,{children:["The following example shows how to securely load data into an external table. The example creates a readable external table named ",(0,s.jsx)(n.code,{children:"ext_expenses"})," from all files with the ",(0,s.jsx)(n.code,{children:"txt"})," extension, using the ",(0,s.jsx)(n.code,{children:"gpfdists"})," protocol. The files are formatted with a pipe (",(0,s.jsx)(n.code,{children:"|"}),") as the column delimiter and an empty space as null."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Run ",(0,s.jsx)(n.code,{children:"gpfdist"})," with the ",(0,s.jsx)(n.code,{children:"--ssl"})," option on the segment hosts."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Log into the database and run the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"=# CREATE EXTERNAL TABLE ext_expenses \n   ( name text, date date, amount float4, category text, desc1 text )\nLOCATION ('gpfdists://etlhost-1:8081/*.txt', 'gpfdists://etlhost-2:8082/*.txt')\nFORMAT 'TEXT' ( DELIMITER '|' NULL ' ') ;\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"encrypt-data-at-rest-with-pgcrypto",children:"Encrypt data at rest with pgcrypto"}),"\n",(0,s.jsx)(n.p,{children:"The pgcrypto module for Apache Cloudberry provides functions for encrypting data at rest in the database. Administrators can encrypt columns with sensitive information, such as social security numbers or credit card numbers, to provide an extra layer of protection. Database data stored in encrypted form cannot be read by users who do not have the encryption key, and the data cannot be read directly from disk."}),"\n",(0,s.jsx)(n.p,{children:"pgcrypto is installed by default when you install Apache Cloudberry. You must explicitly enable pgcrypto in each database in which you want to use the module."}),"\n",(0,s.jsx)(n.p,{children:"pgcrypto allows PGP encryption using symmetric and asymmetric encryption. Symmetric encryption encrypts and decrypts data using the same key and is faster than asymmetric encryption. It is the preferred method in an environment where exchanging secret keys is not an issue. With asymmetric encryption, a public key is used to encrypt data and a private key is used to decrypt data. This is slower then symmetric encryption and it requires a stronger key."}),"\n",(0,s.jsx)(n.p,{children:"Using pgcrypto always comes at the cost of performance and maintainability. It is important to use encryption only with the data that requires it. Also, keep in mind that you cannot search encrypted data by indexing the data."}),"\n",(0,s.jsx)(n.p,{children:"Before you implement in-database encryption, consider the following PGP limitations."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No support for signing. That also means that it is not checked whether the encryption sub-key belongs to the coordinator key."}),"\n",(0,s.jsx)(n.li,{children:"No support for encryption key as coordinator key. This practice is generally discouraged, so this limitation should not be a problem."}),"\n",(0,s.jsx)(n.li,{children:"No support for several subkeys. This may seem like a problem, as this is common practice. On the other hand, you should not use your regular GPG/PGP keys with pgcrypto, but create new ones, as the usage scenario is rather different."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Apache Cloudberry is compiled with zlib by default; this allows PGP encryption functions to compress data before encrypting. When compiled with OpenSSL, more algorithms will be available."}),"\n",(0,s.jsx)(n.p,{children:"Because pgcrypto functions run inside the database server, the data and passwords move between pgcrypto and the client application in clear-text. For optimal security, you should connect locally or use SSL connections and you should trust both the system and database administrators."}),"\n",(0,s.jsx)(n.p,{children:"pgcrypto configures itself according to the findings of the main PostgreSQL configure script."}),"\n",(0,s.jsxs)(n.p,{children:["When compiled with ",(0,s.jsx)(n.code,{children:"zlib"}),", pgcrypto encryption functions are able to compress data before encrypting."]}),"\n",(0,s.jsx)(n.p,{children:"Pgcrypto has various levels of encryption ranging from basic to advanced built-in functions. The following table shows the supported encryption algorithms."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Value functionality"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Built-in"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"With OpenSSL"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"MD5"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"SHA1"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"SHA224/256/384/512"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Other digest algorithms"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"no"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Blowfish"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"AES"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"DES/3DES/CAST5"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"no"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Raw Encryption"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"PGP Symmetric-Key"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"PGP Public Key"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"yes"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"create-pgp-keys",children:"Create PGP keys"}),"\n",(0,s.jsx)(n.p,{children:"To use PGP asymmetric encryption in Apache Cloudberry, you must first create public and private keys and install them."}),"\n",(0,s.jsxs)(n.p,{children:["This section assumes you are installing Apache Cloudberry on a Linux machine with the Gnu Privacy Guard (",(0,s.jsx)(n.code,{children:"gpg"}),") command line tool. Use the latest version of GPG to create keys. Download and install Gnu Privacy Guard (GPG) for your operating system from ",(0,s.jsx)(n.a,{href:"https://www.gnupg.org/download/",children:"https://www.gnupg.org/download/"}),". On the GnuPG website you will find installers for popular Linux distributions and links for Windows and Mac OS X installers."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"As root, run the following command and choose option 1 from the menu:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# gpg --gen-key \ngpg (GnuPG) 2.0.14; Copyright (C) 2009 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n \ngpg: directory '/root/.gnupg' created\ngpg: new configuration file '/root/.gnupg/gpg.conf' created\ngpg: WARNING: options in '/root/.gnupg/gpg.conf' are not yet active during this run\ngpg: keyring '/root/.gnupg/secring.gpg' created\ngpg: keyring '/root/.gnupg/pubring.gpg' created\nPlease select what kind of key you want:\n (1) RSA and RSA (default)\n (2) DSA and Elgamal\n (3) DSA (sign only)\n (4) RSA (sign only)\nYour selection? **1**\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Respond to the prompts and follow the instructions, as shown in this example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"RSA keys may be between 1024 and 4096 bits long.\nWhat keysize do you want? (2048) Press enter to accept default key size\nRequested keysize is 2048 bits\nPlease specify how long the key should be valid.\n 0 = key does not expire\n <n> = key expires in n days\n <n>w = key expires in n weeks\n <n>m = key expires in n months\n <n>y = key expires in n years\n Key is valid for? (0) **365**\nKey expires at Wed 13 Jan 2016 10:35:39 AM PST\nIs this correct? (y/N) **y**\n\nGnuPG needs to construct a user ID to identify your key.\n\nReal name: **John Doe**\nEmail address: **jdoe@email.com**\nComment: \nYou selected this USER-ID:\n \"John Doe <jdoe@email.com>\"\n\nChange (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? **O**\nYou need a Passphrase to protect your secret key.\n*(For this demo the passphrase is blank.)*\ncan't connect to '/root/.gnupg/S.gpg-agent': No such file or directory\nYou don't want a passphrase - this is probably a *bad* idea!\nI will do it anyway.  You can change your passphrase at any time,\nusing this program with the option \"--edit-key\".\n\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\ngpg: /root/.gnupg/trustdb.gpg: trustdb created\ngpg: key 2027CC30 marked as ultimately trusted\npublic and secret key created and signed.\n\ngpg:  checking the trustdbgpg: \n      3 marginal(s) needed, 1 complete(s) needed, PGP trust model\ngpg:  depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u\ngpg:  next trustdb check due at 2016-01-13\npub   2048R/2027CC30 2015-01-13 [expires: 2016-01-13]\n      Key fingerprint = 7EDA 6AD0 F5E0 400F 4D45   3259 077D 725E 2027 CC30\nuid                  John Doe <jdoe@email.com>\nsub   2048R/4FD2EFBB 2015-01-13 [expires: 2016-01-13]\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"List the PGP keys by entering the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"gpg --list-secret-keys \n/root/.gnupg/secring.gpg\n------------------------\nsec   2048R/2027CC30 2015-01-13 [expires: 2016-01-13]\nuid                  John Doe <jdoe@email.com>\nssb   2048R/4FD2EFBB 2015-01-13\n"})}),"\n",(0,s.jsxs)(n.p,{children:["2027CC30 is the public key and will be used to ",(0,s.jsx)(n.em,{children:"encrypt"})," data in the database. 4FD2EFBB is the private (secret) key and will be used to ",(0,s.jsx)(n.em,{children:"decrypt"})," data."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Export the keys using the following commands:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# gpg -a --export 4FD2EFBB > public.key\n# gpg -a --export-secret-keys 2027CC30 > secret.key\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"https://www.postgresql.org/docs/14/pgcrypto.html",children:"pgcrypto"})," documentation for more information about PGP encryption functions."]}),"\n",(0,s.jsx)(n.h3,{id:"encrypt-data-in-tables-using-pgp",children:"Encrypt data in tables using PGP"}),"\n",(0,s.jsx)(n.p,{children:"This section shows how to encrypt data inserted into a column using the PGP keys you generated."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Dump the contents of the ",(0,s.jsx)(n.code,{children:"public.key"})," file and then copy it to the clipboard:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# cat public.key\n-----BEGIN PGP PUBLIC KEY BLOCK-----\nVersion: GnuPG v2.0.14 (GNU/Linux)\n            \nmQENBFS1Zf0BCADNw8Qvk1V1C36Kfcwd3Kpm/dijPfRyyEwB6PqKyA05jtWiXZTh\n2His1ojSP6LI0cSkIqMU9LAlncecZhRIhBhuVgKlGSgd9texg2nnSL9Admqik/yX\nR5syVKG+qcdWuvyZg9oOOmeyjhc3n+kkbRTEMuM3flbMs8shOwzMvstCUVmuHU/V\nvG5rJAe8PuYDSJCJ74I6w7SOH3RiRIc7IfL6xYddV42l3ctd44bl8/i71hq2UyN2\n/Hbsjii2ymg7ttw3jsWAx2gP9nssDgoy8QDy/o9nNqC8EGlig96ZFnFnE6Pwbhn+\nic8MD0lK5/GAlR6Hc0ZIHf8KEcavruQlikjnABEBAAG0HHRlc3Qga2V5IDx0ZXN0\na2V5QGVtYWlsLmNvbT6JAT4EEwECACgFAlS1Zf0CGwMFCQHhM4AGCwkIBwMCBhUI\nAgkKCwQWAgMBAh4BAheAAAoJEAd9cl4gJ8wwbfwH/3VyVsPkQl1owRJNxvXGt1bY\n7BfrvU52yk+PPZYoes9UpdL3CMRk8gAM9bx5Sk08q2UXSZLC6fFOpEW4uWgmGYf8\nJRoC3ooezTkmCBW8I1bU0qGetzVxopdXLuPGCE7hVWQe9HcSntiTLxGov1mJAwO7\nTAoccXLbyuZh9Rf5vLoQdKzcCyOHh5IqXaQOT100TeFeEpb9TIiwcntg3WCSU5P0\nDGoUAOanjDZ3KE8Qp7V74fhG1EZVzHb8FajR62CXSHFKqpBgiNxnTOk45NbXADn4\neTUXPSnwPi46qoAp9UQogsfGyB1XDOTB2UOqhutAMECaM7VtpePv79i0Z/NfnBe5\nAQ0EVLVl/QEIANabFdQ+8QMCADOipM1bF/JrQt3zUoc4BTqICaxdyzAfz0tUSf/7\nZro2us99GlARqLWd8EqJcl/xmfcJiZyUam6ZAzzFXCgnH5Y1sdtMTJZdLp5WeOjw\ngCWG/ZLu4wzxOFFzDkiPv9RDw6e5MNLtJrSp4hS5o2apKdbO4Ex83O4mJYnav/rE\niDDCWU4T0lhv3hSKCpke6LcwsX+7liozp+aNmP0Ypwfi4hR3UUMP70+V1beFqW2J\nbVLz3lLLouHRgpCzla+PzzbEKs16jq77vG9kqZTCIzXoWaLljuitRlfJkO3vQ9hO\nv/8yAnkcAmowZrIBlyFg2KBzhunYmN2YvkUAEQEAAYkBJQQYAQIADwUCVLVl/QIb\nDAUJAeEzgAAKCRAHfXJeICfMMOHYCACFhInZA9uAM3TC44l+MrgMUJ3rW9izrO48\nWrdTsxR8WkSNbIxJoWnYxYuLyPb/shc9k65huw2SSDkj//0fRrI61FPHQNPSvz62\nWH+N2lasoUaoJjb2kQGhLOnFbJuevkyBylRz+hI/+8rJKcZOjQkmmK8Hkk8qb5x/\nHMUc55H0g2qQAY0BpnJHgOOQ45Q6pk3G2/7Dbek5WJ6K1wUrFy51sNlGWE8pvgEx\n/UUZB+dYqCwtvX0nnBu1KNCmk2AkEcFK3YoliCxomdOxhFOv9AKjjojDyC65KJci\nPv2MikPS2fKOAg1R3LpMa8zDEtl4w3vckPQNrQNnYuUtfj6ZoCxv\n=XZ8J\n-----END PGP PUBLIC KEY BLOCK-----\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Create a table called ",(0,s.jsx)(n.code,{children:"userssn"})," and insert some sensitive data, social security numbers for Bob and Alice, in this example. Paste the public.key contents after ",(0,s.jsx)(n.code,{children:"dearmor("}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CREATE TABLE userssn( ssn_id SERIAL PRIMARY KEY, \n    username varchar(100), ssn bytea); \n\nINSERT INTO userssn(username, ssn)\nSELECT robotccs.username, pgp_pub_encrypt(robotccs.ssn, keys.pubkey) AS ssn\nFROM ( \n        VALUES ('Alice', '123-45-6788'), ('Bob', '123-45-6799')) \n            AS robotccs(username, ssn)\nCROSS JOIN  (SELECT  dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----\nVersion: GnuPG v2.0.14 (GNU/Linux)\n            \nmQENBFS1Zf0BCADNw8Qvk1V1C36Kfcwd3Kpm/dijPfRyyEwB6PqKyA05jtWiXZTh\n2His1ojSP6LI0cSkIqMU9LAlncecZhRIhBhuVgKlGSgd9texg2nnSL9Admqik/yX\nR5syVKG+qcdWuvyZg9oOOmeyjhc3n+kkbRTEMuM3flbMs8shOwzMvstCUVmuHU/V\nvG5rJAe8PuYDSJCJ74I6w7SOH3RiRIc7IfL6xYddV42l3ctd44bl8/i71hq2UyN2\n/Hbsjii2ymg7ttw3jsWAx2gP9nssDgoy8QDy/o9nNqC8EGlig96ZFnFnE6Pwbhn+\nic8MD0lK5/GAlR6Hc0ZIHf8KEcavruQlikjnABEBAAG0HHRlc3Qga2V5IDx0ZXN0\na2V5QGVtYWlsLmNvbT6JAT4EEwECACgFAlS1Zf0CGwMFCQHhM4AGCwkIBwMCBhUI\nAgkKCwQWAgMBAh4BAheAAAoJEAd9cl4gJ8wwbfwH/3VyVsPkQl1owRJNxvXGt1bY\n7BfrvU52yk+PPZYoes9UpdL3CMRk8gAM9bx5Sk08q2UXSZLC6fFOpEW4uWgmGYf8\nJRoC3ooezTkmCBW8I1bU0qGetzVxopdXLuPGCE7hVWQe9HcSntiTLxGov1mJAwO7\nTAoccXLbyuZh9Rf5vLoQdKzcCyOHh5IqXaQOT100TeFeEpb9TIiwcntg3WCSU5P0\nDGoUAOanjDZ3KE8Qp7V74fhG1EZVzHb8FajR62CXSHFKqpBgiNxnTOk45NbXADn4\neTUXPSnwPi46qoAp9UQogsfGyB1XDOTB2UOqhutAMECaM7VtpePv79i0Z/NfnBe5\nAQ0EVLVl/QEIANabFdQ+8QMCADOipM1bF/JrQt3zUoc4BTqICaxdyzAfz0tUSf/7\nZro2us99GlARqLWd8EqJcl/xmfcJiZyUam6ZAzzFXCgnH5Y1sdtMTJZdLp5WeOjw\ngCWG/ZLu4wzxOFFzDkiPv9RDw6e5MNLtJrSp4hS5o2apKdbO4Ex83O4mJYnav/rE\niDDCWU4T0lhv3hSKCpke6LcwsX+7liozp+aNmP0Ypwfi4hR3UUMP70+V1beFqW2J\nbVLz3lLLouHRgpCzla+PzzbEKs16jq77vG9kqZTCIzXoWaLljuitRlfJkO3vQ9hO\nv/8yAnkcAmowZrIBlyFg2KBzhunYmN2YvkUAEQEAAYkBJQQYAQIADwUCVLVl/QIb\nDAUJAeEzgAAKCRAHfXJeICfMMOHYCACFhInZA9uAM3TC44l+MrgMUJ3rW9izrO48\nWrdTsxR8WkSNbIxJoWnYxYuLyPb/shc9k65huw2SSDkj//0fRrI61FPHQNPSvz62\nWH+N2lasoUaoJjb2kQGhLOnFbJuevkyBylRz+hI/+8rJKcZOjQkmmK8Hkk8qb5x/\nHMUc55H0g2qQAY0BpnJHgOOQ45Q6pk3G2/7Dbek5WJ6K1wUrFy51sNlGWE8pvgEx\n/UUZB+dYqCwtvX0nnBu1KNCmk2AkEcFK3YoliCxomdOxhFOv9AKjjojDyC65KJci\nPv2MikPS2fKOAg1R3LpMa8zDEtl4w3vckPQNrQNnYuUtfj6ZoCxv\n=XZ8J\n-----END PGP PUBLIC KEY BLOCK-----' AS pubkey) AS keys;\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Verify that the ",(0,s.jsx)(n.code,{children:"ssn"})," column is encrypted."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"test_db=# select * from userssn;\nssn_id   | 1\nusername | Alice\nssn      | \\301\\300L\\003\\235M%_O\\322\\357\\273\\001\\010\\000\\272\\227\\010\\341\\216\\360\\217C\\020\\261)_\\367\n[\\227\\034\\313:C\\354d<\\337\\006Q\\351('\\2330\\031lX\\263Qf\\341\\262\\200\\3015\\235\\036AK\\242fL+\\315g\\322\n7u\\270*\\304\\361\\355\\220\\021\\330\"\\200%\\264\\274}R\\213\\377\\363\\235\\366\\030\\023)\\364!\\331\\303\\237t\\277=\nf \\015\\004\\242\\231\\263\\225%\\032\\271a\\001\\035\\277\\021\\375X\\232\\304\\305/\\340\\334\\0131\\325\\344[~\\362\\0\n37-\\251\\336\\303\\340\\377_\\011\\275\\301/MY\\334\\343\\245\\244\\372y\\257S\\374\\230\\346\\277\\373W\\346\\230\\276\\\n017fi\\226Q\\307\\012\\326\\3646\\000\\326\\005:E\\364W\\252=zz\\010(:\\343Y\\237\\257iqU\\0326\\350=v0\\362\\327\\350\\\n315G^\\027:K_9\\254\\362\\354\\215<\\001\\304\\357\\331\\355\\323,\\302\\213Fe\\265\\315\\232\\367\\254\\245%(\\\\\\373\n4\\254\\230\\331\\356\\006B\\257\\333\\326H\\022\\013\\353\\216F?\\023\\220\\370\\035vH5/\\227\\344b\\322\\227\\026\\362=\\\n42\\033\\322<\\001}\\243\\224;)\\030zqX\\214\\340\\221\\035\\275U\\345\\327\\214\\032\\351\\223c\\2442\\345\\304K\\016\\\n011\\214\\307\\227\\237\\270\\026'R\\205\\205a~1\\263\\236[\\037C\\260\\031\\205\\374\\245\\317\\033k|\\366\\253\\037\n---------+--------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------------------------------\n------------------------------------------------------------------------------\nssn_id   | 2\nusername | Bob\nssn      | \\301\\300L\\003\\235M%_O\\322\\357\\273\\001\\007\\377t>\\345\\343,\\200\\256\\272\\300\\012\\033M4\\265\\032L\nL[v\\262k\\244\\2435\\264\\232B\\357\\370d9\\375\\011\\002\\327\\235<\\246\\210b\\030\\012\\337@\\226Z\\361\\246\\032\\00\n7'\\012c\\353]\\355d7\\360T\\335\\314\\367\\370;X\\371\\350*\\231\\212\\260B\\010#RQ0\\223\\253c7\\0132b\\355\\242\\233\\34\n1\\000\\370\\370\\366\\013\\022\\357\\005i\\202~\\005\\\\z\\301o\\012\\230Z\\014\\362\\244\\324&\\243g\\351\\362\\325\\375\n\\213\\032\\226$\\2751\\256XR\\346k\\266\\030\\234\\267\\201vUh\\004\\250\\337A\\231\\223u\\247\\366/i\\022\\275\\276\\350\\2\n20\\316\\306|\\203+\\010\\261;\\232\\254tp\\255\\243\\261\\373Rq;\\316w\\357\\006\\207\\374U\\333\\365\\365\\245hg\\031\\005\n\\322\\347ea\\220\\015l\\212g\\337\\264\\336b\\263\\004\\311\\210.4\\340G+\\221\\274D\\035\\375\\2216\\241'\\346a0\\273wE\\2\n12\\342y^\\202\\262|A7\\202t\\240\\333p\\345G\\373\\253\\243oCO\\011\\360\\247\\211\\014\\024{\\272\\271\\322<\\001\\267\n\\347\\240\\005\\213\\0078\\036\\210\\307$\\317\\322\\311\\222\\035\\354\\006<\\266\\264\\004\\376\\251q\\256\\220(+\\030\\\n3270\\013c\\327\\272\\212%\\363\\033\\252\\322\\337\\354\\276\\225\\232\\201\\212^\\304\\210\\2269@\\3230\\370{\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Extract the public.key ID from the database:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"SELECT pgp_key_id(dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----\nVersion: GnuPG v2.0.14 (GNU/Linux)\n\nmQENBFS1Zf0BCADNw8Qvk1V1C36Kfcwd3Kpm/dijPfRyyEwB6PqKyA05jtWiXZTh\n2His1ojSP6LI0cSkIqMU9LAlncecZhRIhBhuVgKlGSgd9texg2nnSL9Admqik/yX\nR5syVKG+qcdWuvyZg9oOOmeyjhc3n+kkbRTEMuM3flbMs8shOwzMvstCUVmuHU/V\nvG5rJAe8PuYDSJCJ74I6w7SOH3RiRIc7IfL6xYddV42l3ctd44bl8/i71hq2UyN2\n/Hbsjii2ymg7ttw3jsWAx2gP9nssDgoy8QDy/o9nNqC8EGlig96ZFnFnE6Pwbhn+\nic8MD0lK5/GAlR6Hc0ZIHf8KEcavruQlikjnABEBAAG0HHRlc3Qga2V5IDx0ZXN0\na2V5QGVtYWlsLmNvbT6JAT4EEwECACgFAlS1Zf0CGwMFCQHhM4AGCwkIBwMCBhUI\nAgkKCwQWAgMBAh4BAheAAAoJEAd9cl4gJ8wwbfwH/3VyVsPkQl1owRJNxvXGt1bY\n7BfrvU52yk+PPZYoes9UpdL3CMRk8gAM9bx5Sk08q2UXSZLC6fFOpEW4uWgmGYf8\nJRoC3ooezTkmCBW8I1bU0qGetzVxopdXLuPGCE7hVWQe9HcSntiTLxGov1mJAwO7\nTAoccXLbyuZh9Rf5vLoQdKzcCyOHh5IqXaQOT100TeFeEpb9TIiwcntg3WCSU5P0\nDGoUAOanjDZ3KE8Qp7V74fhG1EZVzHb8FajR62CXSHFKqpBgiNxnTOk45NbXADn4\neTUXPSnwPi46qoAp9UQogsfGyB1XDOTB2UOqhutAMECaM7VtpePv79i0Z/NfnBe5\nAQ0EVLVl/QEIANabFdQ+8QMCADOipM1bF/JrQt3zUoc4BTqICaxdyzAfz0tUSf/7\nZro2us99GlARqLWd8EqJcl/xmfcJiZyUam6ZAzzFXCgnH5Y1sdtMTJZdLp5WeOjw\ngCWG/ZLu4wzxOFFzDkiPv9RDw6e5MNLtJrSp4hS5o2apKdbO4Ex83O4mJYnav/rE\niDDCWU4T0lhv3hSKCpke6LcwsX+7liozp+aNmP0Ypwfi4hR3UUMP70+V1beFqW2J\nbVLz3lLLouHRgpCzla+PzzbEKs16jq77vG9kqZTCIzXoWaLljuitRlfJkO3vQ9hO\nv/8yAnkcAmowZrIBlyFg2KBzhunYmN2YvkUAEQEAAYkBJQQYAQIADwUCVLVl/QIb\nDAUJAeEzgAAKCRAHfXJeICfMMOHYCACFhInZA9uAM3TC44l+MrgMUJ3rW9izrO48\nWrdTsxR8WkSNbIxJoWnYxYuLyPb/shc9k65huw2SSDkj//0fRrI61FPHQNPSvz62\nWH+N2lasoUaoJjb2kQGhLOnFbJuevkyBylRz+hI/+8rJKcZOjQkmmK8Hkk8qb5x/\nHMUc55H0g2qQAY0BpnJHgOOQ45Q6pk3G2/7Dbek5WJ6K1wUrFy51sNlGWE8pvgEx\n/UUZB+dYqCwtvX0nnBu1KNCmk2AkEcFK3YoliCxomdOxhFOv9AKjjojDyC65KJci\nPv2MikPS2fKOAg1R3LpMa8zDEtl4w3vckPQNrQNnYuUtfj6ZoCxv\n=XZ8J\n-----END PGP PUBLIC KEY BLOCK-----'));\n\npgp_key_id | 9D4D255F4FD2EFBB\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This shows that the PGP key ID used to encrypt the ",(0,s.jsx)(n.code,{children:"ssn"})," column is ",(0,s.jsx)(n.code,{children:"9D4D255F4FD2EFBB"}),". It is recommended to perform this step whenever a new key is created and then store the ID for tracking."]}),"\n",(0,s.jsx)(n.p,{children:"You can use this key to see which key pair was used to encrypt the data:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"SELECT username, pgp_key_id(ssn) As key_used\nFROM userssn;\nusername | Bob\nkey_used | 9D4D255F4FD2EFBB\n---------+-----------------\nusername | Alice\nkey_used | 9D4D255F4FD2EFBB\n\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Different keys may have the same ID. This is rare, but is a normal event. The client application should try to decrypt with each one to see which fits \u2014 like handling ",(0,s.jsx)(n.code,{children:"ANYKEY"}),". See ",(0,s.jsx)(n.a,{href:"https://www.postgresql.org/docs/14/pgcrypto.html",children:(0,s.jsx)(n.code,{children:"pgp_key_id()"})})," in the pgcrypto documentation."]})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Decrypt the data using the private key."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT username, pgp_pub_decrypt(ssn, keys.privkey) \n                 AS decrypted_ssn FROM userssn\n                 CROSS JOIN\n                 (SELECT dearmor('-----BEGIN PGP PRIVATE KEY BLOCK-----\nVersion: GnuPG v2.0.14 (GNU/Linux)\n\n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\n=fa+6\n-----END PGP PRIVATE KEY BLOCK-----') AS privkey) AS keys;\n\nusername | decrypted_ssn \n----------+---------------\n Alice    | 123-45-6788\n Bob      | 123-45-6799\n(2 rows)\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you created a key with passphrase, you may have to enter it here. However for the purpose of this example, the passphrase is blank."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"key-management",children:"Key management"}),"\n",(0,s.jsx)(n.p,{children:"Whether you are using symmetric (single private key) or asymmetric (public and private key) cryptography, it is important to store the coordinator or private key securely. There are many options for storing encryption keys, for example, on a file system, key vault, encrypted USB, trusted platform module (TPM), or hardware security module (HSM)."}),"\n",(0,s.jsx)(n.p,{children:"Consider the following questions when planning for key management:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Where will the keys be stored?"}),"\n",(0,s.jsx)(n.li,{children:"When should keys expire?"}),"\n",(0,s.jsx)(n.li,{children:"How are keys protected?"}),"\n",(0,s.jsx)(n.li,{children:"How are keys accessed?"}),"\n",(0,s.jsx)(n.li,{children:"How can keys be recovered and revoked?"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The Open Web Application Security Project (OWASP) provides a very comprehensive ",(0,s.jsx)(n.a,{href:"https://www.owasp.org/index.php/Cryptographic_Storage_Cheat_Sheet",children:"guide to securing encryption keys"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"encrypt-data-using-tde",children:"Encrypt data using TDE"}),"\n",(0,s.jsx)(n.p,{children:"To meet the requirements for protecting user data security, Apache Cloudberry supports Transparent Data Encryption (TDE)."}),"\n",(0,s.jsx)(n.p,{children:"TDE is a technology used to encrypt database data files:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'"Data" refers to the data in the database.'}),"\n",(0,s.jsx)(n.li,{children:"Files are stored in ciphertext on the hard drive disk and processed in plaintext in memory. TDE is used to protect static data, so it is also known as static data encryption."}),"\n",(0,s.jsx)(n.li,{children:'"Transparent" means users do not need to change their operational habits. TDE automatically manages the encryption/decryption process without user or application intervention.'}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For details, see ",(0,s.jsx)(n.a,{href:"/docs/security/transparent-data-encryption",children:"Transparent Data Encryption"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>o});var s=t(67294);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);