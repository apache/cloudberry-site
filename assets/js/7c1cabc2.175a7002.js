"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[66660],{15563:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var t=i(85893),n=i(11151);const o={title:"Check for Failed Segments"},r="Check for Failed Segments",a={id:"sys-admin/high-availability/check-for-failed-segments",title:"Check for Failed Segments",description:"With mirroring enabled, you can have failed segment instances in the system without interruption of service or any indication that a failure has occurred. You can verify the status of your system using the gpstate utility, by examing the contents of the gpsegmentconfiguration catalog table, or by checking log files.",source:"@site/versioned_docs/version-2.x/sys-admin/high-availability/check-for-failed-segments.md",sourceDirName:"sys-admin/high-availability",slug:"/sys-admin/high-availability/check-for-failed-segments",permalink:"/docs/sys-admin/high-availability/check-for-failed-segments",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/sys-admin/high-availability/check-for-failed-segments.md",tags:[],version:"2.x",lastUpdatedBy:"TomShawn",lastUpdatedAt:1761905913,formattedLastUpdatedAt:"Oct 31, 2025",frontMatter:{title:"Check for Failed Segments"},sidebar:"docsbars",previous:{title:"Understand Segment Recovery",permalink:"/docs/sys-admin/high-availability/understand-segment-recovery"},next:{title:"Recover from Segment Failures",permalink:"/docs/sys-admin/high-availability/recover-from-segment-failures"}},l={},c=[{value:"Check for failed segments using gpstate",id:"check-for-failed-segments-using-gpstate",level:2},{value:"Check for failed segments using the gp_segment_configuration table",id:"check-for-failed-segments-using-the-gp_segment_configuration-table",level:2},{value:"Check for failed segments by examining log files",id:"check-for-failed-segments-by-examining-log-files",level:2},{value:"To check the log files",id:"to-check-the-log-files",level:2}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,n.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"check-for-failed-segments",children:"Check for Failed Segments"}),"\n",(0,t.jsxs)(s.p,{children:["With mirroring enabled, you can have failed segment instances in the system without interruption of service or any indication that a failure has occurred. You can verify the status of your system using the ",(0,t.jsx)(s.code,{children:"gpstate"})," utility, by examing the contents of the ",(0,t.jsx)(s.code,{children:"gp_segment_configuration"})," catalog table, or by checking log files."]}),"\n",(0,t.jsx)(s.h2,{id:"check-for-failed-segments-using-gpstate",children:"Check for failed segments using gpstate"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"gpstate"})," utility provides the status of each individual component of a Apache Cloudberry system, including primary segments, mirror segments, coordinator, and standby coordinator."]}),"\n",(0,t.jsxs)(s.p,{children:["On the coordinator host, run the ",(0,t.jsx)(s.a,{href:"/docs/sys-utilities/gpstate",children:(0,t.jsx)(s.code,{children:"gpstate"})})," utility with the ",(0,t.jsx)(s.code,{children:"-e"})," option to show segment instances with error conditions:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ gpstate -e\n"})}),"\n",(0,t.jsxs)(s.p,{children:["If the utility lists ",(0,t.jsx)(s.code,{children:"Segments with Primary and Mirror Roles Switched"}),", the segment is not in its ",(0,t.jsx)(s.em,{children:"preferred role"})," (the role to which it was assigned at system initialization). This means the system is in a potentially unbalanced state, as some segment hosts may have more active segments than is optimal for top system performance."]}),"\n",(0,t.jsxs)(s.p,{children:["Segments that display the ",(0,t.jsx)(s.code,{children:"Config status"})," as ",(0,t.jsx)(s.code,{children:"Down"})," indicate the corresponding mirror segment is down."]}),"\n",(0,t.jsxs)(s.p,{children:["See ",(0,t.jsx)(s.a,{href:"/docs/sys-admin/high-availability/recover-from-segment-failures",children:"Recovering from Segment Failures"})," for instructions to fix this situation."]}),"\n",(0,t.jsx)(s.h2,{id:"check-for-failed-segments-using-the-gp_segment_configuration-table",children:"Check for failed segments using the gp_segment_configuration table"}),"\n",(0,t.jsxs)(s.p,{children:["To get detailed information about failed segments, you can check the ",(0,t.jsx)(s.a,{href:"/docs/sys-catalogs/sys-tables/gp-segment-configuration",children:(0,t.jsx)(s.code,{children:"gp_segment_configuration"})})," catalog table. For example:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ psql postgres -c \"SELECT * FROM gp_segment_configuration WHERE status='d';\"\n"})}),"\n",(0,t.jsx)(s.p,{children:"For failed segment instances, note the host, port, preferred role, and data directory. This information will help determine the host and segment instances to troubleshoot. To display information about mirror segment instances, run:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ gpstate -m\n"})}),"\n",(0,t.jsx)(s.h2,{id:"check-for-failed-segments-by-examining-log-files",children:"Check for failed segments by examining log files"}),"\n",(0,t.jsxs)(s.p,{children:["Log files can provide information to help determine an error's cause. The coordinator and segment instances each have their own log file in ",(0,t.jsx)(s.code,{children:"log"})," of the data directory. The coordinator log file contains the most information and you should always check it first."]}),"\n",(0,t.jsxs)(s.p,{children:["Use the ",(0,t.jsx)(s.a,{href:"/docs/sys-utilities/gplogfilter",children:(0,t.jsx)(s.code,{children:"gplogfilter"})})," utility to check the Apache Cloudberry log files for additional information. To check the segment log files, run ",(0,t.jsx)(s.code,{children:"gplogfilter"})," on the segment hosts using ",(0,t.jsx)(s.a,{href:"/docs/sys-utilities/gpssh",children:(0,t.jsx)(s.code,{children:"gpssh"})}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"to-check-the-log-files",children:"To check the log files"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Use ",(0,t.jsx)(s.code,{children:"gplogfilter"})," to check the coordinator log file for ",(0,t.jsx)(s.code,{children:"WARNING"}),", ",(0,t.jsx)(s.code,{children:"ERROR"}),", ",(0,t.jsx)(s.code,{children:"FATAL"})," or ",(0,t.jsx)(s.code,{children:"PANIC"})," log level messages:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ gplogfilter -t\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Use ",(0,t.jsx)(s.code,{children:"gpssh"})," to check for ",(0,t.jsx)(s.code,{children:"WARNING"}),", ",(0,t.jsx)(s.code,{children:"ERROR"}),", ",(0,t.jsx)(s.code,{children:"FATAL"}),", or ",(0,t.jsx)(s.code,{children:"PANIC"})," log level messages on each segment instance. For example:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ gpssh -f seg_hosts_file -e 'source \n/usr/local/cloudberry-db/cloudberry-env.sh ; gplogfilter -t \n/data1/primary/*/log/gpdb*.log' > seglog.out\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,n.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,s,i)=>{i.d(s,{Z:()=>a,a:()=>r});var t=i(67294);const n={},o=t.createContext(n);function r(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);