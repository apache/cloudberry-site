"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[80339],{26573:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var i=t(85893),n=t(11151);const r={title:"Common Causes of Performance Issues"},a="Common Causes of Performance Issues",o={id:"performance/common-cause-of-performance-issues",title:"Common Causes of Performance Issues",description:"This document explains the troubleshooting processes for common performance issues and potential solutions to these issues.",source:"@site/docs/performance/common-cause-of-performance-issues.md",sourceDirName:"performance",slug:"/performance/common-cause-of-performance-issues",permalink:"/docs/next/performance/common-cause-of-performance-issues",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/performance/common-cause-of-performance-issues.md",tags:[],version:"current",lastUpdatedBy:"TomShawn",lastUpdatedAt:1758176984,formattedLastUpdatedAt:"Sep 18, 2025",frontMatter:{title:"Common Causes of Performance Issues"},sidebar:"docsbars",previous:{title:"Use Dynamic Tables",permalink:"/docs/next/performance/use-dynamic-tables"},next:{title:"Investigate Performance Issues",permalink:"/docs/next/performance/investigate-performance-issues"}},l={},d=[{value:"Identify hardware and segment failures",id:"identify-hardware-and-segment-failures",level:2},{value:"Manage workload",id:"manage-workload",level:2},{value:"Avoid contention",id:"avoid-contention",level:2},{value:"Maintain database statistics",id:"maintain-database-statistics",level:2},{value:"Identify statistics problems in query plans",id:"identify-statistics-problems-in-query-plans",level:3},{value:"Tune statistics collection",id:"tune-statistics-collection",level:3},{value:"Optimize data distribution",id:"optimize-data-distribution",level:2},{value:"Optimize your database design",id:"optimize-your-database-design",level:2},{value:"Apache Cloudberry maximum limits",id:"apache-cloudberry-maximum-limits",level:3}];function c(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"common-causes-of-performance-issues",children:"Common Causes of Performance Issues"}),"\n",(0,i.jsx)(s.p,{children:"This document explains the troubleshooting processes for common performance issues and potential solutions to these issues."}),"\n",(0,i.jsx)(s.h2,{id:"identify-hardware-and-segment-failures",children:"Identify hardware and segment failures"}),"\n",(0,i.jsx)(s.p,{children:"The performance of Apache Cloudberry depends on the hardware and IT infrastructure on which it runs. Apache Cloudberry is comprised of several servers (hosts) acting together as one cohesive system (array); as a first step in diagnosing performance problems, ensure that all Apache Cloudberry segments are online. Apache Cloudberry's performance will be as fast as the slowest host in the array. Problems with CPU utilization, memory management, I/O processing, or network load affect performance. Common hardware-related issues are:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Disk failure"})," \u2013 Although a single disk failure should not dramatically affect database performance if you are using RAID, disk resynchronization does consume resources on the host with failed disks. The ",(0,i.jsx)(s.code,{children:"gpcheckperf"})," utility can help identify segment hosts that have disk I/O issues."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Host failure"})," \u2013 When a host is offline, the segments on that host are nonoperational. This means other hosts in the array must perform twice their usual workload because they are running the primary segments and multiple mirrors. If mirrors are not enabled, service is interrupted. Service is temporarily interrupted to recover failed segments. The ",(0,i.jsx)(s.code,{children:"gpstate"})," utility helps identify failed segments."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Network failure"})," \u2013 Failure of a network interface card, a switch, or DNS server can bring down segments. If host names or IP addresses cannot be resolved within your Cloudberry array, these manifest themselves as interconnect errors in Apache Cloudberry. The ",(0,i.jsx)(s.code,{children:"gpcheckperf"})," utility helps identify segment hosts that have network issues."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Disk capacity"})," \u2013 Disk capacity on your segment hosts should never exceed 70 percent full. Apache Cloudberry needs some free space for runtime processing. To reclaim disk space that deleted rows occupy, run ",(0,i.jsx)(s.code,{children:"VACUUM"})," after loads or updates.The ",(0,i.jsx)(s.code,{children:"gp_toolkit"})," administrative schema has many views for checking the size of distributed database objects."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"manage-workload",children:"Manage workload"}),"\n",(0,i.jsx)(s.p,{children:"A database system has a limited CPU capacity, memory, and disk I/O resources. When multiple workloads compete for access to these resources, database performance degrades. Resource management maximizes system throughput while meeting varied business requirements. Apache Cloudberry provides resource queues and resource groups to help you manage these system resources."}),"\n",(0,i.jsxs)(s.p,{children:["Resource queues and resource groups limit resource usage and the total number of concurrent queries running in the particular queue or group. By assigning database roles to the appropriate queue or group, administrators can control concurrent user queries and prevent system overload. For more information about resource queues and resource groups, including selecting the appropriate scheme for your Apache Cloudberry environment, see ",(0,i.jsx)(s.a,{href:"/docs/next/performance/manage-resources-using-resource-queues",children:"Managing Resources"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["Apache Cloudberry administrators should run maintenance workloads such as data loads and ",(0,i.jsx)(s.code,{children:"VACUUM ANALYZE"})," operations after business hours. Do not compete with database users for system resources; perform administrative tasks at low-usage times."]}),"\n",(0,i.jsx)(s.h2,{id:"avoid-contention",children:"Avoid contention"}),"\n",(0,i.jsx)(s.p,{children:"Contention arises when multiple users or workloads try to use the system in a conflicting way; for example, contention occurs when two transactions try to update a table simultaneously. A transaction that seeks a table-level or row-level lock will wait indefinitely for conflicting locks to be released. Applications should not hold transactions open for long periods of time, for example, while waiting for user input."}),"\n",(0,i.jsx)(s.h2,{id:"maintain-database-statistics",children:"Maintain database statistics"}),"\n",(0,i.jsx)(s.p,{children:"Apache Cloudberry uses a cost-based query optimizer that relies on database statistics. Accurate statistics allow the query optimizer to better estimate the number of rows retrieved by a query to choose the most efficient query plan. Without database statistics, the query optimizer cannot estimate how many records will be returned. The optimizer does not assume it has sufficient memory to perform certain operations such as aggregations, so it takes the most conservative action and does these operations by reading and writing from disk. This is significantly slower than doing them in memory. ANALYZE collects statistics about the database that the query optimizer needs."}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsxs)(s.p,{children:["When running an SQL command with GPORCA, Apache Cloudberry issues a warning if the command performance could be improved by collecting statistics on a column or set of columns referenced by the command. The warning is issued on the command line and information is added to the Apache Cloudberry log file. For information about collecting statistics on table columns, see the ",(0,i.jsx)(s.a,{href:"/docs/next/sql-stmts/analyze",children:(0,i.jsx)(s.code,{children:"ANALYZE"})})," command."]})}),"\n",(0,i.jsx)(s.h3,{id:"identify-statistics-problems-in-query-plans",children:"Identify statistics problems in query plans"}),"\n",(0,i.jsxs)(s.p,{children:["Before you interpret a query plan for a query using EXPLAIN or ",(0,i.jsx)(s.code,{children:"EXPLAIN ANALYZE"}),", familiarize yourself with the data to help identify possible statistics problems. Check the plan for the following indicators of inaccurate statistics:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Are the optimizer's estimates close to reality?"})," Run ",(0,i.jsx)(s.code,{children:"EXPLAIN ANALYZE"})," and see if the number of rows the optimizer estimated is close to the number of rows the query operation returned."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Are selective predicates applied early in the plan?"})," The most selective filters should be applied early in the plan so fewer rows move up the plan tree."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Is the optimizer choosing the best join order?"})," When you have a query that joins multiple tables, make sure the optimizer chooses the most selective join order. Joins that eliminate the largest number of rows should be done earlier in the plan so fewer rows move up the plan tree."]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"/docs/next/performance/optimize-queries/analyze-query-performance",children:"Analyze Query Performance"})," for more information about reading query plans."]}),"\n",(0,i.jsx)(s.h3,{id:"tune-statistics-collection",children:"Tune statistics collection"}),"\n",(0,i.jsx)(s.p,{children:"The following configuration parameters control the amount of data sampled for statistics collection:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"default_statistics_target"})}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"These parameters control statistics sampling at the system level. It is better to sample only increased statistics for columns used most frequently in query predicates. You can adjust statistics for a particular column using the command:"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"ALTER TABLE...SET STATISTICS"})}),"\n",(0,i.jsx)(s.p,{children:"For example:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"ALTER TABLE sales ALTER COLUMN region SET STATISTICS 50;\n"})}),"\n",(0,i.jsxs)(s.p,{children:["This is equivalent to changing ",(0,i.jsx)(s.code,{children:"default_statistics_target"})," for a particular column. Subsequent ",(0,i.jsx)(s.code,{children:"ANALYZE"})," operations will then gather more statistics data for that column and produce better query plans as a result."]}),"\n",(0,i.jsx)(s.h2,{id:"optimize-data-distribution",children:"Optimize data distribution"}),"\n",(0,i.jsx)(s.p,{children:"When you create a table in Apache Cloudberry, you must declare a distribution key that allows for even data distribution across all segments in the system. Because the segments work on a query in parallel, Apache Cloudberry will always be as fast as the slowest segment. If the data is unbalanced, the segments that have more data will return their results slower and therefore slow down the entire system."}),"\n",(0,i.jsx)(s.h2,{id:"optimize-your-database-design",children:"Optimize your database design"}),"\n",(0,i.jsx)(s.p,{children:"Many performance issues can be improved by database design. Examine your database design and consider the following:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Does the schema reflect the way the data is accessed?"}),"\n",(0,i.jsx)(s.li,{children:"Can larger tables be broken down into partitions?"}),"\n",(0,i.jsx)(s.li,{children:"Are you using the smallest data type possible to store column values?"}),"\n",(0,i.jsx)(s.li,{children:"Are columns used to join tables of the same datatype?"}),"\n",(0,i.jsx)(s.li,{children:"Are your indexes being used?"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"apache-cloudberry-maximum-limits",children:"Apache Cloudberry maximum limits"}),"\n",(0,i.jsx)(s.p,{children:"To help optimize database design, review the maximum limits that Apache Cloudberry supports:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Dimension"}),(0,i.jsx)(s.th,{children:"Limit"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Database Size"}),(0,i.jsx)(s.td,{children:"Unlimited"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Table Size"}),(0,i.jsx)(s.td,{children:"Unlimited, 128 TB per partition per segment"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Row Size"}),(0,i.jsx)(s.td,{children:"1.6 TB (1600 columns * 1 GB)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Field Size"}),(0,i.jsx)(s.td,{children:"1 GB"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Rows per Table"}),(0,i.jsx)(s.td,{children:"281474976710656 (2^48)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Columns per Table/View"}),(0,i.jsx)(s.td,{children:"1600"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Indexes per Table"}),(0,i.jsx)(s.td,{children:"Unlimited"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Columns per Index"}),(0,i.jsx)(s.td,{children:"32"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Table-level Constraints per Table"}),(0,i.jsx)(s.td,{children:"Unlimited"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Table Name Length"}),(0,i.jsxs)(s.td,{children:["63 Bytes (Limited by ",(0,i.jsx)(s.em,{children:"name"})," data type)"]})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"Dimensions listed as unlimited are not intrinsically limited by Apache Cloudberry. However, they are limited in practice to available disk space and memory/swap space. Performance may degrade when these values are unusually large."}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsxs)(s.p,{children:["There is a maximum limit on the number of objects (tables, indexes, and views, but not rows) that may exist at one time. This limit is ",(0,i.jsx)(s.code,{children:"4294967296"})," (2^32)."]})})]})}function h(e={}){const{wrapper:s}={...(0,n.a)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},11151:(e,s,t)=>{t.d(s,{Z:()=>o,a:()=>a});var i=t(67294);const n={},r=i.createContext(n);function a(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);