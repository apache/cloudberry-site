"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[10711],{21421:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var t=s(85893),l=s(11151);const a={title:"Use PL/Java"},i="Use PL/Java",r={id:"developer/functions-and-procedures/use-pl-java",title:"Use PL/Java",description:"PL/Java is an embedded trusted procedural language that allows you to write PostgreSQL functions and triggers using the Java programming language.",source:"@site/versioned_docs/version-2.x/developer/functions-and-procedures/use-pl-java.md",sourceDirName:"developer/functions-and-procedures",slug:"/developer/functions-and-procedures/use-pl-java",permalink:"/docs/developer/functions-and-procedures/use-pl-java",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/developer/functions-and-procedures/use-pl-java.md",tags:[],version:"2.x",lastUpdatedBy:"TomShawn",lastUpdatedAt:1767860953,formattedLastUpdatedAt:"Jan 8, 2026",frontMatter:{title:"Use PL/Java"},sidebar:"docsbars",previous:{title:"Use PL/Container",permalink:"/docs/developer/functions-and-procedures/use-pl-container"},next:{title:"Use PL/Perl",permalink:"/docs/developer/functions-and-procedures/use-pl-perl"}},c={},d=[{value:"Enable PL/Java",id:"enable-pljava",level:2},{value:"Write PL/Java functions",id:"write-pljava-functions",level:2},{value:"SQL declaration",id:"sql-declaration",level:3},{value:"Type mapping",id:"type-mapping",level:3},{value:"NULL handling",id:"null-handling",level:3},{value:"Complex types",id:"complex-types",level:3},{value:"Use JDBC",id:"use-jdbc",level:2},{value:"Limitations",id:"limitations",level:3},{value:"Handle exceptions",id:"handle-exceptions",level:2},{value:"Log messages",id:"log-messages",level:2},{value:"Security",id:"security",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"use-pljava",children:"Use PL/Java"}),"\n",(0,t.jsx)(n.p,{children:"PL/Java is an embedded trusted procedural language that allows you to write PostgreSQL functions and triggers using the Java programming language."}),"\n",(0,t.jsx)(n.p,{children:"With PL/Java, you can:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Write functions in Java and call them from SQL."}),"\n",(0,t.jsx)(n.li,{children:"Use the Java Standard Library."}),"\n",(0,t.jsx)(n.li,{children:"Access the database via JDBC from within the Java function."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"enable-pljava",children:"Enable PL/Java"}),"\n",(0,t.jsx)(n.p,{children:"To use PL/Java, you must enable it in your database."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Connect to your database using ",(0,t.jsx)(n.code,{children:"psql"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"psql -d <database_name>\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create the ",(0,t.jsx)(n.code,{children:"pljava"})," extension."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE EXTENSION pljava;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This registers both the trusted (",(0,t.jsx)(n.code,{children:"pljava"}),") and untrusted (",(0,t.jsx)(n.code,{children:"javau"}),") languages. If you only want the trusted language, use ",(0,t.jsx)(n.code,{children:"CREATE EXTENSION pljavat"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Configure the classpath headers."}),"\n",(0,t.jsxs)(n.p,{children:["You need to set the ",(0,t.jsx)(n.code,{children:"pljava_classpath"})," configuration parameter to include the JAR files containing your Java classes."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SET pljava_classpath = 'examples.jar:myclasses.jar';\n"})}),"\n",(0,t.jsx)(n.p,{children:"To make this change permanent for the database:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"ALTER DATABASE <database_name> SET pljava_classpath = 'examples.jar:myclasses.jar';\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"write-pljava-functions",children:"Write PL/Java functions"}),"\n",(0,t.jsx)(n.p,{children:"To create a PL/Java function, you write a Java class with static methods, compile it into a JAR file, and then declare the function in SQL."}),"\n",(0,t.jsx)(n.h3,{id:"sql-declaration",children:"SQL declaration"}),"\n",(0,t.jsx)(n.p,{children:"A Java function is declared with the name of a class and a static method on that class."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE FUNCTION getsysprop(VARCHAR)\nRETURNS VARCHAR\nAS 'java.lang.System.getProperty'\nLANGUAGE java;\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can then call the function just like any other SQL function:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT getsysprop('user.home');\n"})}),"\n",(0,t.jsx)(n.h3,{id:"type-mapping",children:"Type mapping"}),"\n",(0,t.jsx)(n.p,{children:"PL/Java automatically maps PostgreSQL types to Java types."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"PostgreSQL type"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Java type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"boolean"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"boolean"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"smallint"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"short"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"integer"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"int"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"bigint"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"long"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"real"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"float"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"double precision"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"double"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,t.jsx)(n.code,{children:"text"}),", ",(0,t.jsx)(n.code,{children:"varchar"}),", ",(0,t.jsx)(n.code,{children:"char"})]}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"java.lang.String"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"date"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"java.sql.Date"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"time"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"java.sql.Time"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"timestamp"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"java.sql.Timestamp"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"bytea"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"byte[]"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"null-handling",children:"NULL handling"}),"\n",(0,t.jsxs)(n.p,{children:["Primitive Java types (like ",(0,t.jsx)(n.code,{children:"int"}),", ",(0,t.jsx)(n.code,{children:"double"}),", ",(0,t.jsx)(n.code,{children:"boolean"}),") cannot be ",(0,t.jsx)(n.code,{children:"NULL"}),". If you pass a SQL ",(0,t.jsx)(n.code,{children:"NULL"})," to a Java function expecting a primitive, it will result in an error unless you map it to the corresponding wrapper class (for example, ",(0,t.jsx)(n.code,{children:"java.lang.Integer"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"Example of handling NULLs:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create the Java method."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"package com.example;\npublic class Utils {\n    public static boolean trueIfEvenOrNull(Integer value) {\n        return (value == null) ? true : (value.intValue() % 2) == 0;\n    }\n}\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Declare the function in SQL using the full class name."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE FUNCTION true_if_even_or_null(integer)\nRETURNS boolean\nAS 'com.example.Utils.trueIfEvenOrNull(java.lang.Integer)'\nLANGUAGE java;\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"complex-types",children:"Complex types"}),"\n",(0,t.jsxs)(n.p,{children:["You can pass complex types and rows to Java functions. PL/Java supports ",(0,t.jsx)(n.code,{children:"Complex"})," types and ",(0,t.jsx)(n.code,{children:"ResultSet"})," for handling rows and sets."]}),"\n",(0,t.jsx)(n.h2,{id:"use-jdbc",children:"Use JDBC"}),"\n",(0,t.jsx)(n.p,{children:"PL/Java includes a JDBC driver that allows your Java code to access the database where the function is running."}),"\n",(0,t.jsx)(n.p,{children:"To establish a connection to the current database session:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'import java.sql.Connection;\nimport java.sql.DriverManager;\n\nConnection conn = DriverManager.getConnection("jdbc:default:connection");\n'})}),"\n",(0,t.jsx)(n.h3,{id:"limitations",children:"Limitations"}),"\n",(0,t.jsxs)(n.p,{children:["When using the internal JDBC driver (",(0,t.jsx)(n.code,{children:"jdbc:default:connection"}),"):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["You cannot manage transactions explicitly (",(0,t.jsx)(n.code,{children:"commit()"}),", ",(0,t.jsx)(n.code,{children:"rollback()"}),", etc. are not allowed). The function runs within the transaction context of the calling SQL statement."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Savepoint"})," operations are allowed but must be released within the same function."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ResultSet"})," from ",(0,t.jsx)(n.code,{children:"executeQuery()"})," is always ",(0,t.jsx)(n.code,{children:"FETCH_FORWARD"})," and ",(0,t.jsx)(n.code,{children:"CONCUR_READ_ONLY"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"handle-exceptions",children:"Handle exceptions"}),"\n",(0,t.jsxs)(n.p,{children:["PL/Java maps database errors to ",(0,t.jsx)(n.code,{children:"java.sql.SQLException"}),". You can catch standard SQL exceptions in your Java code. If your Java code throws an exception, it is reported as an error to the PostgreSQL client, and the transaction is aborted (unless caught by a savepoint)."]}),"\n",(0,t.jsx)(n.h2,{id:"log-messages",children:"Log messages"}),"\n",(0,t.jsxs)(n.p,{children:["PL/Java uses the standard ",(0,t.jsx)(n.code,{children:"java.util.logging.Logger"}),". Messages logged via this logger are redirected to the PostgreSQL log system (",(0,t.jsx)(n.code,{children:"elog"}),")."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'import java.util.logging.Logger;\n\nLogger.getAnonymousLogger().info("Time is " + new java.util.Date());\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The database configuration ",(0,t.jsx)(n.code,{children:"log_min_messages"})," determines which log levels are actually sent to the client or written to the server log."]}),"\n",(0,t.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Trusted Language (",(0,t.jsx)(n.code,{children:"java"}),")"]}),": When using the trusted ",(0,t.jsx)(n.code,{children:"java"})," language, the Java security manager prevents access to the file system and other sensitive system resources using standard Java security policies. Any user can create functions in the trusted language."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Untrusted Language (",(0,t.jsx)(n.code,{children:"javau"}),")"]}),": The untrusted ",(0,t.jsx)(n.code,{children:"javau"})," language allows unrestricted access (for example, file system access), similar to a standalone Java application. Only superusers can create functions using ",(0,t.jsx)(n.code,{children:"javau"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>r,a:()=>i});var t=s(67294);const l={},a=t.createContext(l);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);