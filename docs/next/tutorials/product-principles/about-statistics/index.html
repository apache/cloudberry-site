<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/product-principles/about-statistics" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">About Database Statistics | Apache Cloudberry (Incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cloudberry.apache.org/docs/next/tutorials/product-principles/about-statistics"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="About Database Statistics | Apache Cloudberry (Incubating)"><meta data-rh="true" name="description" content="An overview of statistics gathered by the ANALYZE command in Apache Cloudberry."><meta data-rh="true" property="og:description" content="An overview of statistics gathered by the ANALYZE command in Apache Cloudberry."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cloudberry.apache.org/docs/next/tutorials/product-principles/about-statistics"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/next/tutorials/product-principles/about-statistics" hreflang="en"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/next/tutorials/product-principles/about-statistics" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. JSON Feed">




<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","66"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.6426df7d.css">
<script src="/assets/js/runtime~main.8af3958d.js" defer="defer"></script>
<script src="/assets/js/main.0ee9e24f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="tipsWrap_WWTe"><div class="tipsContent_sMsy"><div class="text_VINd"><a href="https://github.com/apache/cloudberry" target="_blank" rel="noopener noreferrer"><span>If you like Apache Cloudberry (Incubating), give it a star on GitHub! </span><img src="/img/home/hcard/star.svg" alt=""></a></div><div class="close_vVex"><img src="/img/home/hcard/close.svg" alt=""></div></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div class="nav-left-logo"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apache_cloudberry_color_black.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/apache_cloudberry_color_white.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.x (Current)</a></li><li><a class="dropdown__link" href="/docs/1.x">1.x</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community">Overview</a></li><li><a class="dropdown__link" href="/community/slack">Slack Guide</a></li><li><a class="dropdown__link" href="/community/wechat">WeChat Guide</a></li><li><a class="dropdown__link" href="/community/events">Community Events</a></li><li><a class="dropdown__link" href="/community/mailing-lists">Mailing Lists</a></li><li><a class="dropdown__link" href="/community/brand">Brand Guidelines</a></li><li><a class="dropdown__link" href="/community/security">Security Policy</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute">Overview</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/git">Working with Git &amp; GitHub</a></li><li><a class="dropdown__link" href="/contribute/code">Code Contribution Guide</a></li><li><a class="dropdown__link" href="/contribute/proposal">Proposal Guide</a></li><li><a class="dropdown__link" href="/contribute/doc">Doc Contribution Guide</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/releases">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Team</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/team">Who we are</a></li><li><a class="dropdown__link" href="/team/new-committers">Inviting New Committers</a></li><li><a class="dropdown__link" href="/team/sign-icla">Sign ICLA</a></li><li><a class="dropdown__link" href="/team/setup-apache-email-account">Setup the Apache account</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/cloudberry/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/cloudberry/discussions/868" target="_blank" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li><li><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum</a></li><li><a class="dropdown__link" href="/support">Support</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div><div class="toggle_vylO colorModeToggle_x44X check-theme-switch"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_BF9v"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_Rg9N"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebarViewport_pYEE"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/deployment/build-based-on-docker">Deploy and Build</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/next/data-loading/">Load Data</a><button aria-label="Expand sidebar category &#x27;Load Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/operate-with-data/operate-with-db-objects/create-and-manage-database">Create and Prepare</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/operate-with-data/operate-with-db-objects/create-and-manage-tablespaces">Operate with Data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/performance/define-database-performance">Optimize Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/next/security/">Security and Permission</a><button aria-label="Expand sidebar category &#x27;Security and Permission&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/sys-admin/backup-and-restore/">Manage System</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/developer/develop-extensions-using-rust">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/ecosystem/sql-clients/dbeaver">Ecosystem</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/sql-stmts/">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/next/tutorials/crash-course">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/tutorials/crash-course">Apache Cloudberry Crash Course</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/next/tutorials/quick-trial-lessons/">Quick Trial Lessons</a><button aria-label="Expand sidebar category &#x27;Quick Trial Lessons&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/next/tutorials/product-principles/about-mvcc">Product Principles</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/tutorials/product-principles/about-mvcc">About Concurrency Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/tutorials/product-principles/about-statistics">About Database Statistics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/tutorials/product-principles/about-data-loading">About Parallel Data Loading</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/tutorials/product-principles/about-ha">About Redundancy and Failover</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/tutorials/product-principles/about-utilities">About Management and Monitoring Utilities</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/next/tutorials/best-practices/">Best Practices</a><button aria-label="Expand sidebar category &#x27;Best Practices&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_hjYf"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Apache Cloudberry (Incubating)<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/tutorials/product-principles/about-statistics">latest version</a></b> (<!-- -->2.x<!-- -->).</div></div><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link" id="支付">Tutorials</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link" id="支付">Product Principles</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">About Database Statistics</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>About Database Statistics</h1>
<p>An overview of statistics gathered by the ANALYZE command in Apache Cloudberry.</p>
<p>Statistics are metadata that describe the data stored in the database. The query optimizer needs up-to-date statistics to choose the best execution plan for a query. For example, if a query joins two tables and one of them must be broadcast to all segments, the optimizer can choose the smaller of the two tables to minimize network traffic.</p>
<p>The statistics used by the optimizer are calculated and saved in the system catalog by the <code>ANALYZE</code> command. There are three ways to initiate an analyze operation:</p>
<ul>
<li>You can run the <code>ANALYZE</code> command directly.</li>
<li>You can run the <code>analyzedb</code> management utility outside of the database, at the command line.</li>
<li>An automatic analyze operation can be triggered when DML operations are performed on tables that have no statistics or when a DML operation modifies a number of rows greater than a specified threshold.</li>
</ul>
<p>These methods are described in the following sections. The <code>VACUUM ANALYZE</code> command is another way to initiate an analyze operation, but its use is discouraged because vacuum and analyze are different operations with different purposes.</p>
<p>Calculating statistics consumes time and resources, so Apache Cloudberry produces estimates by calculating statistics on samples of large tables. In most cases, the default settings provide the information needed to generate correct execution plans for queries. If the statistics produced are not producing optimal query execution plans, the administrator can tune configuration parameters to produce more accurate statistics by increasing the sample size or the granularity of statistics saved in the system catalog. Producing more accurate statistics has CPU and storage costs and may not produce better plans, so it is important to view explain plans and test query performance to ensure that the additional statistics-related costs result in better query performance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-statistics">System statistics<a href="#system-statistics" class="hash-link" aria-label="Direct link to System statistics" title="Direct link to System statistics">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="table-size">Table size<a href="#table-size" class="hash-link" aria-label="Direct link to Table size" title="Direct link to Table size">​</a></h3>
<p>The query planner seeks to minimize the disk I/O and network traffic required to run a query, using estimates of the number of rows that must be processed and the number of disk pages the query must access. The data from which these estimates are derived are the <code>pg_class</code> system table columns <code>reltuples</code> and <code>relpages</code>, which contain the number of rows and pages at the time a <code>VACUUM</code> or <code>ANALYZE</code> command was last run. As rows are added or deleted, the numbers become less accurate. However, an accurate count of disk pages is always available from the operating system, so as long as the ratio of <code>reltuples</code> to <code>relpages</code> does not change significantly, the optimizer can produce an estimate of the number of rows that is sufficiently accurate to choose the correct query execution plan.</p>
<p>When the <code>reltuples</code> column differs significantly from the row count returned by <code>SELECT COUNT(*)</code>, an analyze should be performed to update the statistics.</p>
<p>When a <code>REINDEX</code> command finishes recreating an index, the <code>relpages</code> and <code>reltuples</code> columns are set to zero. The <code>ANALYZE</code> command should be run on the base table to update these columns.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-pg_statistic-system-table-and-pg_stats-view">The pg_statistic system table and pg_stats view<a href="#the-pg_statistic-system-table-and-pg_stats-view" class="hash-link" aria-label="Direct link to The pg_statistic system table and pg_stats view" title="Direct link to The pg_statistic system table and pg_stats view">​</a></h3>
<p>The <code>pg_statistic</code> system table holds the results of the last <code>ANALYZE</code> operation on each database table. There is a row for each column of every table. It has the following columns:</p>
<p><code>starelid</code>: The object ID of the table or index the column belongs to.</p>
<p><code>staattnum</code>: The number of the described column, beginning with 1.</p>
<p><code>stainherit</code>: If true, the statistics include inheritance child columns, not just the values in the specified relation.</p>
<p><code>stanullfrac</code>: The fraction of the column&#x27;s entries that are null.</p>
<p><code>stawidth</code>: The average stored width, in bytes, of non-null entries.</p>
<p><code>stadistinct</code>: A positive number is an estimate of the number of distinct values in the column; the number is not expected to vary with the number of rows. A negative value is the number of distinct values divided by the number of rows, that is, the ratio of rows with distinct values for the column, negated. This form is used when the number of distinct values increases with the number of rows. A unique column, for example, has an <code>n_distinct</code> value of -1.0. Columns with an average width greater than 1024 are considered unique.</p>
<p><code>stakind&lt;i&gt;N&lt;/i&gt;</code>: A code number indicating the kind of statistics stored in the <i>N</i>th slot of the <code>pg_statistic</code> row.</p>
<p><code>staop&lt;i&gt;N&lt;/i&gt;</code>: An operator used to derive the statistics stored in the <i>N</i>th slot. For example, a histogram slot would show the &lt; operator that defines the sort order of the data.</p>
<p><code>stanumbers&lt;i&gt;N&lt;/i&gt;</code>: float4 array containing numerical statistics of the appropriate kind for the <i>N</i>th slot, or <code>NULL</code> if the slot kind does not involve numerical values.</p>
<p><code>stavalues&lt;i&gt;N&lt;/i&gt;</code>: Column data values of the appropriate kind for the <i>N</i>th slot, or <code>NULL</code> if the slot kind does not store any data values. Each array&#x27;s element values are actually of the specific column&#x27;s data type, so there is no way to define these columns&#x27; types more specifically than <code>&lt;i&gt;anyarray&lt;/i&gt;</code>.</p>
<p>The statistics collected for a column vary for different data types, so the <code>pg_statistic</code> table stores statistics that are appropriate for the data type in four <code>&lt;i&gt;slots&lt;/i&gt;</code>, consisting of four columns per slot. For example, the first slot, which normally contains the most common values for a column, consists of the columns <code>stakind1</code>, <code>staop1</code>, <code>stanumbers1</code>, and <code>stavalues1</code>.</p>
<p>The <code>stakindN</code> columns each contain a numeric code to describe the type of statistics stored in their slot. The <code>stakind</code> code numbers from 1 to 99 are reserved for core PostgreSQL data types. Apache Cloudberry uses code numbers 1, 2, 3, 4, 5, and 99. A value of 0 means the slot is unused. The following table describes the kinds of statistics stored for the three codes.</p>
<p><strong><code>stakind</code> Code 1: Most CommonValues (MCV) Slot</strong></p>
<ul>
<li><code>staop</code> contains the object ID of the <code>=</code> operator, used to decide whether values are the same or not.</li>
<li><code>stavalues</code> contains an array of the <em>K</em> most common non-null values appearing in the column.</li>
<li><code>stanumbers</code> contains the frequencies (fractions of total row count) of the values in the <code>stavalues</code> array.</li>
</ul>
<p>The values are ordered in decreasing frequency. because the arrays are variable-size, <em>K</em> can be chosen by the statistics collector. Values must occur more than once to be added to the <code>stavalues</code> array; a unique column has no MCV slot.</p>
<p><strong><code>stakind</code> Code 2: Histogram Slot</strong></p>
<p>Describes the distribution of scalar data.</p>
<ul>
<li><code>staop</code> is the object ID of the <code>&lt;</code> operator, which describes the sort ordering.</li>
<li><code>stavalues</code> contains <em>M</em> (where <code>M</code>&gt;=2) non-null values that divide the non-null column data values into <code>M</code>-1 bins of approximately equal population. The first <code>stavalues</code> item is the minimum value and the last is the maximum value.</li>
<li><code>stanumbers</code> is not used and should be <code>NULL</code>.</li>
</ul>
<p>If a Most Common Values slot is also provided, then the histogram describes the data distribution after removing the values listed in the MCV array. (It is a <em>compressed histogram</em> in the technical parlance). This allows a more accurate representation of the distribution of a column with some very common values. In a column with only a few distinct values, it is possible that the MCV list describes the entire data population; in this case the histogram reduces to empty and should be omitted.</p>
<p><strong><code>stakind</code> Code 3: Correlation Slot</strong></p>
<p>Describes the correlation between the physical order of table tuples and the ordering of data values of this column.</p>
<ul>
<li><code>staop</code> is the object ID of the <code>&lt;</code> operator. As with the histogram, more than one entry could theoretically appear.</li>
<li><code>stavalues</code> is not used and should be <code>NULL</code>.</li>
<li><code>stanumbers</code> contains a single entry, the correlation coefficient between the sequence of data values and the sequence of their actual tuple positions. The coefficient ranges from +1 to -1.</li>
</ul>
<p><strong><code>stakind</code> Code 4: Most Common Elements Slot</strong></p>
<p>This is similar to a Most Common Values (MCV) Slot, except that it stores the most common non-null <em>elements</em> of the column values. This is useful when the column datatype is an array or some other type with identifiable elements (for instance, <code>tsvector</code>).</p>
<ul>
<li><code>staop</code> contains the equality operator appropriate to the element type.</li>
<li><code>stavalues</code> contains the most common element values.</li>
<li><code>stanumbers</code> contains common element frequencies.</li>
</ul>
<p>Frequencies are measured as the fraction of non-null rows the element value appears in, not the frequency of all rows. Also, the values are sorted into the element type&#x27;s default order (to support binary search for a particular value). because this puts the minimum and maximum frequencies at unpredictable spots in <code>stanumbers</code>, there are two extra members of <code>stanumbers</code> that hold copies of the minimum and maximum frequencies. Optionally, there can be a third extra member that holds the frequency of null elements (the frequency is expressed in the same terms: the fraction of non-null rows that contain at least one null element). If this member is omitted, the column is presumed to contain no <code>NULL</code> elements.</p>
<blockquote>
<p><strong>Note:</strong> For <code>tsvector</code> columns, the <code>stavalues</code> elements are of type <code>text</code>, even though their representation within <code>tsvector</code> is not exactly <code>text</code>.</p>
</blockquote>
<p><strong><code>stakind</code> Code 5: Distinct Elements Count Histogram Slot</strong></p>
<p>Describes the distribution of the number of distinct element values present in each row of an array-type column. Only non-null rows are considered, and only non-null elements.</p>
<ul>
<li><code>staop</code> contains the equality operator appropriate to the element type.</li>
<li><code>stavalues</code> is not used and should be <code>NULL</code>.</li>
<li><code>stanumbers</code> contains information about distinct elements. The last member of <code>stanumbers</code> is the average count of distinct element values over all non-null rows. The preceding <em>M</em> (where <code>M</code> &gt;=2) members form a histogram that divides the population of distinct-elements counts into <code>M</code>-1 bins of approximately equal population. The first of these is the minimum observed count, and the last the maximum.</li>
</ul>
<p><strong><code>stakind</code> Code 99: Hyperloglog Slot</strong></p>
<p>For leaf partitions of a partitioned table, stores the <code>hyperloglog_counter</code> created for the sampled data. The <code>hyperloglog_counter</code> data structure is converted into a <code>bytea</code> and stored in a <code>stavalues5</code> slot of the <code>pg_statistic</code> catalog table.</p>
<p>The <code>pg_stats</code> view presents the contents of <code>pg_statistic</code> in a friendlier format. The <code>pg_stats</code> view has the following columns:</p>
<p><code>schemaname</code>: The name of the schema containing the table.</p>
<p><code>tablename</code>: The name of the table.</p>
<p><code>attname</code>: The name of the column this row describes.</p>
<p><code>inherited</code>: If true, the statistics include inheritance child columns.</p>
<p><code>null_frac</code>: The fraction of column entries that are null.</p>
<p><code>avg_width</code>: The average storage width in bytes of the column&#x27;s entries, calculated as <code>avg(pg_column_size(column_name))</code>.</p>
<p><code>n_distinct</code>: A positive number is an estimate of the number of distinct values in the column; the number is not expected to vary with the number of rows. A negative value is the number of distinct values divided by the number of rows, that is, the ratio of rows with distinct values for the column, negated. This form is used when the number of distinct values increases with the number of rows. A unique column, for example, has an <code>n_distinct</code> value of -1.0. Columns with an average width greater than 1024 are considered unique.</p>
<p><code>most_common_vals</code>: An array containing the most common values in the column, or null if no values seem to be more common. If the <code>n_distinct</code> column is -1, <code>most_common_vals</code> is null. The length of the array is the lesser of the number of actual distinct column values or the value of the <code>default_statistics_target</code> configuration parameter. The number of values can be overridden for a column using <code>ALTER TABLE table SET COLUMN column SET STATISTICS N</code>.</p>
<p><code>most_common_freqs</code>: An array containing the frequencies of the values in the <code>most_common_vals</code> array. This is the number of occurrences of the value divided by the total number of rows. The array is the same length as the <code>most_common_vals</code> array. It is null if <code>most_common_vals</code> is null.</p>
<p><code>histogram_bounds</code>: An array of values that divide the column values into groups of approximately the same size. A histogram can be defined only if there is a <code>max()</code> aggregate function for the column. The number of groups in the histogram is the same as the <code>most_common_vals</code> array size.</p>
<p><code>correlation</code>: Apache Cloudberry computes correlation statistics for both heap and AO/AOCO tables, but the Postgres-based planner uses these statistics only for heap tables.</p>
<p><code>most_common_elems</code>: An array that contains the most common element values.</p>
<p><code>most_common_elem_freqs</code>: An array that contains common element frequencies.</p>
<p><code>elem_count_histogram</code>: An array that describes the distribution of the number of distinct element values present in each row of an array-type column.</p>
<p>Newly created tables and indexes have no statistics. You can check for tables with missing statistics using the <code>gp_stats_missing</code> view, which is in the <code>gp_toolkit</code> schema:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">from</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gp_stats_missing</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sampling">Sampling<a href="#sampling" class="hash-link" aria-label="Direct link to Sampling" title="Direct link to Sampling">​</a></h3>
<p>When calculating statistics for large tables, Apache Cloudberry creates a smaller table by sampling the base table. If the table is partitioned, samples are taken from all partitions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-statistics">Update statistics<a href="#update-statistics" class="hash-link" aria-label="Direct link to Update statistics" title="Direct link to Update statistics">​</a></h3>
<p>Running <code>ANALYZE</code> with no arguments updates statistics for all tables in the database. This could take a very long time, so it is better to analyze tables selectively after data has changed. You can also analyze a subset of the columns in a table, for example columns used in joins, <code>WHERE</code> clauses, <code>SORT</code> clauses, <code>GROUP BY</code> clauses, or <code>HAVING</code> clauses.</p>
<p>Analyzing a severely bloated table can generate poor statistics if the sample contains empty pages, so it is good practice to vacuum a bloated table before analyzing it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="analyze-partitioned-tables">Analyze partitioned tables<a href="#analyze-partitioned-tables" class="hash-link" aria-label="Direct link to Analyze partitioned tables" title="Direct link to Analyze partitioned tables">​</a></h3>
<p>When the <code>ANALYZE</code> command is run on a partitioned table, it analyzes each leaf partition, one at a time. You can run <code>ANALYZE</code> on just new or changed partitioned tables to avoid analyzing partitions that have not changed.</p>
<p>The <code>analyzedb</code> command-line utility skips unchanged partitions automatically. It also runs concurrent sessions so it can analyze several partitions concurrently. It runs five sessions by default, but the number of sessions can be set from 1 to 10 with the <code>-p</code> command-line option. Each time <code>analyzedb</code> runs, it saves state information for append-optimized tables and partitions in the <code>db_analyze</code> directory in the coordinator data directory. The next time it runs, <code>analyzedb</code> compares the current state of each table with the saved state and skips analyzing a table or partition if it is unchanged. Heap tables are always analyzed.</p>
<p>If GPORCA is enabled (the default), you also need to run <code>ANALYZE</code> or <code>ANALYZE ROOTPARTITION</code> on the root partitioned table (not a leaf partition) to refresh the root partition statistics. GPORCA requires statistics at the root level for partitioned tables. The Postgres-based planner does not use these statistics.</p>
<p>The time to analyze a partitioned table is similar to the time to analyze a non-partitioned table with the same data. When all the leaf partitions have statistics, performing <code>ANALYZE ROOTPARTITION</code> to generate root partition statistics should be quick (a few seconds depending on the number of partitions and table columns). If some of the leaf partitions do not have statistics, then all the table data is sampled to generate root partition statistics. Sampling table data takes longer and results in lower quality root partition statistics.</p>
<p>The Apache Cloudberry server configuration parameter <a href="/docs/next/config-params-guc-list">optimizer_analyze_root_partition</a> affects when statistics are collected on the root partitioned table. If the parameter is <code>on</code> (the default), the <code>ROOTPARTITION</code> keyword is not required to collect statistics on the root partition when you run <code>ANALYZE</code>. Root partition statistics are collected when you run <code>ANALYZE</code> on the root partition, or when you run <code>ANALYZE</code> on a leaf partition of the partitioned table and the other leaf partitions have statistics. If the parameter is <code>off</code>, you must run <code>ANALYZE ROOTPARTITION</code> to collect root partition statistics.</p>
<p>If you do not intend to run queries on partitioned tables with GPORCA (setting the server configuration parameter <a href="/docs/next/config-params-guc-list">optimizer</a> to <code>off</code>), you can also set the server configuration parameter <code>optimizer_analyze_root_partition</code> to <code>off</code> to limit when <code>ANALYZE</code> updates the root partition statistics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-statistics">Configure statistics<a href="#configure-statistics" class="hash-link" aria-label="Direct link to Configure statistics" title="Direct link to Configure statistics">​</a></h2>
<p>There are several options for configuring Apache Cloudberry statistics collection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="statistics-target">Statistics target<a href="#statistics-target" class="hash-link" aria-label="Direct link to Statistics target" title="Direct link to Statistics target">​</a></h3>
<p>The statistics target is the size of the <code>most_common_vals</code>, <code>most_common_freqs</code>, and <code>histogram_bounds</code> arrays for an individual column. By default, the target is 25. The default target can be changed by setting a server configuration parameter and the target can be set for any column using the <code>ALTER TABLE</code> command. Larger values increase the time needed to do <code>ANALYZE</code>, but may improve the quality of the Postgres-based planner estimates.</p>
<p>Set the system default statistics target to a different value by setting the <code>default_statistics_target</code> server configuration parameter. The default value is usually sufficient, and you should only raise or lower it if your tests demonstrate that query plans improve with the new target. For example, to raise the default statistics target from 100 to 150 you can use the <code>gpconfig</code> utility:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpconfig -c default_statistics_target -v 150</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The statistics target for individual columns can be set with the <code>ALTER TABLE</code> command. For example, some queries can be improved by increasing the target for certain columns, especially columns that have irregular distributions. You can set the target to zero for columns that never contribute to query optimization. When the target is 0, <code>ANALYZE</code> ignores the column. For example, the following <code>ALTER TABLE</code> command sets the statistics target for the <code>notes</code> column in the <code>emp</code> table to zero:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> emp </span><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">COLUMN</span><span class="token plain"> notes </span><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">STATISTICS</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The statistics target can be set in the range 0 to 1000, or set it to -1 to revert to using the system default statistics target.</p>
<p>Setting the statistics target on a parent partitioned table affects the child partitions. If you set statistics to 0 on some columns on the parent table, the statistics for the same columns are set to 0 for all children partitions. However, if you later add or exchange another child partition, the new child partition will use either the default statistics target or, in the case of an exchange, the previous statistics target. Therefore, if you add or exchange child partitions, you should set the statistics targets on the new child table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="automate-statistics-collection">Automate statistics collection<a href="#automate-statistics-collection" class="hash-link" aria-label="Direct link to Automate statistics collection" title="Direct link to Automate statistics collection">​</a></h3>
<p>Apache Cloudberry can be set to automatically run <code>ANALYZE</code> on a table that either has no statistics or has changed significantly when certain operations are performed on the table. For partitioned tables, automatic statistics collection is only triggered when the operation is run directly on a leaf table, and then only the leaf table is analyzed.</p>
<p>Automatic statistics collection is governed by a server configuration parameter, and has three modes:</p>
<ul>
<li><code>none</code> deactivates automatic statistics collection.</li>
<li><code>on_no_stats</code> triggers an analyze operation for a table with no existing statistics when any of the commands <code>CREATE TABLE AS SELECT</code>, <code>INSERT</code>, or <code>COPY</code> are run on the table by the table owner.</li>
<li><code>on_change</code> triggers an analyze operation when any of the commands <code>CREATE TABLE AS SELECT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>INSERT</code>, or <code>COPY</code> are run on the table by the table owner, and the number of rows affected exceeds the threshold defined by the <code>gp_autostats_on_change_threshold</code> configuration parameter.</li>
</ul>
<p>The automatic statistics collection mode is set separately for commands that occur within a procedural language function and commands that run outside of a function:</p>
<ul>
<li>The <code>gp_autostats_mode</code> configuration parameter controls automatic statistics collection behavior outside of functions and is set to <code>on_no_stats</code> by default.</li>
<li>The <code>gp_autostats_mode_in_functions</code> parameter controls the behavior when table operations are performed within a procedural language function and is set to <code>none</code> by default.</li>
</ul>
<p>With the <code>on_change</code> mode, <code>ANALYZE</code> is triggered only if the number of rows affected exceeds the threshold defined by the <code>gp_autostats_on_change_threshold</code> configuration parameter. The default value for this parameter is a very high value, 2147483647, which effectively deactivates automatic statistics collection; you must set the threshold to a lower number to enable it. The <code>on_change</code> mode could trigger large, unexpected analyze operations that could disrupt the system, so it is not recommended to set it globally. It could be useful in a session, for example to automatically analyze a table following a load.</p>
<p>Setting the <code>gp_autostats_allow_nonowner</code> server configuration parameter to <code>true</code> also instructs Apache Cloudberry to trigger automatic statistics collection on a table when:</p>
<ul>
<li><code>gp_autostats_mode=on_change</code> and the table is modified by a non-owner.</li>
<li><code>gp_autostats_mode=on_no_stats</code> and the first user to <code>INSERT</code> or <code>COPY</code> into the table is a non-owner.</li>
</ul>
<p>To deactivate automatic statistics collection outside of functions, set the <code>gp_autostats_mode</code> parameter to <code>none</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpconfigure -c gp_autostats_mode -v none</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To enable automatic statistics collection in functions for tables that have no statistics, change <code>gp_autostats_mode_in_functions</code> to <code>on_no_stats</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpconfigure -c gp_autostats_mode_in_functions -v on_no_stats</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Set the <code>log_autostats</code> system configuration parameter to on if you want to log automatic statistics collection operations.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/cloudberry-site/edit/main/docs/tutorials/product-principles/about-statistics.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-10-21T08:00:31.000Z">Oct 21, 2025</time></b> by <b>Dianjin Wang</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/next/tutorials/product-principles/about-mvcc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label single-line-overflow hide-before-after">About Concurrency Control</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/next/tutorials/product-principles/about-data-loading"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label single-line-overflow hide-before-after">About Parallel Data Loading</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-statistics" class="table-of-contents__link toc-highlight">System statistics</a></li><li><a href="#configure-statistics" class="table-of-contents__link toc-highlight">Configure statistics</a></li></ul></div></div></div></div></main></div></div></div><div class="wrap_QlFE"><div class="mainWrap_IbWk"><div class="linksWrap_Zcc4"><div><div class="footerLinkTitle_PxTg">Support</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a></div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a></div><div class="footerLinkItem_Kf4k"><a href="https://inviter.co/apache-cloudberry" target="_blank" rel="noopener noreferrer">Slack</a></div><div class="footerLinkItem_Kf4k"><a href="https://x.com/ASFCloudberry" target="_blank" rel="noopener noreferrer">Twitter</a></div><div class="footerLinkItem_Kf4k"><a href="https://youtube.com/@ApacheCloudberry" target="_blank" rel="noopener noreferrer">Youtube</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/security">Security</a></div></div><div><div class="footerLinkTitle_PxTg">Resources</div><div class="footerLinkItem_Kf4k"><a href="/releases" target="_blank">Download</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/docs/">Documentation</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/events">Events</a></div><div class="footerLinkItem_Kf4k"><a href="/community/brand" target="_blank">Brand Guidelines</a></div></div><div><div class="footerLinkTitle_PxTg">Contribution</div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/git">Working with Git &amp; GitHub</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/how-to-contribute">Contribution Overview</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/code">Code Contribution</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/doc">Doc Contribution</a></div></div></div><div class="logoLinkWrap_MDp5"><div class="logoWrap_qcVI"><img class="logo_cphB" src="/img/apache-incubator.svg" alt=""></div><div class="links_yA93"><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.002 0c-8.288 0-15 6.713-15 15 0 6.637 4.293 12.244 10.256 14.231.75.131 1.031-.319 1.031-.712 0-.356-.019-1.538-.019-2.794-3.769.694-4.744-.919-5.044-1.763-.168-.43-.9-1.762-1.537-2.118-.525-.282-1.275-.975-.019-.994 1.181-.019 2.025 1.087 2.306 1.537 1.35 2.27 3.507 1.632 4.37 1.238.13-.975.524-1.631.956-2.006-3.338-.375-6.826-1.669-6.826-7.406 0-1.632.582-2.982 1.538-4.032-.15-.375-.675-1.912.15-3.975 0 0 1.256-.394 4.125 1.538 1.2-.338 2.475-.506 3.75-.506s2.55.168 3.75.506c2.869-1.95 4.125-1.538 4.125-1.538.825 2.063.3 3.6.15 3.975.956 1.05 1.538 2.382 1.538 4.032 0 5.756-3.507 7.03-6.844 7.406.544.468 1.012 1.369 1.012 2.775 0 2.006-.018 3.619-.018 4.125 0 .394.28.862 1.03.712A15.024 15.024 0 0 0 30.003 15c0-8.287-6.713-15-15-15Z"></path></svg><svg width="32" height="26" viewBox="0 0 32 26" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M31.319 3.484c-1.145.507-2.36.84-3.603.987a6.293 6.293 0 0 0 2.758-3.47 12.518 12.518 0 0 1-3.983 1.52A6.274 6.274 0 0 0 15.64 6.815c0 .493.056.97.161 1.43a17.811 17.811 0 0 1-12.93-6.555 6.252 6.252 0 0 0-.85 3.154 6.272 6.272 0 0 0 2.791 5.222 6.253 6.253 0 0 1-2.841-.785l-.001.077a6.277 6.277 0 0 0 5.033 6.153 6.305 6.305 0 0 1-2.834.108 6.278 6.278 0 0 0 5.86 4.356 12.59 12.59 0 0 1-7.79 2.686c-.5 0-1-.03-1.497-.088a17.746 17.746 0 0 0 9.616 2.818c11.54 0 17.849-9.559 17.849-17.848 0-.272-.007-.544-.019-.812a12.746 12.746 0 0 0 3.13-3.246Z"></path></svg><svg width="30" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.366 0c.801.004 2.805.024 4.935.11l.755.032c2.145.102 4.287.275 5.35.571 1.417.398 2.53 1.56 2.907 3.033.6 2.339.675 6.903.684 8.008l.002.229v.032l-.002.229c-.009 1.104-.084 5.669-.684 8.008-.381 1.478-1.495 2.64-2.907 3.032-1.063.297-3.205.47-5.35.571l-.755.033c-2.13.086-4.134.105-4.935.11h-.734c-1.696-.01-8.785-.087-11.04-.714-1.418-.398-2.532-1.56-2.908-3.032-.6-2.34-.675-6.904-.684-8.008v-.49c.01-1.105.084-5.67.684-8.008.382-1.478 1.496-2.64 2.908-3.033C5.847.086 12.936.01 14.632 0h.734Zm-3.367 6.749v10.5l9-5.25-9-5.25Z"></path></svg><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M6.791 18.77a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.951-2.951 2.959 2.959 0 0 1 2.951-2.952h2.952v2.952Zm1.487 0a2.959 2.959 0 0 1 2.952-2.951 2.959 2.959 0 0 1 2.952 2.952v7.39a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.952-2.952v-7.39ZM11.23 6.792A2.959 2.959 0 0 1 8.278 3.84 2.959 2.959 0 0 1 11.23.888a2.959 2.959 0 0 1 2.952 2.951v2.952H11.23Zm0 1.487a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H3.84A2.959 2.959 0 0 1 .887 11.23a2.959 2.959 0 0 1 2.951-2.952h7.391Zm11.98 2.952a2.959 2.959 0 0 1 2.951-2.952 2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H23.21V11.23Zm-1.488 0a2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V3.84A2.959 2.959 0 0 1 18.771.887a2.959 2.959 0 0 1 2.951 2.951v7.391Zm-2.951 11.98a2.959 2.959 0 0 1 2.951 2.951 2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V23.21h2.952Zm0-1.488a2.959 2.959 0 0 1-2.952-2.951 2.959 2.959 0 0 1 2.952-2.952h7.39a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.951h-7.39Z"></path></svg><svg width="28" height="30" viewBox="0 0 28 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M22.48 4.286H5.195c-.845 0-1.52.724-1.52 1.568v18.579c0 .844.675 1.568 1.52 1.568h17.283c.845 0 1.52-.724 1.52-1.568V5.854c0-.844-.675-1.568-1.52-1.568Z"></path><path d="M6.233 12.156h3.081v10.756H6.233V12.156Zm1.57-5.315c.988 0 1.802.875 1.802 1.938s-.814 1.939-1.803 1.939C6.814 10.718 6 9.842 6 8.779c0-1.063.814-1.938 1.802-1.938Zm3.488 5.315h2.965v1.439h.058c.407-.876 1.453-1.751 2.965-1.751 3.14 0 3.721 2.25 3.721 5.127v5.879h-3.081v-5.253c0-1.25 0-2.877-1.628-2.877s-1.86 1.376-1.86 2.752v5.315h-3.082v-10.63h-.058Z" fill="#000"></path></svg><svg width="34" height="28" viewBox="0 0 34 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M26.863 16.567c.748 0 1.347-.636 1.347-1.347 0-.748-.599-1.347-1.347-1.347s-1.347.599-1.347 1.347.599 1.347 1.347 1.347Zm-6.639 0c.749 0 1.347-.636 1.347-1.347 0-.748-.598-1.347-1.347-1.347-.748 0-1.346.599-1.346 1.347s.598 1.347 1.346 1.347Zm9.852 7.56a.52.52 0 0 0-.258.553c0 .074 0 .148.036.221.148.627.442 1.622.442 1.66 0 .11.037.184.037.257a.33.33 0 0 1-.331.332c-.074 0-.11-.037-.184-.074l-2.174-1.253c-.147-.074-.331-.147-.516-.147-.11 0-.22 0-.294.037-1.032.294-2.1.442-3.242.442-5.49 0-9.91-3.687-9.91-8.258 0-4.57 4.42-8.257 9.91-8.257 5.489 0 9.91 3.686 9.91 8.257 0 2.47-1.327 4.719-3.427 6.23ZM24.01 8.147a13.662 13.662 0 0 0-.418-.007c-6.262 0-11.41 4.29-11.41 9.757 0 .83.119 1.634.342 2.4h-.133c-1.33 0-2.659-.221-3.877-.553-.111-.037-.222-.037-.333-.037-.221 0-.443.074-.627.185L4.932 21.4a.525.525 0 0 1-.221.074.409.409 0 0 1-.406-.405c0-.11.036-.184.073-.294.037-.037.37-1.251.554-1.987 0-.074.037-.184.037-.258a.834.834 0 0 0-.332-.662C2.089 16.065.5 13.378.5 10.398.501 4.916 5.855.5 12.428.5 18.073.5 22.82 3.753 24.01 8.146Zm-7.73.627c.859 0 1.54-.716 1.54-1.54 0-.858-.681-1.539-1.54-1.539-.86 0-1.54.68-1.54 1.54 0 .859.68 1.54 1.54 1.54Zm-7.89 0c.86 0 1.54-.716 1.54-1.54 0-.858-.68-1.539-1.54-1.539-.859 0-1.539.68-1.539 1.54 0 .859.68 1.54 1.54 1.54Z"></path></svg></div></div></div><div class="copyrightWrap_yPz7"><div class="copyright_AoBa">
      <p>
        Apache Cloudberry is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
      </p>
      <p>
        Copyright © 2025 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p>
      <p>
        Apache®, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.
      </p>
      </div></div></div></div>
</body>
</html>