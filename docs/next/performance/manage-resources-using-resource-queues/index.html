<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-performance/manage-resources-using-resource-queues" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Resource Queues | Apache Cloudberry (Incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cloudberry.apache.org/docs/next/performance/manage-resources-using-resource-queues"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Resource Queues | Apache Cloudberry (Incubating)"><meta data-rh="true" name="description" content="Use Apache Cloudberry resource queues to prioritize and allocate resources to queries according to business requirements and to prevent queries from starting when resources are unavailable."><meta data-rh="true" property="og:description" content="Use Apache Cloudberry resource queues to prioritize and allocate resources to queries according to business requirements and to prevent queries from starting when resources are unavailable."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cloudberry.apache.org/docs/next/performance/manage-resources-using-resource-queues"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/next/performance/manage-resources-using-resource-queues" hreflang="en"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/zh/docs/next/performance/manage-resources-using-resource-queues" hreflang="zh"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/next/performance/manage-resources-using-resource-queues" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. JSON Feed">




<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","66"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.e32c7aa9.css">
<script src="/assets/js/runtime~main.53175c5d.js" defer="defer"></script>
<script src="/assets/js/main.70911aad.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="tipsWrap_WWTe"><div class="tipsContent_sMsy"><div class="text_VINd"><a href="https://github.com/apache/cloudberry" target="_blank" rel="noopener noreferrer"><span>If you like Apache Cloudberry (Incubating), give it a star on GitHub! </span><img src="/img/home/hcard/star.svg" alt=""></a></div><div class="close_vVex"><img src="/img/home/hcard/close.svg" alt=""></div></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div class="nav-left-logo"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apache_cloudberry_color_black.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/apache_cloudberry_color_white.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" versions="current,2.x,1.x" href="/docs/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/performance/manage-resources-using-resource-queues">Next</a></li><li><a class="dropdown__link" href="/docs/performance/manage-resources-using-resource-queues">2.x</a></li><li><a class="dropdown__link" href="/docs/1.x/">1.x</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/next/">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community">Overview</a></li><li><a class="dropdown__link" href="/community/slack">Slack Guide</a></li><li><a class="dropdown__link" href="/community/wechat">WeChat Guide</a></li><li><a class="dropdown__link" href="/community/events">Community Events</a></li><li><a class="dropdown__link" href="/community/mailing-lists">Mailing Lists</a></li><li><a class="dropdown__link" href="/community/brand">Brand Guidelines</a></li><li><a class="dropdown__link" href="/community/security">Security Policy</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute">Overview</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/git">Working with Git &amp; GitHub</a></li><li><a class="dropdown__link" href="/contribute/code">Code Contribution Guide</a></li><li><a class="dropdown__link" href="/contribute/proposal">Proposal Guide</a></li><li><a class="dropdown__link" href="/contribute/doc">Doc Contribution Guide</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/releases">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Team</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/team">Who we are</a></li><li><a class="dropdown__link" href="/team/new-committers">Inviting New Committers</a></li><li><a class="dropdown__link" href="/team/sign-icla">Sign ICLA</a></li><li><a class="dropdown__link" href="/team/setup-apache-email-account">Setup the Apache account</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/cloudberry/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/cloudberry/discussions/868" target="_blank" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li><li><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum</a></li><li><a class="dropdown__link" href="/support">Support</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div><div class="toggle_vylO colorModeToggle_x44X check-theme-switch"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_BF9v"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_Rg9N"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebarViewport_pYEE"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/deployment/">Deploy and Build</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/next/data-loading/">Load Data</a><button aria-label="Expand sidebar category &#x27;Load Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/operate-with-data/operate-with-db-objects/create-and-manage-database">Create and Prepare</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/operate-with-data/operate-with-db-objects/create-and-manage-tablespaces">Operate with Data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/next/performance/define-database-performance">Optimize Performance</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/define-database-performance">Define Database Performance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/next/performance/optimize-queries/">Optimize Query Performance</a><button aria-label="Expand sidebar category &#x27;Optimize Query Performance&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/distribution-and-skew">Distribution and Skew</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/memory-overview">Memory Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/update-stats-using-analyze">Update Statistics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/use-columnar-compression">Use Column-Level Compression</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/next/performance/manage-resources">Manage Resources</a><button aria-label="Collapse sidebar category &#x27;Manage Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/performance/manage-resources-using-resource-queues">Resource Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/manage-resources-using-resource-groups">Resource Groups</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/use-dynamic-tables">Use Dynamic Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/common-cause-of-performance-issues">Common Causes of Performance Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/investigate-performance-issues">Investigate Performance Issues</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/next/security/">Security and Permission</a><button aria-label="Expand sidebar category &#x27;Security and Permission&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/sys-admin/backup-and-restore/">Manage System</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/developer/develop-extensions-using-rust">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/ecosystem/sql-clients/dbeaver">Ecosystem</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/sql-stmts/">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/releases/">Releases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/next/tutorial/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/tutorial/crash-course">Crash Course</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_hjYf"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Apache Cloudberry (Incubating)<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/performance/manage-resources-using-resource-queues">latest version</a></b> (<!-- -->2.x<!-- -->).</div></div><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link" id="支付">Optimize Performance</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" style="cursor:pointer">Manage Resources</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Resource Queues</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Resource Queues</h1>
<p>Use Apache Cloudberry resource queues to prioritize and allocate resources to queries according to business requirements and to prevent queries from starting when resources are unavailable.</p>
<p>Resource queues are one tool to manage the degree of concurrency in a Apache Cloudberry system. Resource queues are database objects that you create with the <code>CREATE RESOURCE QUEUE</code> SQL statement. You can use them to manage the number of active queries that may run concurrently, the amount of memory each type of query is allocated, and the relative priority of queries. Resource queues can also guard against queries that would consume too many resources and degrade overall system performance.</p>
<p>Each database role is associated with a single resource queue; multiple roles can share the same resource queue. Roles are assigned to resource queues using the <code>RESOURCE QUEUE</code> phrase of the <code>CREATE ROLE</code> or <code>ALTER ROLE</code> statements. If a resource queue is not specified, the role is associated with the default resource queue, <code>pg_default</code>.</p>
<p>When the user submits a query for execution, the query is evaluated against the resource queue&#x27;s limits. If the query does not cause the queue to exceed its resource limits, then that query will run immediately. If the query causes the queue to exceed its limits (for example, if the maximum number of active statement slots are currently in use), then the query must wait until queue resources are free before it can run. Queries are evaluated on a first in, first out basis. If query prioritization is enabled, the active workload on the system is periodically assessed and processing resources are reallocated according to query priority (see <a href="#how-priorities-work">How Priorities Work</a>). Roles with the <code>SUPERUSER</code> attribute are exempt from resource queue limits. Superuser queries always run immediately regardless of limits imposed by their assigned resource queue.</p>
<p><img decoding="async" loading="lazy" alt="Resource Queue Process" src="/assets/images/resource-queues-1-6480c1d7aaa462181f30f8040bea3744.png" width="584" height="228" class="img_ev3q"></p>
<p>Resource queues define classes of queries with similar resource requirements. Administrators should create resource queues for the various types of workloads in their organization. For example, you could create resource queues for the following classes of queries, corresponding to different service level agreements:</p>
<ul>
<li>ETL queries</li>
<li>Reporting queries</li>
<li>Executive queries</li>
</ul>
<p>A resource queue has the following characteristics:</p>
<ul>
<li>
<p><strong><code>MEMORY_LIMIT</code></strong>: The amount of memory used by all the queries in the queue (per segment). For example, setting <code>MEMORY_LIMIT</code> to 2GB on the ETL queue allows ETL queries to use up to 2GB of memory in each segment.</p>
</li>
<li>
<p><strong><code>ACTIVE_STATEMENTS</code></strong>: The number of <em>slots</em> for a queue; the maximum concurrency level for a queue. When all slots are used, new queries must wait. Each query uses an equal amount of memory by default.</p>
<p>For example, the <code>pg_default</code> resource queue has <code>ACTIVE_STATEMENTS</code> = 20.</p>
</li>
<li>
<p><strong><code>PRIORITY</code></strong>: The relative CPU usage for queries. This may be one of the following levels: <code>LOW</code>, <code>MEDIUM</code>, <code>HIGH</code>, <code>MAX</code>. The default level is <code>MEDIUM</code>. The query prioritization mechanism monitors the CPU usage of all the queries running in the system, and adjusts the CPU usage for each to conform to its priority level. For example, you could set <code>MAX</code> priority to the <code>executive</code> resource queue and <code>MEDIUM</code> to other queues to ensure that executive queries receive a greater share of CPU.</p>
</li>
<li>
<p><strong><code>MAX_COST</code></strong>: Query plan cost limit. The Apache Cloudberry optimizer assigns a numeric cost to each query. If the cost exceeds the <code>MAX_COST</code> value set for the resource queue, the query is rejected as too expensive.</p>
</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>GPORCA and the Postgres-based planner utilize different query costing models and may compute different costs for the same query. The Apache Cloudberry resource queue resource management scheme neither differentiates nor aligns costs between GPORCA and the Postgres-based planner; it uses the literal cost value returned from the optimizer to throttle queries.</p></div></div>
<p>When resource queue-based resource management is active, use the <code>MEMORY_LIMIT</code> and <code>ACTIVE_STATEMENTS</code> limits for resource queues rather than configuring cost-based limits. Even when using GPORCA, Apache Cloudberry may fall back to using the Postgres-based planner for certain queries, so using cost-based limits can lead to unexpected results.</p>
<p>The default configuration for a Apache Cloudberry system has a single default resource queue named <code>pg_default</code>. The <code>pg_default</code> resource queue has an <code>ACTIVE_STATEMENTS</code> setting of 20, no <code>MEMORY_LIMIT</code>, medium <code>PRIORITY</code>, and no set <code>MAX_COST</code>. This means that all queries are accepted and run immediately, at the same priority and with no memory limitations; however, only twenty queries may run concurrently.</p>
<p>The number of concurrent queries a resource queue allows depends on whether the <code>MEMORY_LIMIT</code> parameter is set:</p>
<ul>
<li>If no <code>MEMORY_LIMIT</code> is set for a resource queue, the amount of memory allocated per query is the value of the <code>statement_mem</code> server configuration parameter. The maximum memory the resource queue can use is the product of <code>statement_mem</code> and <code>ACTIVE_STATEMENTS</code>.</li>
<li>When a <code>MEMORY_LIMIT</code> is set on a resource queue, the number of queries that the queue can run concurrently is limited by the queue&#x27;s available memory.</li>
</ul>
<p>A query admitted to the system is allocated an amount of memory and a query plan tree is generated for it. Each node of the tree is an operator, such as a sort or hash join. Each operator is a separate execution thread and is allocated a fraction of the overall statement memory, at minimum 100KB. If the plan has a large number of operators, the minimum memory required for operators can exceed the available memory and the query will be rejected with an insufficient memory error. Operators determine if they can complete their tasks in the memory allocated, or if they must spill data to disk, in work files. The mechanism that allocates and controls the amount of memory used by each operator is called &quot;memory quota&quot;.</p>
<p>Not all SQL statements submitted through a resource queue are evaluated against the queue limits. By default only <code>SELECT</code>, <code>SELECT INTO</code>, <code>CREATE TABLE AS SELECT</code>, and <code>DECLARE CURSOR</code> statements are evaluated. If the server configuration parameter <code>resource_select_only</code> is set to <code>off</code>, then <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> statements will be evaluated as well.</p>
<p>Also, an SQL statement that is run during the execution of an <code>EXPLAIN ANALYZE</code> command is excluded from resource queues.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resource-queue-example">Resource queue example<a href="#resource-queue-example" class="hash-link" aria-label="Direct link to Resource queue example" title="Direct link to Resource queue example">​</a></h2>
<p>The default resource queue, <code>pg_default</code>, allows a maximum of 20 active queries and allocates the same amount of memory to each. This is generally not adequate resource control for production systems. To ensure that the system meets performance expectations, you can define classes of queries and assign them to resource queues configured to run them with the concurrency, memory, and CPU resources best suited for that class of query.</p>
<p>The following illustration shows an example resource queue configuration for a Apache Cloudberry system with <code>gp_vmem_protect_limit</code> set to 8GB:</p>
<p><img decoding="async" loading="lazy" alt="Resource Queue Configuration Example" src="/assets/images/resource-queues-2-5864f0ffaae1eb5e2b3c88e97ea7f534.png" width="613" height="153" class="img_ev3q"></p>
<p>This example has three classes of queries with different characteristics and service level agreements (SLAs). Three resource queues are configured for them. A portion of the segment memory is reserved as a safety margin.</p>
<table><thead><tr><th>Resource queue Name</th><th>Active statements</th><th>Memory limit</th><th>Memory per query</th></tr></thead><tbody><tr><td>ETL</td><td>3</td><td>2GB</td><td>667MB</td></tr><tr><td>Reporting</td><td>7</td><td>3GB</td><td>429MB</td></tr><tr><td>Executive</td><td>1</td><td>1.4GB</td><td>1.4GB</td></tr></tbody></table>
<p>The total memory allocated to the queues is 6.4GB, or 80% of the total segment memory defined by the <code>gp_vmem_protect_limit</code> server configuration parameter. Allowing a safety margin of 20% accommodates some operators and queries that are known to use more memory than they are allocated by the resource queue.</p>
<p>See the <a href="/docs/next/sql-stmts/create-resource-queue"><code>CREATE RESOURCE QUEUE</code></a>, <a href="/docs/next/sql-stmts/create-role"><code>CREATE ROLE</code></a>, and <a href="/docs/next/sql-stmts/alter-role"><code>ALTER ROLE</code></a> statements for help with command syntax and detailed reference information.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-memory-limits-work">How memory limits work<a href="#how-memory-limits-work" class="hash-link" aria-label="Direct link to How memory limits work" title="Direct link to How memory limits work">​</a></h2>
<p>Setting <code>MEMORY_LIMIT</code> on a resource queue sets the maximum amount of memory that all active queries submitted through the queue can consume for a segment instance. The amount of memory allotted to a query is the queue memory limit divided by the active statement limit. (Use the memory limits in conjunction with statement-based queues rather than cost-based queues.) For example, if a queue has a memory limit of 2000MB and an active statement limit of 10, each query submitted through the queue is allotted 200MB of memory by default. The default memory allotment can be overridden on a per-query basis using the <code>statement_mem</code> server configuration parameter (up to the queue memory limit). Once a query has started running, it holds its allotted memory in the queue until it completes, even if during execution it actually consumes less than its allotted amount of memory.</p>
<p>You can use the <code>statement_mem</code> server configuration parameter to override memory limits set by the current resource queue. At the session level, you can increase <code>statement_mem</code> up to the resource queue&#x27;s <code>MEMORY_LIMIT</code>. This will allow an individual query to use all of the memory allocated for the entire queue without affecting other resource queues.</p>
<p>The value of <code>statement_mem</code> is capped using the <code>max_statement_mem</code> configuration parameter (a superuser parameter). For a query in a resource queue with <code>MEMORY_LIMIT</code> set, the maximum value for <code>statement_mem</code> is <code>min(MEMORY_LIMIT, max_statement_mem)</code>. When a query is admitted, the memory allocated to it is subtracted from <code>MEMORY_LIMIT</code>. If <code>MEMORY_LIMIT</code> is exhausted, new queries in the same resource queue must wait. This happens even if <code>ACTIVE_STATEMENTS</code> has not yet been reached. Note that this can happen only when <code>statement_mem</code> is used to override the memory allocated by the resource queue.</p>
<p>For example, consider a resource queue named <code>adhoc</code> with the following settings:</p>
<ul>
<li><code>MEMORY_LIMIT</code> is 1.5GB</li>
<li><code>ACTIVE_STATEMENTS</code> is 3</li>
</ul>
<p>By default each statement submitted to the queue is allocated 500MB of memory. Now consider the following series of events:</p>
<ol>
<li>User <code>ADHOC_1</code> submits query <code>Q1</code>, overriding <code>STATEMENT_MEM</code> to 800MB. The <code>Q1</code> statement is admitted into the system.</li>
<li>User <code>ADHOC_2</code> submits query <code>Q2</code>, using the default 500MB.</li>
<li>With <code>Q1</code> and <code>Q2</code> still running, user <code>ADHOC3</code> submits query <code>Q3</code>, using the default 500MB.</li>
</ol>
<p>Queries <code>Q1</code> and <code>Q2</code> have used 1300MB of the queue&#x27;s 1500MB. Therefore, <code>Q3</code> must wait for <code>Q1</code> or <code>Q2</code> to complete before it can run.</p>
<p>If <code>MEMORY_LIMIT</code> is not set on a queue, queries are admitted until all of the <code>ACTIVE_STATEMENTS</code> slots are in use, and each query can set an arbitrarily high <code>statement_mem</code>. This could lead to a resource queue using unbounded amounts of memory.</p>
<p>For more information on configuring memory limits on a resource queue, and other memory utilization controls, see <a href="#create-queues-with-memory-limits">Create Queues with Memory Limits</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="statement_mem-and-low-memory-queries"><code>statement_mem</code> and low memory queries<a href="#statement_mem-and-low-memory-queries" class="hash-link" aria-label="Direct link to statement_mem-and-low-memory-queries" title="Direct link to statement_mem-and-low-memory-queries">​</a></h3>
<p>A low <code>statement_mem</code> setting (for example, in the 1-3MB range) has been shown to increase the performance of queries with low memory requirements. Use the <code>statement_mem</code> server configuration parameter to override the setting on a per-query basis. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> statement_mem</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;2MB&#x27;</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-priorities-work">How priorities work<a href="#how-priorities-work" class="hash-link" aria-label="Direct link to How priorities work" title="Direct link to How priorities work">​</a></h2>
<p>The <code>PRIORITY</code> setting for a resource queue differs from the <code>MEMORY_LIMIT</code> and <code>ACTIVE_STATEMENTS</code> settings, which determine whether a query will be admitted to the queue and eventually run. The <code>PRIORITY</code> setting applies to queries after they become active. Active queries share available CPU resources as determined by the priority settings for its resource queue. When a statement from a high-priority queue enters the group of actively running statements, it may claim a greater share of the available CPU, reducing the share allocated to already-running statements in queues with a lesser priority setting.</p>
<p>The comparative size or complexity of the queries does not affect the allotment of CPU. If a simple, low-cost query is running simultaneously with a large, complex query, and their priority settings are the same, they will be allocated the same share of available CPU resources. When a new query becomes active, the CPU shares will be recalculated, but queries of equal priority will still have equal amounts of CPU.</p>
<p>For example, an administrator creates three resource queues: <code>adhoc</code> for ongoing queries submitted by business analysts, <code>reporting</code> for scheduled reporting jobs, and <code>executive</code> for queries submitted by executive user roles. The administrator wants to ensure that scheduled reporting jobs are not heavily affected by unpredictable resource demands from ad-hoc analyst queries. Also, the administrator wants to make sure that queries submitted by executive roles are allotted a significant share of CPU. Accordingly, the resource queue priorities are set as shown:</p>
<ul>
<li><code>adhoc</code> — Low priority</li>
<li><code>reporting</code> — High priority</li>
<li><code>executive</code> — Maximum priority</li>
</ul>
<p>At runtime, the CPU share of active statements is determined by these priority settings. If queries 1 and 2 from the reporting queue are running simultaneously, they have equal shares of CPU. When an ad-hoc query becomes active, it claims a smaller share of CPU. The exact share used by the reporting queries is adjusted, but remains equal due to their equal priority setting:</p>
<p><img decoding="async" loading="lazy" alt="CPU share readjusted according to priority" src="/assets/images/resource-queues-3-04782796585ad270f63b451ebef440ce.png" width="830" height="573" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The percentages shown in these illustrations are approximate. CPU usage between high, low and maximum priority queues is not always calculated in precisely these proportions.</p></div></div>
<p>When an executive query enters the group of running statements, CPU usage is adjusted to account for its maximum priority setting. It may be a simple query compared to the analyst and reporting queries, but until it is completed, it will claim the largest share of CPU.</p>
<p><img decoding="async" loading="lazy" alt="CPU share readjusted for maximum priority query" src="/assets/images/resource-queues-4-0bea0066372157c4fb93e98ac2b7705b.png" width="304" height="477" class="img_ev3q"></p>
<p>For more information about commands to set priorities, see <a href="#set-priority-levels">Set Priority Levels</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-resource-queues">Enable resource queues<a href="#enable-resource-queues" class="hash-link" aria-label="Direct link to Enable resource queues" title="Direct link to Enable resource queues">​</a></h2>
<p>When you install Apache Cloudberry, no resource management policy is enabled by default. To use resource queues, set the <code>gp_resource_manager</code> server configuration parameter:</p>
<ol>
<li>
<p>Set the <code>gp_resource_manager</code> server configuration parameter to the value <code>&quot;queue&quot;</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpconfig -c gp_resource_manager -v &quot;queue&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Restart Apache Cloudberry:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpstop</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpstart </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-resource-queues">Configure resource queues<a href="#configure-resource-queues" class="hash-link" aria-label="Direct link to Configure resource queues" title="Direct link to Configure resource queues">​</a></h2>
<p>Before you create any resource groups, learn about the different resouce queue server configuration parameters and their usage.</p>
<ol>
<li>
<p>General configuration.</p>
<ul>
<li><code>max_resource_queues</code> - Sets the maximum number of resource queues.</li>
<li><code>max_resource_portals_per_transaction</code> - Sets the maximum number of simultaneously open cursors allowed per transaction. Note that an open cursor will hold an active query slot in a resource queue.</li>
<li><code>resource_select_only</code> - If set to <code>on</code>, then <code>SELECT</code>, <code>SELECT INTO</code>, <code>CREATE TABLE AS``SELECT</code>, and <code>DECLARE CURSOR</code> commands are evaluated. If set to <code>off</code>, <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> commands will be evaluated as well.</li>
<li><code>resource_cleanup_gangs_on_wait</code> - Cleans up idle segment worker processes before taking a slot in the resource queue.</li>
<li><code>stats_queue_level</code> - Enables statistics collection on resource queue usage, which can then be viewed by querying the pg_stat_resqueues system view.</li>
</ul>
</li>
<li>
<p>Memory utilization.</p>
<ul>
<li>
<p><code>gp_resqueue_memory_policy</code> - Enables Apache Cloudberry memory management features.</p>
<p>In Apache Cloudberry, the distribution algorithm <code>eager_free</code> takes advantage of the fact that not all operators run at the same time. The query plan is divided into stages and Apache Cloudberry eagerly frees memory allocated to a previous stage at the end of that stage&#x27;s execution, then allocates the eagerly freed memory to the new stage.</p>
<p>When set to <code>auto</code>, query memory usage is controlled by <code>statement_mem</code> and resource queue memory limits.</p>
</li>
<li>
<p><code>statement_mem</code> and <code>max_statement_mem</code> - Used to allocate memory to a particular query at runtime (override the default allocation assigned by the resource queue). <code>max_statement_mem</code> is set by database superusers to prevent regular database users from over-allocation.</p>
</li>
<li>
<p><code>gp_vmem_protect_limit</code> - Sets the upper boundary that all query processes can consume and should not exceed the amount of physical memory of a segment host. When a segment host reaches this limit during query execution, the queries that cause the limit to be exceeded will be cancelled.</p>
</li>
<li>
<p><code>gp_vmem_idle_resource_timeout</code> and <code>gp_vmem_protect_segworker_cache_limit</code> - used to free memory on segment hosts held by idle database processes. Administrators may want to adjust these settings on systems with lots of concurrency.</p>
</li>
<li>
<p><code>shared_buffers</code> - Sets the amount of memory a Cloudberry server instance uses for shared memory buffers. This setting must be at least 128 kilobytes and at least 16 kilobytes times <code>max_connections</code>. The value must not exceed the operating system shared memory maximum allocation request size, <code>shmmax</code> on Linux.</p>
</li>
</ul>
</li>
<li>
<p>Query prioritization. Note that the following parameters are all local parameters, meaning they must be set in the <code>postgresql.conf</code> files of the coordinator and all segments:</p>
<ul>
<li>
<p><code>gp_resqueue_priority</code> - The query prioritization feature is enabled by default.</p>
</li>
<li>
<p><code>gp_resqueue_priority_sweeper_interval</code> - Sets the interval at which CPU usage is recalculated for all active statements. The default value for this parameter should be sufficient for typical database operations.</p>
</li>
<li>
<p><code>gp_resqueue_priority_cpucores_per_segment</code> - Specifies the number of CPU cores allocated per segment instance on a segment host. If the segment is configured with primary-mirror segment instance pairs, use the number of primary segment instances on the host in the calculation. The default value is 4 for the coordinator and segment hosts.</p>
<p>Each Cloudberry host checks its own <code>postgresql.conf</code> file for the value of this parameter. This parameter also affects the coordinator host, where it should be set to a value reflecting the higher ratio of CPU cores. For example, on a cluster that has 10 CPU cores per segment host and 4 primary segments per host, you would specify the following values for <code>gp_resqueue_priority_cpucores_per_segment</code>:</p>
<ul>
<li><code>10</code> on the coordinator and standby coordinator hosts. Typically, only a single coordinator segment instance runs on the coordinator host.</li>
<li><code>2.5</code> on each segment host (10 cores divided by 4 primary segments).</li>
</ul>
<p>If the parameter value is not set correctly, either the CPU might not be fully utilized, or query prioritization might not work as expected. For example, if the Apache Cloudberry cluster has fewer than one segment instance per CPU core on your segment hosts, make sure that you adjust this value accordingly.</p>
<p>Actual CPU core utilization is based on the ability of Apache Cloudberry to parallelize a query and the resources required to run the query.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Include any CPU core that is available to the operating system in the number of CPU cores, including virtual CPU cores.</p></div></div>
</li>
</ul>
</li>
</ol>
<p>Use the <code>gpconfig</code> utility to view or change any of the resource management parameter values. For example, to see the setting of a particular parameter:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpconfig --show gp_vmem_protect_limit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To set one value on all segment instances and a different value on the coordinator:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpconfig -c gp_resqueue_priority_cpucores_per_segment -v 2 -m 8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Restart Apache Cloudberry to make the configuration changes effective:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpstop -r</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-resource-queues">Create resource queues<a href="#create-resource-queues" class="hash-link" aria-label="Direct link to Create resource queues" title="Direct link to Create resource queues">​</a></h2>
<p>When you create a resource queue for a role, you provide a name, set an active query limit, and optionally a query priority for the resource queue. Use the <a href="/docs/next/sql-stmts/create-resource-queue"><code>CREATE RESOURCE QUEUE</code></a> command to create new resource queues.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-queues-with-an-active-query-limit">Create queues with an active query limit<a href="#create-queues-with-an-active-query-limit" class="hash-link" aria-label="Direct link to Create queues with an active query limit" title="Direct link to Create queues with an active query limit">​</a></h3>
<p>Resource queues with an <code>ACTIVE_STATEMENTS</code> setting limit the number of queries that can be run by roles assigned to that queue. For example, to create a resource queue named <code>adhoc</code> with an active query limit of three:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> RESOURCE QUEUE adhoc </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ACTIVE_STATEMENTS</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This means that for all roles assigned to the <code>adhoc</code> resource queue, only three active queries can be running on the system at any given time. If this queue has three queries running, and a fourth query is submitted by a role in that queue, that query must wait until a slot is free before it can run.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-queues-with-memory-limits">Create queues with memory limits<a href="#create-queues-with-memory-limits" class="hash-link" aria-label="Direct link to Create queues with memory limits" title="Direct link to Create queues with memory limits">​</a></h3>
<p>Resource queues with a <code>MEMORY_LIMIT</code> setting control the amount of memory for all the queries submitted through the queue. The total memory should not exceed the physical memory available per-segment. Set <code>MEMORY_LIMIT</code> to 90% of memory available on a per-segment basis. For example, if a host has 48 GB of physical memory and 6 segment instances, then the memory available per segment instance is 8 GB. You can calculate the recommended <code>MEMORY_LIMIT</code> for a single queue as 0.90*8=7.2 GB. If there are multiple queues created on the system, their total memory limits must also add up to 7.2 GB.</p>
<p>When used in conjunction with <code>ACTIVE_STATEMENTS</code>, the default amount of memory allotted per query is: <code>MEMORY_LIMIT / ACTIVE_STATEMENTS</code>. When used in conjunction with <code>MAX_COST</code>, the default amount of memory allotted per query is: <code>MEMORY_LIMIT * (query_cost / MAX_COST)</code>. Use <code>MEMORY_LIMIT</code> in conjunction with <code>ACTIVE_STATEMENTS</code> rather than with <code>MAX_COST</code>.</p>
<p>For example, to create a resource queue with an active query limit of 10 and a total memory limit of 2000MB (each query will be allocated 200MB of segment host memory at execution time):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> RESOURCE QUEUE myqueue </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ACTIVE_STATEMENTS</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">20</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">MEMORY_LIMIT</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;2000MB&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The default memory allotment can be overridden on a per-query basis using the <code>statement_mem</code> server configuration parameter, provided that <code>MEMORY_LIMIT</code> or <code>max_statement_mem</code> is not exceeded. For example, to allocate more memory to a particular query:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> statement_mem</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;2GB&#x27;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> my_big_table </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">column</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;value&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">BY</span><span class="token plain"> id</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">RESET statement_mem</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As a general guideline, <code>MEMORY_LIMIT</code> for all of your resource queues should not exceed the amount of physical memory of a segment host. If workloads are staggered over multiple queues, it may be OK to oversubscribe memory allocations, keeping in mind that queries may be cancelled during execution if the segment host memory limit (<code>gp_vmem_protect_limit</code>) is exceeded.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-priority-levels">Set priority levels<a href="#set-priority-levels" class="hash-link" aria-label="Direct link to Set priority levels" title="Direct link to Set priority levels">​</a></h3>
<p>To control a resource queue&#x27;s consumption of available CPU resources, an administrator can assign an appropriate priority level. When high concurrency causes contention for CPU resources, queries and statements associated with a high-priority resource queue will claim a larger share of available CPU than lower priority queries and statements.</p>
<p>Priority settings are created or altered using the <code>WITH</code> parameter of the commands <code>CREATE RESOURCE QUEUE</code> and <code>ALTER RESOURCE QUEUE</code>. For example, to specify priority settings for the <code>adhoc</code> and <code>reporting</code> queues, an administrator would use the following commands:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> RESOURCE QUEUE adhoc </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">PRIORITY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">LOW</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> RESOURCE QUEUE reporting </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">PRIORITY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">HIGH</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To create the <code>executive</code> queue with maximum priority, an administrator would use the following command:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> RESOURCE QUEUE executive </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ACTIVE_STATEMENTS</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> PRIORITY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">MAX</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the query prioritization feature is enabled, resource queues are given a <code>MEDIUM</code> priority by default if not explicitly assigned. For more information on how priority settings are evaluated at runtime, see <a href="#how-priorities-work">How Priorities Work</a>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>In order for resource queue priority levels to be enforced on the active query workload, you must enable the query prioritization feature by setting the associated server configuration parameters. See <a href="#configure-resource-queues">Configure Resource Queues</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="assign-roles-to-a-resource-queue">Assign roles to a resource queue<a href="#assign-roles-to-a-resource-queue" class="hash-link" aria-label="Direct link to Assign roles to a resource queue" title="Direct link to Assign roles to a resource queue">​</a></h2>
<p>Once a resource queue is created, you must assign roles (users) to their appropriate resource queue. If roles are not explicitly assigned to a resource queue, they will go to the default resource queue, <code>pg_default</code>. The default resource queue has an active statement limit of <code>20</code>, no cost limit, and a medium priority setting.</p>
<p>Use the <code>ALTER ROLE</code> or <code>CREATE ROLE</code> commands to assign a role to a resource queue. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> ROLE </span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token plain"> RESOURCE QUEUE </span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">queue_name</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> ROLE </span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> LOGIN RESOURCE QUEUE </span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">queue_name</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A role can only be assigned to one resource queue at any given time, so you can use the <code>ALTER ROLE</code> command to initially assign or change a role&#x27;s resource queue.</p>
<p>Resource queues must be assigned on a user-by-user basis. If you have a role hierarchy (for example, a group-level role) then assigning a resource queue to the group does not propagate down to the users in that group.</p>
<p>Superusers are always exempt from resource queue limits. Superuser queries will always run regardless of the limits set on their assigned queue.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-a-role-from-a-resource-queue">Remove a role from a resource queue<a href="#remove-a-role-from-a-resource-queue" class="hash-link" aria-label="Direct link to Remove a role from a resource queue" title="Direct link to Remove a role from a resource queue">​</a></h3>
<p>All users need to be assigned to a resource queue. If not explicitly assigned to a particular queue, users will go into the default resource queue, <code>pg_default</code>. If you wish to remove a role from a resource queue and put them in the default queue, change the role&#x27;s queue assignment to <code>none</code>. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> ROLE </span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">role_name</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token plain"> RESOURCE QUEUE none</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="modify-resource-queues">Modify resource queues<a href="#modify-resource-queues" class="hash-link" aria-label="Direct link to Modify resource queues" title="Direct link to Modify resource queues">​</a></h2>
<p>After a resource queue has been created, you can change or reset the queue limits using the <code>ALTER RESOURCE QUEUE</code> command. You can remove a resource queue using the <code>DROP RESOURCE QUEUE</code> command. To change the roles (users) assigned to a resource queue, <a href="#assign-roles-to-a-resource-queue">Assign Roles to a Resource Queue</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alter-a-resource-queue">Alter a resource queue<a href="#alter-a-resource-queue" class="hash-link" aria-label="Direct link to Alter a resource queue" title="Direct link to Alter a resource queue">​</a></h3>
<p>The <code>ALTER RESOURCE QUEUE</code> command changes the limits of a resource queue. To change the limits of a resource queue, specify the new values you want for the queue. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> RESOURCE QUEUE </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">adhoc</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ACTIVE_STATEMENTS</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">5</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> RESOURCE QUEUE </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token keyword" style="color:#66d9ef">exec</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">PRIORITY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">MAX</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To reset active statements or memory limit to no limit, enter a value of <code>-1</code>. To reset the maximum query cost to no limit, enter a value of <code>-1.0</code>. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> RESOURCE QUEUE </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">adhoc</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">MAX_COST</span><span class="token operator" style="color:#66d9ef">=</span><span class="token operator" style="color:#66d9ef">-</span><span class="token number" style="color:#ae81ff">1.0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> MEMORY_LIMIT</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;2GB&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can use the <code>ALTER RESOURCE QUEUE</code> command to change the priority of queries associated with a resource queue. For example, to set a queue to the minimum priority level:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> RESOURCE QUEUE </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">webuser</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">PRIORITY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">MIN</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="drop-a-resource-queue">Drop a resource queue<a href="#drop-a-resource-queue" class="hash-link" aria-label="Direct link to Drop a resource queue" title="Direct link to Drop a resource queue">​</a></h3>
<p>The <code>DROP RESOURCE QUEUE</code> command drops a resource queue. To drop a resource queue, the queue cannot have any roles assigned to it, nor can it have any statements waiting in the queue. See <a href="#remove-a-role-from-a-resource-queue">Remove a Role from a Resource Queue</a> and <a href="#clear-a-waiting-statement-from-a-resource-queue">Clear a Waiting Statement From a Resource Queue</a> for instructions on emptying a resource queue. To drop a resource queue:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">DROP</span><span class="token plain"> RESOURCE QUEUE </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">name</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-resource-queue-status">Monitor resource queue status<a href="#monitor-resource-queue-status" class="hash-link" aria-label="Direct link to Monitor resource queue status" title="Direct link to Monitor resource queue status">​</a></h2>
<p>Monitoring resource queue status involves the following tasks:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-queued-statements-and-resource-queue-status">View queued statements and resource queue status<a href="#view-queued-statements-and-resource-queue-status" class="hash-link" aria-label="Direct link to View queued statements and resource queue status" title="Direct link to View queued statements and resource queue status">​</a></h3>
<p>The <a href="/docs/next/sys-catalogs/gp_toolkit#gp_resqueue_status"><code>gp_toolkit.gp_resqueue_status</code></a> view allows administrators to see status and activity for a resource queue. It shows how many queries are waiting to run and how many queries are currently active in the system from a particular resource queue. To see the resource queues created in the system, their limit attributes, and their current status:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gp_resqueue_status</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-resource-queue-statistics">View resource queue statistics<a href="#view-resource-queue-statistics" class="hash-link" aria-label="Direct link to View resource queue statistics" title="Direct link to View resource queue statistics">​</a></h3>
<p>If you want to track statistics and performance of resource queues over time, you can enable statistics collecting for resource queues. This is done by setting the following server configuration parameter in your coordinator <code>postgresql.conf</code> file:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">stats_queue_level </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">on</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once this is enabled, you can use the <code>pg_stat_resqueue</code> system view to see the statistics collected on resource queue usage. Note that enabling this feature does incur slight performance overhead, as each query submitted through a resource queue must be tracked. It may be useful to enable statistics collecting on resource queues for initial diagnostics and administrative planning, and then deactivate the feature for continued use.</p>
<p>See the Statistics Collector section in the PostgreSQL documentation for more information about collecting statistics in Apache Cloudberry.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-roles-assigned-to-a-resource-queue">View the roles assigned to a resource queue<a href="#view-the-roles-assigned-to-a-resource-queue" class="hash-link" aria-label="Direct link to View the roles assigned to a resource queue" title="Direct link to View the roles assigned to a resource queue">​</a></h3>
<p>To see the roles assigned to a resource queue, perform the following query of the <code>pg_roles</code> and the <code>gp_toolkt.gp_resqueue_status</code> system catalog tables:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> rolname</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rsqname </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">       gp_toolkit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gp_resqueue_status </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">rolresqueue</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">gp_toolkit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gp_resqueue_status</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">queueid</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You may want to create a view of this query to simplify future inquiries. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">VIEW</span><span class="token plain"> role2queue </span><span class="token keyword" style="color:#66d9ef">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> rolname</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rsqname </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> pg_resqueue </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">rolresqueue</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">gp_toolkit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gp_resqueue_status</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">queueid</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then you can just query the view:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> role2queue</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-waiting-queries-for-a-resource-queue">View the waiting queries for a resource queue<a href="#view-the-waiting-queries-for-a-resource-queue" class="hash-link" aria-label="Direct link to View the waiting queries for a resource queue" title="Direct link to View the waiting queries for a resource queue">​</a></h3>
<p>When a slot is in use for a resource queue, it is recorded in the <code>pg_locks</code> system catalog table. This is where you can see all of the currently active and waiting queries for all resource queues. To check that statements are being queued (even statements that are not waiting), you can also use the <a href="/docs/next/sys-catalogs/gp_toolkit#gp_locks_on_resqueue"><code>gp_toolkit.gp_locks_on_resqueue</code></a> view. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gp_locks_on_resqueue </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> lorwaiting</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;true&#x27;</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If this query returns no results, then that means there are currently no statements waiting in a resource queue.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clear-a-waiting-statement-from-a-resource-queue">Clear a waiting statement from a resource queue<a href="#clear-a-waiting-statement-from-a-resource-queue" class="hash-link" aria-label="Direct link to Clear a waiting statement from a resource queue" title="Direct link to Clear a waiting statement from a resource queue">​</a></h3>
<p>In some cases, you may want to clear a waiting statement from a resource queue. For example, you may want to remove a query that is waiting in the queue but has not been run yet. You may also want to stop a query that has been started if it is taking too long to run, or if it is sitting idle in a transaction and taking up resource queue slots that are needed by other users. To do this, you must first identify the statement you want to clear, determine its process id (pid), and then, use <code>pg_cancel_backend</code> with the process id to end that process, as shown below. An optional message to the process can be passed as the second parameter, to indicate to the user why the process was cancelled.</p>
<p>For example, to see process information about all statements currently active or waiting in all resource queues, run the following query:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> rolname</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rsqname</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> pg_locks</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">pid </span><span class="token keyword" style="color:#66d9ef">as</span><span class="token plain"> pid</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> granted</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">       query</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> datname </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gp_resqueue_status</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> pg_locks</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">     pg_stat_activity </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">rolresqueue</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">pg_locks</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">objid </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> pg_locks</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">objid</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">gp_toolkit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gp_resqueue_status</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">queueid</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> pg_stat_activity</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">pid</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">pg_locks</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">pid</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> pg_stat_activity</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">usename</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">pg_roles</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">rolname</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If this query returns no results, then that means there are currently no statements in a resource queue. A sample of a resource queue with two statements in it looks something like this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">rolname </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> rsqname </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">  pid  </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> granted </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> state  </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">         query          </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> datname </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">--------+---------+-------+---------+--------+------------------------+--------- </span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  sammy </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> webuser </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">31861</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> t        </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> idle   </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> testtbl</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> namesdb</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  daria </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> webuser </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">31905</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> f       </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> active </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> topten</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">  </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> namesdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use this output to identify the process id (pid) of the statement you want to clear from the resource queue. To clear the statement, you would then open a terminal window (as the <code>gpadmin</code> database superuser or as root) on the coordinator host and cancel the corresponding process. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">pg_cancel_backend</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">31905</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Do not use the operating system <code>KILL</code> command.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-priority-of-active-statements">View the priority of active statements<a href="#view-the-priority-of-active-statements" class="hash-link" aria-label="Direct link to View the priority of active statements" title="Direct link to View the priority of active statements">​</a></h3>
<p>The <code>gp_toolkit</code> administrative schema has a view called <code>gp_resq_priority_statement</code>, which lists all statements currently being run and provides the priority, session ID, and other information.</p>
<p>This view is only available through the <code>gp_toolkit</code> administrative schema.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reset-the-priority-of-an-active-statement">Reset the priority of an active statement<a href="#reset-the-priority-of-an-active-statement" class="hash-link" aria-label="Direct link to Reset the priority of an active statement" title="Direct link to Reset the priority of an active statement">​</a></h3>
<p>Superusers can adjust the priority of a statement currently being run using the built-in function <code>gp_adjust_priority(session_id, statement_count, priority)</code>. Using this function, superusers can raise or lower the priority of any query. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> gp_adjust_priority</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">752</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">24905</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;HIGH&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To obtain the session ID and statement count parameters required by this function, superusers can use the <code>gp_toolkit</code> administrative schema view <code>gp_resq_priority_statement</code>. From the view, use these values for the function parameters.</p>
<ul>
<li>The value of the <code>rqpsession</code> column for the <code>session_id</code> parameter</li>
<li>The value of the <code>rqpcommand</code> column for the <code>statement_count</code> parameter</li>
<li>The value of <code>rqppriority</code> column is the current priority. You can specify a string value of <code>MAX</code>, <code>HIGH</code>, <code>MEDIUM</code>, or <code>LOW</code> as the <code>priority</code>.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The <code>gp_adjust_priority()</code> function affects only the specified statement. Subsequent statements in the same resource queue are run using the queue&#x27;s normally assigned priority.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/cloudberry-site/edit/main/docs/performance/manage-resources-using-resource-queues.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-08-01T06:14:19.000Z">Aug 1, 2025</time></b> by <b>Dianjin Wang</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/next/performance/manage-resources"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label single-line-overflow hide-before-after">Manage Resources</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/next/performance/manage-resources-using-resource-groups"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label single-line-overflow hide-before-after">Resource Groups</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#resource-queue-example" class="table-of-contents__link toc-highlight">Resource queue example</a></li><li><a href="#how-memory-limits-work" class="table-of-contents__link toc-highlight">How memory limits work</a></li><li><a href="#how-priorities-work" class="table-of-contents__link toc-highlight">How priorities work</a></li><li><a href="#enable-resource-queues" class="table-of-contents__link toc-highlight">Enable resource queues</a></li><li><a href="#configure-resource-queues" class="table-of-contents__link toc-highlight">Configure resource queues</a></li><li><a href="#create-resource-queues" class="table-of-contents__link toc-highlight">Create resource queues</a></li><li><a href="#assign-roles-to-a-resource-queue" class="table-of-contents__link toc-highlight">Assign roles to a resource queue</a></li><li><a href="#modify-resource-queues" class="table-of-contents__link toc-highlight">Modify resource queues</a></li><li><a href="#monitor-resource-queue-status" class="table-of-contents__link toc-highlight">Monitor resource queue status</a></li></ul></div></div></div></div></main></div></div></div><div class="wrap_QlFE"><div class="mainWrap_IbWk"><div class="linksWrap_Zcc4"><div><div class="footerLinkTitle_PxTg">Support</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a></div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a></div><div class="footerLinkItem_Kf4k"><a href="https://inviter.co/apache-cloudberry" target="_blank" rel="noopener noreferrer">Slack</a></div><div class="footerLinkItem_Kf4k"><a href="https://x.com/ASFCloudberry" target="_blank" rel="noopener noreferrer">Twitter</a></div><div class="footerLinkItem_Kf4k"><a href="https://youtube.com/@ApacheCloudberry" target="_blank" rel="noopener noreferrer">Youtube</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/security">Security</a></div></div><div><div class="footerLinkTitle_PxTg">Resources</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/releases" target="_blank" rel="noopener noreferrer">Download</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/docs/">Documentation</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/events">Events</a></div><div class="footerLinkItem_Kf4k"><a href="/community/brand" target="_blank">Brand Guidelines</a></div></div><div><div class="footerLinkTitle_PxTg">Contribution</div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/git">Working with Git &amp; GitHub</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/how-to-contribute">Contribution Overview</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/code">Code Contribution</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/doc">Doc Contribution</a></div></div></div><div class="logoLinkWrap_MDp5"><div class="logoWrap_qcVI"><img class="logo_cphB" src="/img/apache-incubator.svg" alt=""></div><div class="links_yA93"><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.002 0c-8.288 0-15 6.713-15 15 0 6.637 4.293 12.244 10.256 14.231.75.131 1.031-.319 1.031-.712 0-.356-.019-1.538-.019-2.794-3.769.694-4.744-.919-5.044-1.763-.168-.43-.9-1.762-1.537-2.118-.525-.282-1.275-.975-.019-.994 1.181-.019 2.025 1.087 2.306 1.537 1.35 2.27 3.507 1.632 4.37 1.238.13-.975.524-1.631.956-2.006-3.338-.375-6.826-1.669-6.826-7.406 0-1.632.582-2.982 1.538-4.032-.15-.375-.675-1.912.15-3.975 0 0 1.256-.394 4.125 1.538 1.2-.338 2.475-.506 3.75-.506s2.55.168 3.75.506c2.869-1.95 4.125-1.538 4.125-1.538.825 2.063.3 3.6.15 3.975.956 1.05 1.538 2.382 1.538 4.032 0 5.756-3.507 7.03-6.844 7.406.544.468 1.012 1.369 1.012 2.775 0 2.006-.018 3.619-.018 4.125 0 .394.28.862 1.03.712A15.024 15.024 0 0 0 30.003 15c0-8.287-6.713-15-15-15Z"></path></svg><svg width="32" height="26" viewBox="0 0 32 26" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M31.319 3.484c-1.145.507-2.36.84-3.603.987a6.293 6.293 0 0 0 2.758-3.47 12.518 12.518 0 0 1-3.983 1.52A6.274 6.274 0 0 0 15.64 6.815c0 .493.056.97.161 1.43a17.811 17.811 0 0 1-12.93-6.555 6.252 6.252 0 0 0-.85 3.154 6.272 6.272 0 0 0 2.791 5.222 6.253 6.253 0 0 1-2.841-.785l-.001.077a6.277 6.277 0 0 0 5.033 6.153 6.305 6.305 0 0 1-2.834.108 6.278 6.278 0 0 0 5.86 4.356 12.59 12.59 0 0 1-7.79 2.686c-.5 0-1-.03-1.497-.088a17.746 17.746 0 0 0 9.616 2.818c11.54 0 17.849-9.559 17.849-17.848 0-.272-.007-.544-.019-.812a12.746 12.746 0 0 0 3.13-3.246Z"></path></svg><svg width="30" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.366 0c.801.004 2.805.024 4.935.11l.755.032c2.145.102 4.287.275 5.35.571 1.417.398 2.53 1.56 2.907 3.033.6 2.339.675 6.903.684 8.008l.002.229v.032l-.002.229c-.009 1.104-.084 5.669-.684 8.008-.381 1.478-1.495 2.64-2.907 3.032-1.063.297-3.205.47-5.35.571l-.755.033c-2.13.086-4.134.105-4.935.11h-.734c-1.696-.01-8.785-.087-11.04-.714-1.418-.398-2.532-1.56-2.908-3.032-.6-2.34-.675-6.904-.684-8.008v-.49c.01-1.105.084-5.67.684-8.008.382-1.478 1.496-2.64 2.908-3.033C5.847.086 12.936.01 14.632 0h.734Zm-3.367 6.749v10.5l9-5.25-9-5.25Z"></path></svg><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M6.791 18.77a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.951-2.951 2.959 2.959 0 0 1 2.951-2.952h2.952v2.952Zm1.487 0a2.959 2.959 0 0 1 2.952-2.951 2.959 2.959 0 0 1 2.952 2.952v7.39a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.952-2.952v-7.39ZM11.23 6.792A2.959 2.959 0 0 1 8.278 3.84 2.959 2.959 0 0 1 11.23.888a2.959 2.959 0 0 1 2.952 2.951v2.952H11.23Zm0 1.487a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H3.84A2.959 2.959 0 0 1 .887 11.23a2.959 2.959 0 0 1 2.951-2.952h7.391Zm11.98 2.952a2.959 2.959 0 0 1 2.951-2.952 2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H23.21V11.23Zm-1.488 0a2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V3.84A2.959 2.959 0 0 1 18.771.887a2.959 2.959 0 0 1 2.951 2.951v7.391Zm-2.951 11.98a2.959 2.959 0 0 1 2.951 2.951 2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V23.21h2.952Zm0-1.488a2.959 2.959 0 0 1-2.952-2.951 2.959 2.959 0 0 1 2.952-2.952h7.39a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.951h-7.39Z"></path></svg><svg width="28" height="30" viewBox="0 0 28 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M22.48 4.286H5.195c-.845 0-1.52.724-1.52 1.568v18.579c0 .844.675 1.568 1.52 1.568h17.283c.845 0 1.52-.724 1.52-1.568V5.854c0-.844-.675-1.568-1.52-1.568Z"></path><path d="M6.233 12.156h3.081v10.756H6.233V12.156Zm1.57-5.315c.988 0 1.802.875 1.802 1.938s-.814 1.939-1.803 1.939C6.814 10.718 6 9.842 6 8.779c0-1.063.814-1.938 1.802-1.938Zm3.488 5.315h2.965v1.439h.058c.407-.876 1.453-1.751 2.965-1.751 3.14 0 3.721 2.25 3.721 5.127v5.879h-3.081v-5.253c0-1.25 0-2.877-1.628-2.877s-1.86 1.376-1.86 2.752v5.315h-3.082v-10.63h-.058Z" fill="#000"></path></svg><svg width="34" height="28" viewBox="0 0 34 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M26.863 16.567c.748 0 1.347-.636 1.347-1.347 0-.748-.599-1.347-1.347-1.347s-1.347.599-1.347 1.347.599 1.347 1.347 1.347Zm-6.639 0c.749 0 1.347-.636 1.347-1.347 0-.748-.598-1.347-1.347-1.347-.748 0-1.346.599-1.346 1.347s.598 1.347 1.346 1.347Zm9.852 7.56a.52.52 0 0 0-.258.553c0 .074 0 .148.036.221.148.627.442 1.622.442 1.66 0 .11.037.184.037.257a.33.33 0 0 1-.331.332c-.074 0-.11-.037-.184-.074l-2.174-1.253c-.147-.074-.331-.147-.516-.147-.11 0-.22 0-.294.037-1.032.294-2.1.442-3.242.442-5.49 0-9.91-3.687-9.91-8.258 0-4.57 4.42-8.257 9.91-8.257 5.489 0 9.91 3.686 9.91 8.257 0 2.47-1.327 4.719-3.427 6.23ZM24.01 8.147a13.662 13.662 0 0 0-.418-.007c-6.262 0-11.41 4.29-11.41 9.757 0 .83.119 1.634.342 2.4h-.133c-1.33 0-2.659-.221-3.877-.553-.111-.037-.222-.037-.333-.037-.221 0-.443.074-.627.185L4.932 21.4a.525.525 0 0 1-.221.074.409.409 0 0 1-.406-.405c0-.11.036-.184.073-.294.037-.037.37-1.251.554-1.987 0-.074.037-.184.037-.258a.834.834 0 0 0-.332-.662C2.089 16.065.5 13.378.5 10.398.501 4.916 5.855.5 12.428.5 18.073.5 22.82 3.753 24.01 8.146Zm-7.73.627c.859 0 1.54-.716 1.54-1.54 0-.858-.681-1.539-1.54-1.539-.86 0-1.54.68-1.54 1.54 0 .859.68 1.54 1.54 1.54Zm-7.89 0c.86 0 1.54-.716 1.54-1.54 0-.858-.68-1.539-1.54-1.539-.859 0-1.539.68-1.539 1.54 0 .859.68 1.54 1.54 1.54Z"></path></svg></div></div></div><div class="copyrightWrap_yPz7"><div class="copyright_AoBa">
      <p>
        Apache Cloudberry is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
      </p>
      <p>
        Copyright © 2025 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p>
      <p>
        Apache®, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.
      </p>
      </div></div></div></div>
</body>
</html>