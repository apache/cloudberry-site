<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.x docs-doc-page docs-doc-id-tutorials/best-practices/high-availability-best-practices" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">High Availability | Apache Cloudberry (Incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cloudberry.apache.org/docs/tutorials/best-practices/high-availability-best-practices"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.x"><meta data-rh="true" name="docsearch:version" content="2.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.x"><meta data-rh="true" property="og:title" content="High Availability | Apache Cloudberry (Incubating)"><meta data-rh="true" name="description" content="Apache Cloudberry supports highly available, fault-tolerant database services when you enable and properly configure Cloudberry high availability features. To guarantee a required level of service, each component must have a standby ready to take its place if it should fail."><meta data-rh="true" property="og:description" content="Apache Cloudberry supports highly available, fault-tolerant database services when you enable and properly configure Cloudberry high availability features. To guarantee a required level of service, each component must have a standby ready to take its place if it should fail."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cloudberry.apache.org/docs/tutorials/best-practices/high-availability-best-practices"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/tutorials/best-practices/high-availability-best-practices" hreflang="en"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/tutorials/best-practices/high-availability-best-practices" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. JSON Feed">




<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","66"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.6426df7d.css">
<script src="/assets/js/runtime~main.e1e5dc1c.js" defer="defer"></script>
<script src="/assets/js/main.6d54dab6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="tipsWrap_WWTe"><div class="tipsContent_sMsy"><div class="text_VINd"><a href="https://github.com/apache/cloudberry" target="_blank" rel="noopener noreferrer"><span>If you like Apache Cloudberry (Incubating), give it a star on GitHub! </span><img src="/img/home/hcard/star.svg" alt=""></a></div><div class="close_vVex"><img src="/img/home/hcard/close.svg" alt=""></div></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div class="nav-left-logo"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apache_cloudberry_color_black.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/apache_cloudberry_color_white.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.x (Current)</a></li><li><a class="dropdown__link" href="/docs/1.x">1.x</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community">Overview</a></li><li><a class="dropdown__link" href="/community/slack">Slack Guide</a></li><li><a class="dropdown__link" href="/community/wechat">WeChat Guide</a></li><li><a class="dropdown__link" href="/community/events">Community Events</a></li><li><a class="dropdown__link" href="/community/mailing-lists">Mailing Lists</a></li><li><a class="dropdown__link" href="/community/brand">Brand Guidelines</a></li><li><a class="dropdown__link" href="/community/security">Security Policy</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute">Overview</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/git">Working with Git &amp; GitHub</a></li><li><a class="dropdown__link" href="/contribute/code">Code Contribution Guide</a></li><li><a class="dropdown__link" href="/contribute/proposal">Proposal Guide</a></li><li><a class="dropdown__link" href="/contribute/doc">Doc Contribution Guide</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/releases">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Team</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/team">Who we are</a></li><li><a class="dropdown__link" href="/team/new-committers">Inviting New Committers</a></li><li><a class="dropdown__link" href="/team/sign-icla">Sign ICLA</a></li><li><a class="dropdown__link" href="/team/setup-apache-email-account">Setup the Apache account</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/cloudberry/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/cloudberry/discussions/868" target="_blank" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li><li><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum</a></li><li><a class="dropdown__link" href="/support">Support</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div><div class="toggle_vylO colorModeToggle_x44X check-theme-switch"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_BF9v"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_Rg9N"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebarViewport_pYEE"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/deployment/">Deploy and Build</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/data-loading/">Load Data</a><button aria-label="Expand sidebar category &#x27;Load Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/operate-with-data/operate-with-db-objects/create-and-manage-database">Create and Prepare</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/operate-with-data/operate-with-db-objects/create-and-manage-tablespaces">Operate with Data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/performance/define-database-performance">Optimize Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/security/">Security and Permission</a><button aria-label="Expand sidebar category &#x27;Security and Permission&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sys-admin/backup-and-restore/">Manage System</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/developer/develop-extensions-using-rust">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/ecosystem/sql-clients/dbeaver">Ecosystem</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sql-stmts/">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/tutorials/crash-course">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/crash-course">Apache Cloudberry Crash Course</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/tutorials/quick-trial-lessons/">Quick Trial Lessons</a><button aria-label="Expand sidebar category &#x27;Quick Trial Lessons&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/tutorials/product-principles/about-mvcc">Product Principles</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/tutorials/best-practices/">Best Practices</a><button aria-label="Collapse sidebar category &#x27;Best Practices&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/schema-design-best-practices">Schema Design Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/load-data-best-practices">Load Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/db-encryption-best-practices">Encrypt Data and Database Connections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/best-practices/high-availability-best-practices">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/resource-group-best-practices">Memory and Resource Management with Resource Groups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/system-configuration-best-practices">System Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/system-monitor-and-maintain-best-practices">System Monitoring and Maintenance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/manage-bloat">Manage Bloat in a Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/identify-and-mitigate-heap-table-performance-issues">Identify and Mitigate Heap Table Performance Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/security-best-practices">Security</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_hjYf"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link" id="支付">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" style="cursor:pointer">Best Practices</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">High Availability</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>High Availability</h1>
<p>Apache Cloudberry supports highly available, fault-tolerant database services when you enable and properly configure Cloudberry high availability features. To guarantee a required level of service, each component must have a standby ready to take its place if it should fail.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="disk-storage">Disk storage<a href="#disk-storage" class="hash-link" aria-label="Direct link to Disk storage" title="Direct link to Disk storage">​</a></h2>
<p>With the Apache Cloudberry &quot;shared-nothing&quot; MPP architecture, the coordinator host and segment hosts each have their own dedicated memory and disk storage, and each coordinator or segment instance has its own independent data directory. For both reliability and high performance, it is recommended to use a hardware RAID storage solution with from 8 to 24 disks. A larger number of disks improves I/O throughput when using RAID 5 (or 6) because striping increases parallel disk I/O. The RAID controller can continue to function with a failed disk because it saves parity data on each disk in a way that it can reconstruct the data on any failed member of the array. If a hot spare is configured (or an operator replaces the failed disk with a new one) the controller rebuilds the failed disk automatically.</p>
<p>RAID 1 exactly mirrors disks, so if a disk fails, a replacement is immediately available with performance equivalent to that before the failure. With RAID 5 each I/O for data on the failed array member must be reconstructed from data on the remaining active drives until the replacement disk is rebuilt, so there is a temporary performance degradation. If the Cloudberry coordinator and segments are mirrored, you can switch any affected Cloudberry instances to their mirrors during the rebuild to maintain acceptable performance.</p>
<p>A RAID disk array can still be a single point of failure, for example, if the entire RAID volume fails. At the hardware level, you can protect against a disk array failure by mirroring the array, using either host operating system mirroring or RAID controller mirroring, if supported.</p>
<p>It is important to regularly monitor available disk space on each segment host. Query the <code>gp_disk_free</code> external table in the <code>gptoolkit</code> schema to view disk space available on the segments. This view runs the Linux <code>df</code> command. Be sure to check that there is sufficient disk space before performing operations that consume large amounts of disk, such as copying a large table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h3>
<ul>
<li>Use a hardware RAID storage solution with 8 to 24 disks.</li>
<li>Use RAID 1, 5, or 6 so that the disk array can tolerate a failed disk.</li>
<li>Configure a hot spare in the disk array to allow rebuild to begin automatically when disk failure is detected.</li>
<li>Protect against failure of the entire disk array and degradation during rebuilds by mirroring the RAID volume.</li>
<li>Monitor disk utilization regularly and add additional space when needed.</li>
<li>Monitor segment skew to ensure that data is distributed evenly and storage is consumed evenly at all segments.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="coordinator-mirroring">Coordinator mirroring<a href="#coordinator-mirroring" class="hash-link" aria-label="Direct link to Coordinator mirroring" title="Direct link to Coordinator mirroring">​</a></h2>
<p>The Apache Cloudberry coordinator instance is clients&#x27; single point of access to the system. The coordinator instance stores the global system catalog, the set of system tables that store metadata about the database instance, but no user data. If an unmirrored coordinator instance fails or becomes inaccessible, the Cloudberry instance is effectively off-line, because the entry point to the system has been lost. For this reason, a standby coordinator must be ready to take over if the primary coordinator fails.</p>
<p>Coordinator mirroring uses two processes, a sender on the active coordinator host and a receiver on the mirror host, to synchronize the mirror with the coordinator. As changes are applied to the coordinator system catalogs, the active coordinator streams its write-ahead log (WAL) to the mirror so that each transaction applied on the coordinator is applied on the mirror.</p>
<p>The mirror is a <em>warm standby</em>. If the primary coordinator fails, switching to the standby requires an administrative user to run the <code>gpactivatestandby</code> utility on the standby host so that it begins to accept client connections. Clients must reconnect to the new coordinator and will lose any work that was not committed when the primary failed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-1">Best practices<a href="#best-practices-1" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h3>
<ul>
<li>Set up a standby coordinator instance—a <em>mirror</em>—to take over if the primary coordinator fails.</li>
<li>The standby can be on the same host or on a different host, but it is best practice to place it on a different host from the primary coordinator to protect against host failure.</li>
<li>Plan how to switch clients to the new coordinator instance when a failure occurs, for example, by updating the coordinator address in DNS.</li>
<li>Set up monitoring to send notifications in a system monitoring application or by email when the primary fails.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="segment-mirroring">Segment mirroring<a href="#segment-mirroring" class="hash-link" aria-label="Direct link to Segment mirroring" title="Direct link to Segment mirroring">​</a></h2>
<p>Apache Cloudberry segment instances each store and manage a portion of the database data, with coordination from the coordinator instance. If any unmirrored segment fails, the database may have to be shutdown and recovered, and transactions occurring after the most recent backup could be lost. Mirroring segments is, therefore, an essential element of a high availability solution.</p>
<p>A segment mirror is a hot standby for a primary segment. Apache Cloudberry detects when a segment is unavailable and automatically activates the mirror. During normal operation, when the primary segment instance is active, data is replicated from the primary to the mirror in two ways:</p>
<ul>
<li>
<p>The transaction commit log is replicated from the primary to the mirror before the transaction is committed. This ensures that if the mirror is activated, the changes made by the last successful transaction at the primary are present at the mirror. When the mirror is activated, transactions in the log are applied to tables in the mirror.</p>
</li>
<li>
<p>Second, segment mirroring uses physical file replication to update heap tables. Cloudberry Server stores table data on disk as fixed-size blocks packed with tuples. To optimize disk I/O, blocks are cached in memory until the cache fills and some blocks must be evicted to make room for newly updated blocks. When a block is evicted from the cache it is written to disk and replicated over the network to the mirror. Because of the caching mechanism, table updates at the mirror can lag behind the primary. However, because the transaction log is also replicated, the mirror remains consistent with the primary. If the mirror is activated, the activation process updates the tables with any unapplied changes in the transaction commit log.</p>
</li>
</ul>
<p>When the acting primary is unable to access its mirror, replication stops and state of the primary changes to &quot;Change Tracking.&quot; The primary saves changes that have not been replicated to the mirror in a system table to be replicated to the mirror when it is back on-line.</p>
<p>The coordinator automatically detects segment failures and activates the mirror. Transactions in progress at the time of failure are restarted using the new primary. Depending on how mirrors are deployed on the hosts, the database system may be unbalanced until the original primary segment is recovered. For example, if each segment host has four primary segments and four mirror segments, and a mirror is activated on one host, that host will have five active primary segments. Queries are not complete until the last segment has finished its work, so performance can be degraded until the balance is restored by recovering the original primary.</p>
<p>Administrators perform the recovery while Apache Cloudberry is up and running by running the <code>gprecoverseg</code> utility. This utility locates the failed segments, verifies they are valid, and compares the transactional state with the currently active segment to determine changes made while the segment was offline. <code>gprecoverseg</code> synchronizes the changed database files with the active segment and brings the segment back online.</p>
<p>It is important to reserve enough memory and CPU resources on segment hosts to allow for increased activity from mirrors that assume the primary role during a failure.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-2">Best practices<a href="#best-practices-2" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h3>
<ul>
<li>Set up mirrors for all segments.</li>
<li>Locate primary segments and their mirrors on different hosts to protect against host failure.</li>
<li>Mirrors can be on a separate set of hosts or co-located on hosts with primary segments.</li>
<li>Set up monitoring to send notifications in a system monitoring application or by email when a primary segment fails.</li>
<li>Recover failed segments promptly, using the <code>gprecoverseg</code> utility, to restore redundancy and return the system to optimal balance.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dual-clusters">Dual clusters<a href="#dual-clusters" class="hash-link" aria-label="Direct link to Dual clusters" title="Direct link to Dual clusters">​</a></h2>
<p>For some use cases, an additional level of redundancy can be provided by maintaining two Apache Cloudberry clusters that store the same data. The decision to implement dual clusters should be made with business requirements in mind.</p>
<p>There are two recommended methods for keeping the data synchronized in a dual cluster configuration. The first method is called Dual ETL. ETL (extract, transform, and load) is the common data warehousing process of cleansing, transforming, validating, and loading data into a data warehouse. With Dual ETL, the ETL processes are performed twice, in parallel on each cluster, and validated each time. Dual ETL provides for a complete standby cluster with the same data. It also provides the capability to query the data on both clusters, doubling the processing throughput. The application can take advantage of both clusters as needed and also ensure that the ETL is successful and validated on both sides.</p>
<p>The second mechanism for maintaining dual clusters is backup and restore. The data is backed­up on the primary cluster, then the backup is replicated to and restored on the second cluster. The backup and restore mechanism has higher latency than Dual ETL, but requires less application logic to be developed. Backup and restore is ideal for use cases where data modifications and ETL are done daily or less frequently.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-3">Best practices<a href="#best-practices-3" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h3>
<ul>
<li>Consider a Dual Cluster configuration to provide an additional level of redundancy and additional query processing throughput.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="backup-and-restore">Backup and restore<a href="#backup-and-restore" class="hash-link" aria-label="Direct link to Backup and restore" title="Direct link to Backup and restore">​</a></h2>
<p>Backups are recommended for Apache Cloudberry databases unless the data in the database can be easily and cleanly regenerated from source data. Backups protect from operational, software, or hardware errors.</p>
<p>The <code>gpbackup</code> utility makes backups in parallel across the segments, so that backups scale as the cluster grows in hardware size.</p>
<p>A backup strategy must consider where the backups will be written and where they will be stored. Backups can be taken to the local cluster disks, but they should not be stored there permanently. If the database and its backup are on the same storage, they can be lost simultaneously. The backup also occupies space that could be used for database storage or operations. After performing a local backup, the files should be copied to a safe, off-cluster location.</p>
<p>An alternative is to back up directly to an NFS mount. If each host in the cluster has an NFS mount, the backups can be written directly to NFS storage. A scale-out NFS solution is recommended to ensure that backups do not bottleneck on the IO throughput of the NFS device. Dell EMC Isilon is an example of this type of solution and can scale alongside the Cloudberry cluster.</p>
<p>Finally, through native API integration, Apache Cloudberry can stream backups directly to the Dell EMC Data Domain enterprise backup platform.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-4">Best practices<a href="#best-practices-4" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h3>
<ul>
<li>
<p>Back up Apache Cloudberrys regularly unless the data is easily restored from sources.</p>
</li>
<li>
<p>Use the <code>gpbackup</code> command to specify only the schema and tables that you want backed up. See the <a href="/docs/sys-admin/backup-and-restore/"><code>gpbackup</code></a> reference for more information.</p>
</li>
<li>
<p><code>gpbackup</code> places <code>SHARED ACCESS</code> locks on the set of tables to back up. Backups with fewer tables are more efficient for selectively restoring schemas and tables, because <code>gprestore</code> does not have to search through the entire database.</p>
</li>
<li>
<p>If backups are saved to local cluster storage, move the files to a safe, off-cluster location when the backup is complete. Backup files and database files that reside on the same storage can be lost simultaneously.</p>
</li>
<li>
<p>If backups are saved to NFS mounts, use a scale-out NFS solution such as Dell EMC Isilon to prevent IO bottlenecks.</p>
</li>
<li>
<p>Cloudberry users should consider streaming backups to the Dell EMC Data Domain enterprise backup platform.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="detect-failed-coordinator-and-segment-instances">Detect failed coordinator and segment instances<a href="#detect-failed-coordinator-and-segment-instances" class="hash-link" aria-label="Direct link to Detect failed coordinator and segment instances" title="Direct link to Detect failed coordinator and segment instances">​</a></h2>
<p>Recovering from system failures requires intervention from a system administrator, even when the system detects a failure and activates a standby for the failed component. In each case, the failed component must be replaced or recovered to restore full redundancy. Until the failed component is recovered, the active component lacks a standby, and the system may not be performing optimally. For these reasons, it is important to perform recovery operations promptly. Constant system monitoring ensures that administrators are aware of failures that demand their attention.</p>
<p>The Apache Cloudberry server <code>ftsprobe</code> subprocess handles fault detection. <code>ftsprobe</code> connects to and scans all segments and database processes at intervals that you can configure with the <code>gp_fts_probe_interval</code> configuration parameter. If <code>ftsprobe</code> cannot connect to a segment, it marks the segment “down” in the Apache Cloudberry system catalog. The segment remains down until an administrator runs the <code>gprecoverseg</code> recovery utility.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-5">Best practices<a href="#best-practices-5" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h3>
<ul>
<li>Run the <code>gpstate</code> utility to see the overall state of the Cloudberry system.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-information">Additional information<a href="#additional-information" class="hash-link" aria-label="Direct link to Additional information" title="Direct link to Additional information">​</a></h3>
<p><em>Apache Cloudberry Administrator Guide</em>:</p>
<ul>
<li><a href="/docs/sys-admin/check-database-system">Monitor a Cloudberry System</a></li>
</ul>
<p><em>Apache Cloudberry Utility Guide</em>:</p>
<ul>
<li><a href="/docs/sys-utilities/gpstate">gpstate</a> - view state of the Cloudberry system</li>
<li><a href="/docs/sys-utilities/gprecoverseg">gprecoverseg</a> - recover a failed segment</li>
<li><a href="/docs/sys-utilities/gpactivatestandby">gpactivatestandby</a> - make the standby coordinator the active coordinator</li>
</ul>
<p><a href="https://datatracker.ietf.org/doc/html/rfc1697" target="_blank" rel="noopener noreferrer">RDBMS MIB Specification</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-segment-mirroring">Configure segment mirroring<a href="#configure-segment-mirroring" class="hash-link" aria-label="Direct link to Configure segment mirroring" title="Direct link to Configure segment mirroring">​</a></h2>
<p>Segment mirroring allows database queries to fail over to a backup segment if the primary segment fails or becomes unavailable. Cloudberry requires mirroring for supported production Apache Cloudberry systems.</p>
<p>A primary segment and its mirror must be on different hosts to ensure high availability. Each host in a Apache Cloudberry system has the same number of primary segments and mirror segments. Multi-homed hosts should have the same numbers of primary and mirror segments on each interface. This ensures that segment hosts and network resources are equally loaded when all primary segments are operational and brings the most resources to bear on query processing.</p>
<p>When a segment becomes unavailable, its mirror segment on another host becomes the active primary and processing continues. The additional load on the host creates skew and degrades performance, but should allow the system to continue. A database query is not complete until all segments return results, so a single host with an additional active primary segment has the same effect as adding an additional primary segment to every host in the cluster.</p>
<p>The least amount of performance degradation in a failover scenario occurs when no host has more than one mirror assuming the primary role. If multiple segments or hosts fail, the amount of degradation is determined by the host or hosts with the largest number of mirrors assuming the primary role. Spreading a host&#x27;s mirrors across the remaining hosts minimizes degradation when any single host fails.</p>
<p>It is important, too, to consider the cluster&#x27;s tolerance for multiple host failures and how to maintain a mirror configuration when expanding the cluster by adding hosts. There is no mirror configuration that is ideal for every situation.</p>
<p>You can allow Apache Cloudberry to arrange mirrors on the hosts in the cluster using one of two standard configurations, or you can design your own mirroring configuration.</p>
<p>The two standard mirroring arrangements are <em>group mirroring</em> and <em>spread mirroring</em>:</p>
<ul>
<li><strong>Group mirroring</strong> — Each host mirrors another host&#x27;s primary segments. This is the default for <code>gpinitsystem</code>.</li>
<li><strong>Spread mirroring</strong> — Mirrors are spread across the available hosts. This requires that the number of hosts in the cluster is greater than the number of segments per host.</li>
</ul>
<p>You can design a custom mirroring configuration and use the Cloudberry <code>gpaddmirrors</code> or <a href="/docs/sys-utilities/gpmovemirrors"><code>gpmovemirrors</code></a> utilities to set up the configuration.</p>
<p><em>Block mirroring</em> is a custom mirror configuration that divides hosts in the cluster into equally sized blocks and distributes mirrors evenly to hosts within the block. If a primary segment fails, its mirror on another host within the same block becomes the active primary. If a segment host fails, mirror segments on each of the other hosts in the block become active.</p>
<p>The following sections compare the group, spread, and block mirroring configurations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-group-mirroring">Configure group mirroring<a href="#configure-group-mirroring" class="hash-link" aria-label="Direct link to Configure group mirroring" title="Direct link to Configure group mirroring">​</a></h3>
<p>Group mirroring is easiest to set up and is the default Cloudberry mirroring configuration. It is least expensive to expand, because it can be done by adding as few as two hosts. There is no need to move mirrors after expansion to maintain a consistent mirror configuration.</p>
<p>The following diagram shows a group mirroring configuration with eight primary segments on four hosts.</p>
<p><img decoding="async" loading="lazy" alt="Group mirroring configuration" src="/assets/images/group-mirroring-1-9b0f633d6000f2ac466c7c8948081629.png" width="464" height="432" class="img_ev3q"></p>
<p>Unless both the primary and mirror of the same segment instance fail, up to half of your hosts can fail and the cluster will continue to run as long as resources (CPU, memory, and IO) are sufficient to meet the needs.</p>
<p>Any host failure will degrade performance by half or more because the host with the mirrors will have twice the number of active primaries. If your resource utilization is normally greater than 50%, you will have to adjust your workload until the failed host is recovered or replaced. If you normally run at less than 50% resource utilization the cluster can continue to operate at a degraded level of performance until the failure is corrected.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-spread-mirroring">Configure spread mirroring<a href="#configure-spread-mirroring" class="hash-link" aria-label="Direct link to Configure spread mirroring" title="Direct link to Configure spread mirroring">​</a></h3>
<p>With spread mirroring, mirrors for each host&#x27;s primary segments are spread across as many hosts as there are segments per host. Spread mirroring is easy to set up when the cluster is initialized, but requires that the cluster have at least one more host than there are segments per host.</p>
<p>The following diagram shows the spread mirroring configuration for a cluster with three primaries on four hosts.</p>
<p><img decoding="async" loading="lazy" alt="Spread mirroring configuration" src="/assets/images/spread-mirror-config-8fcb58deccfd5ced8244d031f11ed9d3.png" width="445" height="295" class="img_ev3q"></p>
<p>Expanding a cluster with spread mirroring requires more planning and may take more time. You must either add a set of hosts equal to the number of primaries per host plus one, or you can add two nodes in a group mirroring configuration and, when the expansion is complete, move mirrors to recreate the spread mirror configuration.</p>
<p>Spread mirroring has the least performance impact for a single failed host because each host&#x27;s mirrors are spread across the maximum number of hosts. Load is increased by 1/<em>Nth</em>, where <em>N</em> is the number of primaries per host. Spread mirroring is, however, the most likely configuration to have a catastrophic failure if two or more hosts fail simultaneously.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-block-mirroring">Configure block mirroring<a href="#configure-block-mirroring" class="hash-link" aria-label="Direct link to Configure block mirroring" title="Direct link to Configure block mirroring">​</a></h3>
<p>With block mirroring, nodes are divided into blocks, for example a block of four or eight hosts, and the mirrors for segments on each host are placed on other hosts within the block. Depending on the number of hosts in the block and the number of primary segments per host, each host maintains more than one mirror for each other host&#x27;s segments.</p>
<p>The following diagram shows a single block mirroring configuration for a block of four hosts, each with eight primary segments:</p>
<p><img decoding="async" loading="lazy" alt="Block mirroring configuration" src="/assets/images/block-mirror-config-08ef5f185dc04edcb383198122d77f50.png" width="464" height="432" class="img_ev3q"></p>
<p>If there are eight hosts, an additional four-host block is added with the mirrors for primary segments 32 through 63 set up in the same pattern.</p>
<p>A cluster with block mirroring is easy to expand because each block is a self-contained primary mirror group. The cluster is expanded by adding one or more blocks. There is no need to move mirrors after expansion to maintain a consistent mirror setup. This configuration is able to survive multiple host failures as long as the failed hosts are in different blocks.</p>
<p>Because each host in a block has multiple mirror instances for each other host in the block, block mirroring has a higher performance impact for host failures than spread mirroring, but a lower impact than group mirroring. The expected performance impact varies by block size and primary segments per node. As with group mirroring, if the resources are available, performance will be negatively impacted but the cluster will remain available. If resources are insufficient to accommodate the added load you must reduce the workload until the failed node is replaced.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implement-block-mirroring">Implement block mirroring<a href="#implement-block-mirroring" class="hash-link" aria-label="Direct link to Implement block mirroring" title="Direct link to Implement block mirroring">​</a></h3>
<p>Block mirroring is not one of the automatic options Apache Cloudberry offers when you set up or expand a cluster. To use it, you must create your own configuration.</p>
<p>For a new Cloudberry system, you can initialize the cluster without mirrors, and then run <code>gpaddmirrors -i mirror_config_file</code> with a custom mirror configuration file to create the mirrors for each block. You must create the file system locations for the mirror segments before you run <code>gpaddmirrors</code>.</p>
<p>If you expand a system that has block mirroring or you want to implement block mirroring at the same time you expand a cluster, it is recommended that you complete the expansion first, using the default grouping mirror configuration, and then use the <code>gpmovemirrors</code> utility to move mirrors into the block configuration.</p>
<p>To implement block mirroring with an existing system that has a different mirroring scheme, you must first determine the desired location for each mirror according to your block configuration, and then determine which of the existing mirrors must be relocated. Follow these steps:</p>
<ol>
<li>
<p>Run the following query to find the current locations of the primary and mirror segments:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> dbid</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> role</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> datadir </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> gp_segment_configuration </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> content </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>gp_segment_configuration</code> system catalog table contains the current segment configuration.</p>
</li>
<li>
<p>Create a list with the current mirror location and the desired block mirroring location, then remove any mirrors from the list that are already on the correct host.</p>
</li>
<li>
<p>Create an input file for the <code>gpmovemirrors</code> utility with an entry for each mirror that must be moved.</p>
<p>The <code>gpmovemirrors</code> input file has the following format:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">old_address|port|data_dir new_address|port|data_dir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Where <code>old_address</code> is the host name or IP address of the segment host, port is the communication port, and <code>data_dir</code> is the segment instance data directory.</p>
<p>The following example <code>gpmovemirrors</code> input file specifies three mirror segments to move.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">sdw2|50001|/data2/mirror/gpseg1 sdw3|50001|/data/mirror/gpseg1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">sdw2|50001|/data2/mirror/gpseg2 sdw4|50001|/data/mirror/gpseg2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">sdw3|50001|/data2/mirror/gpseg3 sdw1|50001|/data/mirror/gpseg3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Run <code>gpmovemirrors</code> with a command like the following:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpmovemirrors -i mirror_config_file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>The <code>gpmovemirrors</code> utility validates the input file, calls <code>gprecoverseg</code> to relocate each specified mirror, and removes the original mirror. It creates a backout configuration file which can be used as input to <code>gpmovemirrors</code> to undo the changes that were made. The backout file has the same name as the input file, with the suffix <code>_backout_timestamp</code> added.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/tutorials/best-practices/high-availability-best-practices.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-19T03:15:52.000Z">Sep 19, 2025</time></b> by <b>Dianjin Wang</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/best-practices/db-encryption-best-practices"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label single-line-overflow hide-before-after">Encrypt Data and Database Connections</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/best-practices/resource-group-best-practices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label single-line-overflow hide-before-after">Memory and Resource Management with Resource Groups</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#disk-storage" class="table-of-contents__link toc-highlight">Disk storage</a></li><li><a href="#coordinator-mirroring" class="table-of-contents__link toc-highlight">Coordinator mirroring</a></li><li><a href="#segment-mirroring" class="table-of-contents__link toc-highlight">Segment mirroring</a></li><li><a href="#dual-clusters" class="table-of-contents__link toc-highlight">Dual clusters</a></li><li><a href="#backup-and-restore" class="table-of-contents__link toc-highlight">Backup and restore</a></li><li><a href="#detect-failed-coordinator-and-segment-instances" class="table-of-contents__link toc-highlight">Detect failed coordinator and segment instances</a></li><li><a href="#configure-segment-mirroring" class="table-of-contents__link toc-highlight">Configure segment mirroring</a></li></ul></div></div></div></div></main></div></div></div><div class="wrap_QlFE"><div class="mainWrap_IbWk"><div class="linksWrap_Zcc4"><div><div class="footerLinkTitle_PxTg">Support</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a></div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a></div><div class="footerLinkItem_Kf4k"><a href="https://inviter.co/apache-cloudberry" target="_blank" rel="noopener noreferrer">Slack</a></div><div class="footerLinkItem_Kf4k"><a href="https://x.com/ASFCloudberry" target="_blank" rel="noopener noreferrer">Twitter</a></div><div class="footerLinkItem_Kf4k"><a href="https://youtube.com/@ApacheCloudberry" target="_blank" rel="noopener noreferrer">Youtube</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/security">Security</a></div></div><div><div class="footerLinkTitle_PxTg">Resources</div><div class="footerLinkItem_Kf4k"><a href="/releases" target="_blank">Download</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/docs/">Documentation</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/events">Events</a></div><div class="footerLinkItem_Kf4k"><a href="/community/brand" target="_blank">Brand Guidelines</a></div></div><div><div class="footerLinkTitle_PxTg">Contribution</div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/git">Working with Git &amp; GitHub</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/how-to-contribute">Contribution Overview</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/code">Code Contribution</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/doc">Doc Contribution</a></div></div></div><div class="logoLinkWrap_MDp5"><div class="logoWrap_qcVI"><img class="logo_cphB" src="/img/apache-incubator.svg" alt=""></div><div class="links_yA93"><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.002 0c-8.288 0-15 6.713-15 15 0 6.637 4.293 12.244 10.256 14.231.75.131 1.031-.319 1.031-.712 0-.356-.019-1.538-.019-2.794-3.769.694-4.744-.919-5.044-1.763-.168-.43-.9-1.762-1.537-2.118-.525-.282-1.275-.975-.019-.994 1.181-.019 2.025 1.087 2.306 1.537 1.35 2.27 3.507 1.632 4.37 1.238.13-.975.524-1.631.956-2.006-3.338-.375-6.826-1.669-6.826-7.406 0-1.632.582-2.982 1.538-4.032-.15-.375-.675-1.912.15-3.975 0 0 1.256-.394 4.125 1.538 1.2-.338 2.475-.506 3.75-.506s2.55.168 3.75.506c2.869-1.95 4.125-1.538 4.125-1.538.825 2.063.3 3.6.15 3.975.956 1.05 1.538 2.382 1.538 4.032 0 5.756-3.507 7.03-6.844 7.406.544.468 1.012 1.369 1.012 2.775 0 2.006-.018 3.619-.018 4.125 0 .394.28.862 1.03.712A15.024 15.024 0 0 0 30.003 15c0-8.287-6.713-15-15-15Z"></path></svg><svg width="32" height="26" viewBox="0 0 32 26" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M31.319 3.484c-1.145.507-2.36.84-3.603.987a6.293 6.293 0 0 0 2.758-3.47 12.518 12.518 0 0 1-3.983 1.52A6.274 6.274 0 0 0 15.64 6.815c0 .493.056.97.161 1.43a17.811 17.811 0 0 1-12.93-6.555 6.252 6.252 0 0 0-.85 3.154 6.272 6.272 0 0 0 2.791 5.222 6.253 6.253 0 0 1-2.841-.785l-.001.077a6.277 6.277 0 0 0 5.033 6.153 6.305 6.305 0 0 1-2.834.108 6.278 6.278 0 0 0 5.86 4.356 12.59 12.59 0 0 1-7.79 2.686c-.5 0-1-.03-1.497-.088a17.746 17.746 0 0 0 9.616 2.818c11.54 0 17.849-9.559 17.849-17.848 0-.272-.007-.544-.019-.812a12.746 12.746 0 0 0 3.13-3.246Z"></path></svg><svg width="30" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.366 0c.801.004 2.805.024 4.935.11l.755.032c2.145.102 4.287.275 5.35.571 1.417.398 2.53 1.56 2.907 3.033.6 2.339.675 6.903.684 8.008l.002.229v.032l-.002.229c-.009 1.104-.084 5.669-.684 8.008-.381 1.478-1.495 2.64-2.907 3.032-1.063.297-3.205.47-5.35.571l-.755.033c-2.13.086-4.134.105-4.935.11h-.734c-1.696-.01-8.785-.087-11.04-.714-1.418-.398-2.532-1.56-2.908-3.032-.6-2.34-.675-6.904-.684-8.008v-.49c.01-1.105.084-5.67.684-8.008.382-1.478 1.496-2.64 2.908-3.033C5.847.086 12.936.01 14.632 0h.734Zm-3.367 6.749v10.5l9-5.25-9-5.25Z"></path></svg><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M6.791 18.77a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.951-2.951 2.959 2.959 0 0 1 2.951-2.952h2.952v2.952Zm1.487 0a2.959 2.959 0 0 1 2.952-2.951 2.959 2.959 0 0 1 2.952 2.952v7.39a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.952-2.952v-7.39ZM11.23 6.792A2.959 2.959 0 0 1 8.278 3.84 2.959 2.959 0 0 1 11.23.888a2.959 2.959 0 0 1 2.952 2.951v2.952H11.23Zm0 1.487a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H3.84A2.959 2.959 0 0 1 .887 11.23a2.959 2.959 0 0 1 2.951-2.952h7.391Zm11.98 2.952a2.959 2.959 0 0 1 2.951-2.952 2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H23.21V11.23Zm-1.488 0a2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V3.84A2.959 2.959 0 0 1 18.771.887a2.959 2.959 0 0 1 2.951 2.951v7.391Zm-2.951 11.98a2.959 2.959 0 0 1 2.951 2.951 2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V23.21h2.952Zm0-1.488a2.959 2.959 0 0 1-2.952-2.951 2.959 2.959 0 0 1 2.952-2.952h7.39a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.951h-7.39Z"></path></svg><svg width="28" height="30" viewBox="0 0 28 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M22.48 4.286H5.195c-.845 0-1.52.724-1.52 1.568v18.579c0 .844.675 1.568 1.52 1.568h17.283c.845 0 1.52-.724 1.52-1.568V5.854c0-.844-.675-1.568-1.52-1.568Z"></path><path d="M6.233 12.156h3.081v10.756H6.233V12.156Zm1.57-5.315c.988 0 1.802.875 1.802 1.938s-.814 1.939-1.803 1.939C6.814 10.718 6 9.842 6 8.779c0-1.063.814-1.938 1.802-1.938Zm3.488 5.315h2.965v1.439h.058c.407-.876 1.453-1.751 2.965-1.751 3.14 0 3.721 2.25 3.721 5.127v5.879h-3.081v-5.253c0-1.25 0-2.877-1.628-2.877s-1.86 1.376-1.86 2.752v5.315h-3.082v-10.63h-.058Z" fill="#000"></path></svg><svg width="34" height="28" viewBox="0 0 34 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M26.863 16.567c.748 0 1.347-.636 1.347-1.347 0-.748-.599-1.347-1.347-1.347s-1.347.599-1.347 1.347.599 1.347 1.347 1.347Zm-6.639 0c.749 0 1.347-.636 1.347-1.347 0-.748-.598-1.347-1.347-1.347-.748 0-1.346.599-1.346 1.347s.598 1.347 1.346 1.347Zm9.852 7.56a.52.52 0 0 0-.258.553c0 .074 0 .148.036.221.148.627.442 1.622.442 1.66 0 .11.037.184.037.257a.33.33 0 0 1-.331.332c-.074 0-.11-.037-.184-.074l-2.174-1.253c-.147-.074-.331-.147-.516-.147-.11 0-.22 0-.294.037-1.032.294-2.1.442-3.242.442-5.49 0-9.91-3.687-9.91-8.258 0-4.57 4.42-8.257 9.91-8.257 5.489 0 9.91 3.686 9.91 8.257 0 2.47-1.327 4.719-3.427 6.23ZM24.01 8.147a13.662 13.662 0 0 0-.418-.007c-6.262 0-11.41 4.29-11.41 9.757 0 .83.119 1.634.342 2.4h-.133c-1.33 0-2.659-.221-3.877-.553-.111-.037-.222-.037-.333-.037-.221 0-.443.074-.627.185L4.932 21.4a.525.525 0 0 1-.221.074.409.409 0 0 1-.406-.405c0-.11.036-.184.073-.294.037-.037.37-1.251.554-1.987 0-.074.037-.184.037-.258a.834.834 0 0 0-.332-.662C2.089 16.065.5 13.378.5 10.398.501 4.916 5.855.5 12.428.5 18.073.5 22.82 3.753 24.01 8.146Zm-7.73.627c.859 0 1.54-.716 1.54-1.54 0-.858-.681-1.539-1.54-1.539-.86 0-1.54.68-1.54 1.54 0 .859.68 1.54 1.54 1.54Zm-7.89 0c.86 0 1.54-.716 1.54-1.54 0-.858-.68-1.539-1.54-1.539-.859 0-1.539.68-1.539 1.54 0 .859.68 1.54 1.54 1.54Z"></path></svg></div></div></div><div class="copyrightWrap_yPz7"><div class="copyright_AoBa">
      <p>
        Apache Cloudberry is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
      </p>
      <p>
        Copyright © 2025 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p>
      <p>
        Apache®, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.
      </p>
      </div></div></div></div>
</body>
</html>