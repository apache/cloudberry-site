"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[82554],{71420:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var n=a(85893),i=a(11151);const s={title:"Lesson 3: Create Tables",description:"Learn how to create tables in the Apache Cloudberry."},r=void 0,l={id:"tutorial/create-tables",title:"Lesson 3: Create Tables",description:"Learn how to create tables in the Apache Cloudberry.",source:"@site/docs/tutorial/create-tables.md",sourceDirName:"tutorial",slug:"/tutorial/create-tables",permalink:"/zh/docs/next/tutorial/create-tables",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/tutorial/create-tables.md",tags:[],version:"current",lastUpdatedBy:"Dianjin Wang",lastUpdatedAt:1749788112,formattedLastUpdatedAt:"2025\u5e746\u670813\u65e5",frontMatter:{title:"Lesson 3: Create Tables",description:"Learn how to create tables in the Apache Cloudberry."},sidebar:"docsbars",previous:{title:"Lesson 2: Create and Prepare Database",permalink:"/zh/docs/next/tutorial/create-and-prepare-database"},next:{title:"Lesson 4: Data Loading",permalink:"/zh/docs/next/tutorial/data-loading"}},o={},d=[{value:"Create tables using a SQL file in psql",id:"create-tables-using-a-sql-file-in-psql",level:2},{value:"About the distribution policy",id:"about-the-distribution-policy",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["After creating and preparing a database in ",(0,n.jsx)(t.a,{href:"./create-and-prepare-database",children:"Lesson 2: Create and Prepare a Database"}),", you can start to create tables in the database."]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["To introduce Apache Cloudberry, we use a public data set, the Airline On-Time Statistics and Delay Causes data set, published by the United States Department of Transportation at ",(0,n.jsx)(t.a,{href:"http://www.transtats.bts.gov/",children:"http://www.transtats.bts.gov/"}),". The On-Time Performance dataset records flights by date, airline, originating airport, destination airport, and many other flight details. The data is available for flights since 1987. The exercises in this guide use data for about a million flights in 2009 and 2010. You are encouraged to review the SQL scripts in the GitHub ",(0,n.jsx)(t.a,{href:"https://github.com/apache/cloudberry-bootcamp/tree/main/000-cbdb-sandbox/configs",children:(0,n.jsx)(t.code,{children:"000-cbdb-sandbox/configs/faa.tar.gz"})})," directory as you work through this introduction. You can run most of the exercises by entering the commands yourself or by executing a script in the ",(0,n.jsx)(t.code,{children:"faa"})," directory."]})}),"\n",(0,n.jsx)(t.h2,{id:"create-tables-using-a-sql-file-in-psql",children:"Create tables using a SQL file in psql"}),"\n",(0,n.jsxs)(t.p,{children:["In Apache Cloudberry, you can use the ",(0,n.jsx)(t.code,{children:"CREATE TABLE"})," SQL statement to create a table."]}),"\n",(0,n.jsxs)(t.p,{children:["In the following steps, you will be guided to run a SQL file ",(0,n.jsx)(t.code,{children:"create_dim_tables.sql"})," that contains the ",(0,n.jsx)(t.code,{children:"CREATE TABLE"})," statements needed to create ",(0,n.jsx)(t.code,{children:"faa"})," databases."]}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Log into Apache Cloudberry in Docker as ",(0,n.jsx)(t.code,{children:"gpadmin"}),". Then enter the ",(0,n.jsx)(t.code,{children:"faa"})," directory, in which the SQL file ",(0,n.jsx)(t.code,{children:"create_dim_tables.sql"})," is located."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"[gpadmin@cdw tmp]$ cd /tmp\n[gpadmin@cdw tmp]$ tar xzf faa.tar.gz\n[gpadmin@cdw tmp]$ cd faa\n"})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Take a look at the ",(0,n.jsx)(t.code,{children:"create_dim_tables.sql"})," file."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"[gpadmin@cdw faa]$ more create_dim_tables.sql\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"create_dim_tables.sql"})," file contains the following ",(0,n.jsx)(t.code,{children:"CREATE TABLE"})," statements:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"DROP TABLE IF EXISTS faa.d_airports;  -- Drops the table if it exists to avoid name conflict.\nCREATE TABLE faa.d_airports (  -- Creates the table.\n    AirportID      INTEGER,\n    Name           TEXT,\n    City           TEXT,\n    Country        TEXT,\n    airport_code   TEXT,\n    ICOA_code      TEXT,\n    Latitude       FLOAT8,\n    Longitude      FLOAT8,\n    Altitude       FLOAT8,\n    TimeZoneOffset FLOAT,\n    DST_Flag       TEXT,\n    TZ             TEXT\n)\nDISTRIBUTED BY (airport_code);  -- Specifies the distribution column airport_code.\n\nDROP TABLE IF EXISTS faa.d_wac;\nCREATE TABLE faa.d_wac (wac SMALLINT, area_desc TEXT)\nDISTRIBUTED BY (wac);\n\nDROP TABLE IF EXISTS faa.d_airlines;\nCREATE TABLE faa.d_airlines (airlineid INTEGER, airline_desc TEXT)\nDISTRIBUTED BY (airlineid);\n\nDROP TABLE IF EXISTS faa.d_cancellation_codes;\nCREATE TABLE faa.d_cancellation_codes (cancel_code TEXT, cancel_desc TEXT)\nDISTRIBUTED BY (cancel_code);\n\nDROP TABLE IF EXISTS faa.d_delay_groups;\nCREATE TABLE faa.d_delay_groups (delay_group_code TEXT, delay_group_desc TEXT)\nDISTRIBUTED BY (delay_group_code);\n\nDROP TABLE IF EXISTS faa.d_distance_groups;\nCREATE TABLE faa.d_distance_groups (distance_group_code TEXT, distance_group_desc TEXT)\nDISTRIBUTED BY (distance_group_code);\n"})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Connect to the ",(0,n.jsx)(t.code,{children:"tutorial"})," database as ",(0,n.jsx)(t.code,{children:"lily"})," using the ",(0,n.jsx)(t.code,{children:"psql"}),". You will run the SQL file as ",(0,n.jsx)(t.code,{children:"lily"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"[gpadmin@cdw faa]$ psql -U lily tutorial\n\nPassword for user lily:  # changeme\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:'psql (14.4, server 14.4)\nType "help" for help.\ntutorial=>\n'})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Run the ",(0,n.jsx)(t.code,{children:"create_dim_tables.sql"})," file using the ",(0,n.jsx)(t.code,{children:"psql"})," command ",(0,n.jsx)(t.code,{children:"\\i"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"tutorial=> \\i create_dim_tables.sql\n"})}),"\n",(0,n.jsx)(t.p,{children:"The following messages are displayed:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:'psql:create_dim_tables.sql:1: NOTICE:  table "d_airports" does not exist, skipping\nDROP TABLE\nCREATE TABLE\npsql:create_dim_tables.sql:18: NOTICE:  table "d_wac" does not exist, skipping\nDROP TABLE\nCREATE TABLE\npsql:create_dim_tables.sql:22: NOTICE:  table "d_airlines" does not exist, skipping\nDROP TABLE\nCREATE TABLE\npsql:create_dim_tables.sql:26: NOTICE:  table "d_cancellation_codes" does not exist, skipping\nDROP TABLE\nCREATE TABLE\npsql:create_dim_tables.sql:30: NOTICE:  table "d_delay_groups" does not exist, skipping\nDROP TABLE\nCREATE TABLE\npsql:create_dim_tables.sql:34: NOTICE:  table "d_distance_groups" does not exist, skipping\nDROP TABLE\nCREATE TABLE\n'})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Use the ",(0,n.jsx)(t.code,{children:"\\dt"})," command to display all tables in the ",(0,n.jsx)(t.code,{children:"faa"})," schema. You can see that 6 tables have been created."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"tutorial=> \\dt\n                    List of relations\nSchema |         Name         | Type  | Owner | Storage\n--------+----------------------+-------+-------+---------\nfaa    | d_airlines           | table | lily  | heap\nfaa    | d_airports           | table | lily  | heap\nfaa    | d_cancellation_codes | table | lily  | heap\nfaa    | d_delay_groups       | table | lily  | heap\nfaa    | d_distance_groups    | table | lily  | heap\nfaa    | d_wac                | table | lily  | heap\n(6 rows)\n"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"about-the-distribution-policy",children:"About the distribution policy"}),"\n",(0,n.jsx)(t.p,{children:"The definition of a table includes the distribution policy for the data, which is critical for query performance. The goals for the distribution policy are to:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Distribute the volume of data and query execution work evenly among segments."}),"\n",(0,n.jsx)(t.li,{children:"Enable segments to accomplish complicated query processing steps locally."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"The distribution policy determines how data is distributed among segments. To get an effective distribution policy requires understanding of the data's characteristics, what kind of queries that would be executed on the data and what distribution strategy will best utilize the parallel execution capacity among segments."}),"\n",(0,n.jsxs)(t.p,{children:["Use the ",(0,n.jsx)(t.code,{children:"DISTRIBUTED"})," clause in ",(0,n.jsx)(t.code,{children:"CREATE TABLE"})," statement to define the distribution policy for a table. Ideally, each segment possesses an equal volume of data and performs equal share of work when queries run. There are 2 kinds of distribution policy syntax in Apache Cloudberry:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"DISTRIBUTED BY (column, ...)"})," defines a distribution key from one or more columns. A hash function applied to the distribution key determines which segment stores the corresponding row. Rows that have same distribution key are stored on the same segment. If the distribution keys are unique, the hash function will ensure that data is distributed evenly. The default distribution policy is a hash on the primary key of the table or the first column of table if no primary key is specified."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"DISTRIBUTED RANDOMLY"})," distributes rows in round-robin fashion among segments."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"When different tables that have the same or similar columns as distribution key are about to be joined, join action might be accomplished on segments, which will be much faster than re-distributing rows across segments and then joining. The random distribution policy cannot make it happen, so it is definitely better to have a distribution key for a table."})]})}function h(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},11151:(e,t,a)=>{a.d(t,{Z:()=>l,a:()=>r});var n=a(67294);const i={},s=n.createContext(i);function r(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);